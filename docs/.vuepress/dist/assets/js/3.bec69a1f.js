(window.webpackJsonp=window.webpackJsonp||[]).push([[3,25],{130:function(t,i,e){"use strict";e.d(i,"a",function(){return s});var s=new(e(0).a)({data:{assetsLoaded:!1},methods:{setLoaded:function(){this.assetsLoaded=!0}}})},131:function(t,i,e){"use strict";var s={Puyo:{None:"0",Red:"R",Green:"G",Blue:"B",Yellow:"Y",Purple:"P",Nuisance:"J",Point:"T",Sun:"S",Hard:"H",Iron:"I",Block:"L"}},o=function(t,i,e){this.puyo=t,this.x=i,this.y=e,this.newY=e,this.yDiff=this.newY-this.y,this.toPop=!1,this.toDrop=!1,this.vy=0,this.accel=.703125};o.prototype={isColoredPuyo:function(){return this.puyo===s.Puyo.Red||this.puyo===s.Puyo.Green||this.puyo===s.Puyo.Blue||this.puyo===s.Puyo.Yellow||this.puyo===s.Puyo.Purple},checkSides:function(t){var i=[];return this.x>0&&t.map[this.y][this.x].puyo===t.map[this.y][this.x-1].puyo&&i.push(t.map[this.y][this.x-1]),this.y>t.hiddenRows&&t.map[this.y][this.x].puyo===t.map[this.y-1][this.x].puyo&&i.push(t.map[this.y-1][this.x]),this.x<t.columns-1&&t.map[this.y][this.x].puyo===t.map[this.y][this.x+1].puyo&&i.push(t.map[this.y][this.x+1]),this.y<t.totalRows-1&&t.map[this.y][this.x].puyo===t.map[this.y+1][this.x].puyo&&i.push(t.map[this.y+1][this.x]),i},adjacentPuyos:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo!==s.Puyo.Red&&i[o].puyo!==s.Puyo.Green&&i[o].puyo!==s.Puyo.Blue&&i[o].puyo!==s.Puyo.Yellow&&i[o].puyo!==s.Puyo.Purple||e.push(i[o]);return e},adjacentNuisance:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo===s.Puyo.Nuisance&&e.push(i[o]);return e}};var a={Constants:s,Puyo:o,Field:function(t,i){var e,a;this.visibleRows=t.visibleRows,this.columns=t.columns,this.hiddenRows=t.hiddenRows,this.totalRows=t.visibleRows+t.hiddenRows,this.cellWidth=64,this.cellHeight=60,this.puyoToClear=4,this.fieldWidthPx=this.cellWidth*(this.columns+2),this.fieldHeightPx=this.cellHeight*(this.visibleRows+this.hiddenRows+2),e=i.length>=this.totalRows?this.totalRows:i.length,a=i[0].length>=this.columns?this.columns:i[0].length;var r=i.length-this.totalRows;if(void 0!==i){this.map=[];for(var n=0;n<i.length;n++){this.map[n]=[];for(var l=0;l<i[n].length;l++)this.map[n][l]=new o(s.Puyo.None,l,n)}for(var h=e-1;h>=r||h>=0;h--)for(var d=0;d<a;d++)this.map[h][d]=new o(i[h][d],d,h)}else{this.map=[];for(var p=0;p<i.length;p++){this.map[p]=[];for(var u=0;u<i[p].length;u++)this.map[p][u]=new o(s.Puyo.None,u,p)}}},Simulate:{filterColors:function(t,i,e){return e.indexOf(t===i)},checkPops:function(t){for(var i=[],e=0;e<t.totalRows;e++){i[e]=[];for(var s=0;s<t.columns;s++)i[e][s]=!1}for(var o=[],a=[],r=t.hiddenRows;r<t.totalRows;r++)for(var n=0;n<t.columns;n++)if(t.map[r][n].isColoredPuyo()&&!1===i[r][n]){i[r][n]=!0;var l=[];l.push(t.map[r][n]);for(var h=0;h<l.length;h++)for(var d=l[h].checkSides(t),p=0;p<d.length;p++){var u=d[p];u.puyo===l[h].puyo&&!1===i[u.y][u.x]&&(i[u.y][u.x]=!0,l.push(u))}l.length>=t.puyoToClear&&(o.push(l),a.push(l[0].puyo))}return{poppingGroups:o,poppingColors:a.filter(this.filterColors)}},checkGarbagePops:function(t,i){for(var e=[],o=0;o<t.totalRows;o++){e[o]=[];for(var a=0;a<t.columns;a++)e[o][a]=!1}if(i.poppingGroups.length>0){var r=i.poppingGroups,n=[];for(var l in r)for(var h in r[l]){var d=r[l][h].x,p=r[l][h].y;p>0&&t.map[p-1][d].puyo===s.Puyo.Nuisance&&!1===e[p-1][d]&&(e[p-1][d]=!0,n.push(t.map[p-1][d])),d>0&&t.map[p][d-1].puyo===s.Puyo.Nuisance&&!1===e[p][d-1]&&(e[p][d-1]=!0,n.push(t.map[p][d-1])),d<t.columns-1&&t.map[p][d+1].puyo===s.Puyo.Nuisance&&!1===e[p][d+1]&&(e[p][d+1]=!0,n.push(t.map[p][d+1])),p<t.visibleRows+t.hiddenRows-1&&t.map[p+1][d].puyo===s.Puyo.Nuisance&&!1===e[p+1][d]&&(e[p+1][d]=!0,n.push(t.map[p+1][d]))}return n}return[]},clearPuyos:function(t){for(var i=JSON.parse(JSON.stringify(t)),e=this.checkPops(t),a=this.checkGarbagePops(t,e),r=[],n=0;n<t.totalRows;n++){r[n]=[];for(var l=0;l<t.columns;l++)r[n][l]=!1}if(e.poppingGroups.length>0){var h=e.poppingGroups;for(var d in h)for(var p in h[d]){var u=h[d][p].x,c=h[d][p].y;h[d][p].toPop=!0,i.map[c][u]=new o(s.Puyo.None,u,c),r[c][u]=!0}}if(a.length>0)for(var g in a){var f=a[g].x,y=a[g].y;a[g].toPop=!0,i.map[y][f]=new o(s.Puyo.None,f,y),r[y][f]=!0}return{newField:i,popData:e,garbageToClear:a,animationMatrix:r}},dropPuyos:function(t){for(var i=[],e=0;e<t.totalRows;e++)i[e]=[];for(var a=0;a<t.columns;a++){for(var r=[],n=t.totalRows-1;n>=0;n--)r.push(t.map[n][a]);for(var l=[],h=0;h<r.length;h++)r[h].puyo!==s.Puyo.None&&l.push(r[h]);for(var d=[],p=0;p<l.length;p++)if(l[p].puyo===s.Puyo.Block){var u=t.totalRows-1-l[p].y;if(d.length<u){var c=new o(s.Puyo.None,a,t.totalRows-1-d.length);d.push(c),p-=1}else d.push(l[p])}else d.push(l[p]);for(var g=d.length;g<t.totalRows;g++){var f=new o(s.Puyo.None,a,t.totalRows-1-d.length);d.push(f)}d.reverse();for(var y=0;y<d.length;y++)i[y][a]=d[y]}for(var m=0;m<i.length;m++)for(var D=0;D<i[m].length;D++)i[m][D].newY=m,i[m][D].yDiff=i[m][D].newY-i[m][D].y;for(var w=[],S=[],v=0;v<t.totalRows;v++){w[v]=[],S[v]=[];for(var b=0;b<t.columns;b++)w[v][b]=i[v][b],S[v][b]=t.map[v][b].yDiff}return{dropResult:w,dropDistances:S}}},mapToStringArray:function(t){for(var i=[],e=0;e<t.length;e++){i[e]=[];for(var s=0;s<t[0].length;s++)i[e][s]=t[e][s].puyo}return i},stringTo2dArray:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t[6*o+a]}return s},uniformMatrix:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t}return s},flatten2dTo1d:function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[0].length;s++)i.push(t[e][s]);return i}};i.a=a},136:function(t,i,e){"use strict";(function(t){e(138);var i,s=e(62);!function(i){if("object"===("undefined"==typeof exports?"undefined":Object(s.a)(exports))&&void 0!==t)t.exports=i();else if("function"==typeof define&&e(139))define([],i);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).BezierEasing=i()}}(function(){return function(){return function t(e,s,o){function a(n,l){if(!s[n]){if(!e[n]){if(!l&&"function"==typeof i&&i)return i(n,!0);if(r)return r(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var d=s[n]={exports:{}};e[n][0].call(d.exports,function(t){return a(e[n][1][t]||t)},d,d.exports,t,e,s,o)}return s[n].exports}for(var r="function"==typeof i&&i,n=0;n<o.length;n++)a(o[n]);return a}}()({1:[function(t,i,e){var s=4,o=.001,a=1e-7,r=10,n=11,l=1/(n-1),h="function"==typeof Float32Array;function d(t,i){return 1-3*i+3*t}function p(t,i){return 3*i-6*t}function u(t){return 3*t}function c(t,i,e){return((d(i,e)*t+p(i,e))*t+u(i))*t}function g(t,i,e){return 3*d(i,e)*t*t+2*p(i,e)*t+u(i)}function f(t){return t}i.exports=function(t,i,e,d){if(!(0<=t&&t<=1&&0<=e&&e<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===i&&e===d)return f;for(var p=h?new Float32Array(n):new Array(n),u=0;u<n;++u)p[u]=c(u*l,t,e);function y(i){for(var h=0,d=1,u=n-1;d!==u&&p[d]<=i;++d)h+=l;var f=h+(i-p[--d])/(p[d+1]-p[d])*l,y=g(f,t,e);return y>=o?function(t,i,e,o){for(var a=0;a<s;++a){var r=g(i,e,o);if(0===r)return i;i-=(c(i,e,o)-t)/r}return i}(i,f,t,e):0===y?f:function(t,i,e,s,o){var n,l,h=0;do{(n=c(l=i+(e-i)/2,s,o)-t)>0?e=l:i=l}while(Math.abs(n)>a&&++h<r);return l}(i,h,h+l,t,e)}return function(t){return 0===t?0:1===t?1:c(y(t),i,d)}}},{}]},{},[1])(1)})}).call(this,e(137)(t))},140:function(t,i,e){"use strict";e.r(i);var s={name:"ChainsimControlButton",props:["gameLoaded","button","fieldSprites","buttonName"],render:function(t){return t()},methods:{onButtonDown:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,"_pressed.png")]},onButtonUp:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,".png")],this.$emit("controlField",this.buttonName)},onButtonUpOutside:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,".png")]}},mounted:function(){!0===this.gameLoaded&&this.button.on("pointerdown",this.onButtonDown).on("pointerup",this.onButtonUp).on("pointerupoutside",this.onButtonUpOutside)},watch:{gameLoaded:function(){this.button.on("pointerdown",this.onButtonDown).on("pointerup",this.onButtonUp).on("pointerupoutside",this.onButtonUpOutside)}}},o=e(1),a=Object(o.a)(s,void 0,void 0,!1,null,null,null);a.options.__file="ChainsimControlButton.vue";i.default=a.exports},151:function(t,i,e){},205:function(t,i,e){"use strict";var s=e(151);e.n(s).a},219:function(t,i,e){"use strict";e.r(i);e(135),e(13),e(17),e(83);var s=e(9),o=(e(134),e(129),e(131)),a=e(140),r=(e(136),e(130)),n=o.a.uniformMatrix,l=o.a.stringTo2dArray,h=o.a.flatten2dTo1d,d=PIXI.loader,p=PIXI.loader.resources,u=PIXI.Sprite,c=o.a.Constants.Puyo.Red,g=o.a.Constants.Puyo.Green,f=o.a.Constants.Puyo.Blue,y=o.a.Constants.Puyo.Yellow,m=o.a.Constants.Puyo.Purple,D=o.a.Constants.Puyo.Nuisance,w=o.a.Constants.Puyo.None,S={name:"Chainsim",props:["importedData","nextQueue","item","showModal"],components:{ChainsimControlButton:a.default},data:function(){return{fieldSettings:{columns:6,visibleRows:12,hiddenRows:1,totalRows:13,puyoToClear:4,colorBonus:[0,3,6,12,24],groupBonus:[0,2,3,4,5,6,7,10],chainPower:[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512,544,576,608,640,672],targetPoint:70},currentSlide:0,gameMode:"editor",gameState:"idle",fieldData:[[]],fieldOriginal:[[]],fieldHistory:[],connectionData:[[]],colorNameData:[[]],shadowData:[[]],cursorData:[[]],arrowData:[[]],clearPuyosResult:[[]],dropPuyosResult:[[]],score:0,stepScore:0,garbage:0,stepGarbage:0,garbagePoints:0,leftoverGarbagePoints:0,chainLength:0,garbageIcons:["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],poppingCells:[[]],droppingCells:[[]],dropDistances:[[]],dropTimings:[[]],displayMode:"simple",modeSettings:{simple:{width:608,height:974,antialias:!0,transparent:!0,resolution:1},full:{width:872,height:854,antialias:!0,transparent:!1,resolution:1}},app:void 0,stage:void 0,renderer:void 0,ticker:void 0,interaction:void 0,scaleFactor:.45,texturesToLoad:["/img/arle_bg.png","/img/field.json","/img/puyo.json","/img/arrow.png","/img/arrow_x.png","/img/cursor.png","/img/cursor_x.png","/img/chain_font.json","/img/edit_bubble.png","/img/touch_disabler.png","/img/picker_arrow_left.png","/img/picker_arrow_right.png","/img/editor_x.png","/img/current_tool.png","/img/next_background_1p_mask.png","/img/rotate_container.png"],puyoSprites:{},fieldSprites:{},scoreSprites:{},chainCountSprites:{},puyoDisplay:[[]],dumpDisplay:[[]],shadowDisplay:[],scoreDisplay:[],garbageDisplay:[],cursorDisplay:[],arrowDisplay:[],chainCounterDisplay:{},fieldDisplay:{},cellTimer:[[]],puyoStates:[[]],editorTools:[],editorSelectors:[],editorWindow:{},loadingText:"Loading...",texturesLoaded:!1,gameLoaded:!1,fieldControls:{},simulationSpeed:1,needToReset:!1,isMouseDown:!1,frame:0,delta:0,stopGame:!1,chainAutoPlay:!1,timers:{editBubble:0,toolIntroFade:0,chainLength:0,garbageTray:0,cursor:0,arrow:0,next:0},needToChangeSlides:!1,slideChange:1,editorCurrentTool:{page:0,item:6,puyo:"0",layer:"main",x:520,y:820},toolCursor:void 0,toolPage:0,nextPuyoData:"RRBGYYPP",nextPuyoPairs:[],nextQueuePosition:0,nextCoord:[{x:510,y:256},{x:556,y:376},{x:556,y:536}],controlPuyoData:[[]],controlPuyoSprites:[[]],activePair:{data:"RB"},dumpCellContainer:void 0,droppingDumpCells:[[]],dropDumpDistances:[[]],mergedDump:!1,dumpVelocity:[[]],dumpPuyoStates:[[]],dumpCellTimer:[[]],colorSettings:{red:{hue:0,brightness:100,contrast:0,saturate:0},green:{hue:0,brightness:100,contrast:0,saturate:0},blue:{hue:0,brightness:100,contrast:0,saturate:0},yellow:{hue:0,brightness:100,contrast:0,saturate:0},purple:{hue:0,brightness:100,contrast:0,saturate:0},garbage:{hue:0,brightness:100,contrast:0,saturate:0}},colorFilters:{red:new PIXI.filters.ColorMatrixFilter,green:new PIXI.filters.ColorMatrixFilter,blue:new PIXI.filters.ColorMatrixFilter,yellow:new PIXI.filters.ColorMatrixFilter,purple:new PIXI.filters.ColorMatrixFilter,garbage:new PIXI.filters.ColorMatrixFilter}}},mounted:function(){var t=this;this.initData(),this.initGame(),r.a.$on("openModal",function(i){t.updateChainsim(i)}),r.a.$on("stopChainsim",function(){t.closeModal()})},methods:{updateChainsim:function(t){var i=this;this.gameState="idle",this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(t.importedData[t.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=l(t.importedData[t.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=l(t.importedData[t.currentSlide].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(t.importedData[t.currentSlide].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(t.importedData[t.currentSlide].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData=t.nextQueue,this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition=0;for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)this.dumpDisplay[e][s].visible=!1;this.currentSlide=0,this.ticker.addOnce(function(){i.updatePuyoSprites(),i.updateNextPuyoSprites(),i.updateDumpDisplay();for(var t=0;t<i.Field.totalRows;t++)for(var e=0;e<i.Field.columns;e++)i.updateShadowSprite(e,t),i.updateCursorSprite(e,t),i.updateArrowSprite(e,t)})},closeModal:function(){var t=this;this.gameState="idle",this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData="000000",this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition=0;for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)this.dumpDisplay[i][e].visible=!1;this.currentSlide=0,this.ticker.addOnce(function(){t.updatePuyoSprites(),t.updateNextPuyoSprites(),t.updateDumpDisplay();for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);r.a.$emit("closeModal")})},log:function(t){console.log(t)},initData:function(){this.fieldData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.controlPuyoData=n("0",6,this.fieldSettings.columns),this.controlPuyoData=[["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","B","0","0","0"],["0","0","R","0","0","0"],["0","0","0","0","0","0"]],this.connectionData=n("n",this.fieldSettings.totalRows,this.fieldSettings.columns),this.colorNameData=n("spacer",this.fieldSettings.totalRows,this.fieldSettings.columns),this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingDumpCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData="000000"},initGame:function(){var t=this;this.renderer=new PIXI.autoDetectRenderer(this.modeSettings.simple.width,this.modeSettings.simple.height,{antialias:!0,transparent:!0,resolution:1}),this.renderer.view.style.width="".concat(this.modeSettings.simple.width*this.scaleFactor,"px"),this.renderer.view.style.height="".concat(this.modeSettings.simple.height*this.scaleFactor,"px"),this.$refs.game.appendChild(this.renderer.view),this.stage=new PIXI.Container,new Promise(function(t,i){setInterval(function(){d.progress<100?(console.log(d.progress),console.log("Chainsim says not loaded")):t("Chainsim Assets loaded...!")},50)}).then(function(i){console.log(i),t.runSetup()})},runSetup:function(){var t=this;if(localStorage.getItem("puyocolors"))try{this.colorSettings=JSON.parse(localStorage.getItem("puyocolors")),console.log("Found color settings in localStorage")}catch(t){console.log("Removing puyocolors from localStorage."),localStorage.removeItem("puyocolors"),console.log("Using default color settings instead."),this.colorSettings={red:{hue:0,brightness:100,contrast:0,saturate:0},green:{hue:0,brightness:100,contrast:0,saturate:0},blue:{hue:0,brightness:100,contrast:0,saturate:0},yellow:{hue:0,brightness:100,contrast:0,saturate:0},purple:{hue:0,brightness:100,contrast:0,saturate:0},garbage:{hue:0,brightness:100,contrast:0,saturate:0}}}this.texturesLoaded=!0,this.fieldSprites=p["/img/field.json"].textures,this.puyoSprites=p["/img/puyo.json"].textures,this.chainCountSprites=p["/img/chain_font.json"].textures,this.initFieldDisplay(),this.initScoreDisplay(),this.initGameOverX(),this.initPuyoDisplay(),this.initDumpDisplay(),this.initShadowDisplay(),this.initCursorDisplay(),this.initArrowDisplay(),this.initGarbageDisplay(),this.initNextPuyos(),this.initFieldControls(),this.initChainCounter(),this.initToolDisplay(),this.gameLoaded=!0,this.ticker=new PIXI.ticker.Ticker,this.ticker.add(function(i){return t.gameLoop(i)}),this.ticker.start()},initFieldDisplay:function(){this.fieldDisplay.charBG=new u(p["/img/arle_bg.png"].texture),this.fieldDisplay.charBG.x=17,this.fieldDisplay.charBG.y=183,this.stage.addChild(this.fieldDisplay.charBG),this.fieldDisplay.borderTop=new u(this.fieldSprites["field_border_top.png"]),this.fieldDisplay.borderTop.y=132,this.stage.addChild(this.fieldDisplay.borderTop),this.fieldDisplay.borderLeftTop=new u(this.fieldSprites["field_border_left_tophalf.png"]),this.fieldDisplay.borderLeftTop.y=184,this.stage.addChild(this.fieldDisplay.borderLeftTop),this.fieldDisplay.borderLeftBottom=new u(this.fieldSprites["field_border_left_bottomhalf.png"]),this.fieldDisplay.borderLeftBottom.y=536,this.stage.addChild(this.fieldDisplay.borderLeftBottom),this.fieldDisplay.borderRightTop=new u(this.fieldSprites["field_border_right_tophalf.png"]),this.fieldDisplay.borderRightTop.x=417,this.fieldDisplay.borderRightTop.y=184,this.stage.addChild(this.fieldDisplay.borderRightTop),this.fieldDisplay.borderRightBottom=new u(this.fieldSprites["field_border_right_bottomhalf.png"]),this.fieldDisplay.borderRightBottom.x=417,this.fieldDisplay.borderRightBottom.y=536,this.stage.addChild(this.fieldDisplay.borderRightBottom),this.fieldDisplay.borderBottom=new u(this.fieldSprites["field_border_bottom.png"]),this.fieldDisplay.borderBottom.y=902,this.stage.addChild(this.fieldDisplay.borderBottom),this.fieldDisplay.nextWindowBorder=new u(this.fieldSprites["next_border_1p.png"]),this.fieldDisplay.nextWindowBorder.x=456,this.fieldDisplay.nextWindowBorder.y=160,this.stage.addChild(this.fieldDisplay.nextWindowBorder),this.fieldDisplay.nextWindowInner=new u(this.fieldSprites["next_background_1p.png"]),this.fieldDisplay.nextWindowInner.x=456,this.fieldDisplay.nextWindowInner.y=160,this.stage.addChild(this.fieldDisplay.nextWindowInner),this.fieldDisplay.nextWindowMask=new u(p["/img/next_background_1p_mask.png"].texture),this.fieldDisplay.nextWindowMask.position.set(456,160),this.stage.addChild(this.fieldDisplay.nextWindowMask)},initScoreDisplay:function(){var t=150;"full"===this.displayMode?t=150:"simple"===this.displayMode&&(t=32);for(var i=[],e=0;e<8;e++)i[e]=new u(this.fieldSprites["score_0.png"]),i[e].anchor.set(.5),i[e].x=t+.9*i[e].width*e,i[e].y=935,this.stage.addChild(i[e]);this.scoreDisplay=i},initGameOverX:function(){this.fieldDisplay.redX=new u(this.puyoSprites["death_X.png"]),this.fieldDisplay.redX.anchor.set(.5),this.fieldDisplay.redX.x=this.coordArray[1][2].x,this.fieldDisplay.redX.y=this.coordArray[1][2].y,this.stage.addChild(this.fieldDisplay.redX)},initPuyoDisplay:function(){for(var t=this,i=[],e=0;e<this.Field.totalRows;e++){i[e]=[];for(var s=0;s<this.Field.columns;s++)i[e][s]=new u(this.puyoSprites["red_urdl.png"]),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.puyoDisplay=i;for(var o=this,a=function(i){for(var e=function(e){t.puyoDisplay[i][e].interactive=!0,t.puyoDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(e,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][e]&&(o.shadowData[i].splice(e,1,"0"),o.updateShadowSprite(e,i)),o.updatePuyoSprites())},t.puyoDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(e,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][e]&&(o.shadowData[i].splice(e,1,"0"),o.updateShadowSprite(e,i)),o.updatePuyoSprites())},t.puyoDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.puyoDisplay[i][e].on("pointerdown",t.puyoDisplay[i][e].editPuyo),t.puyoDisplay[i][e].on("pointerover",t.puyoDisplay[i][e].mouseOver),t.puyoDisplay[i][e].on("pointerupoutside",t.puyoDisplay[i][e].mouseUp),t.puyoDisplay[i][e].on("pointerup",t.puyoDisplay[i][e].mouseUp)},s=0;s<t.Field.columns;s++)e(s)},r=0;r<this.Field.totalRows;r++)a(r);this.updatePuyoSprites()},updatePuyoSprites:function(){this.determineConnections(),this.determineColorNames();for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.puyoDisplay[t][i].x=this.coordArray[t][i].x,this.puyoDisplay[t][i].y=this.coordArray[t][i].y,"spacer"!==this.colorNameData[t][i]&&(this.puyoDisplay[t][i].filters=[this.colorFilters["".concat(this.colorNameData[t][i])]]),this.puyoDisplay[t][i].spritename="".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png"),this.puyoDisplay[t][i].texture=this.puyoSprites["".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png")],this.puyoDisplay[t][i].anchor.set(.5,.5),this.puyoDisplay[t][i].scale.set(1,1);!1===this.gameLoaded&&(this.colorFilters.red.hue(this.colorSettings.red.hue),this.colorFilters.green.hue(this.colorSettings.green.hue),this.colorFilters.blue.hue(this.colorSettings.blue.hue),this.colorFilters.yellow.hue(this.colorSettings.yellow.hue),this.colorFilters.purple.hue(this.colorSettings.purple.hue),this.colorFilters.garbage.hue(this.colorSettings.garbage.hue)),console.log("updated sprites")},updateShadowSprite:function(t,i){var e="";e=this.shadowData[i][t]===c?"red":this.shadowData[i][t]===g?"green":this.shadowData[i][t]===f?"blue":this.shadowData[i][t]===y?"yellow":this.shadowData[i][t]===m?"purple":this.shadowData[i][t]===D?"garbage":"spacer",this.shadowDisplay[i][t].texture=this.puyoSprites["".concat(e,"_n.png")],"spacer"!==e&&(this.shadowDisplay[i][t].filters=[this.colorFilters["".concat(e)]]),console.log("Updated the shadow sprite.")},updateCursorSprite:function(t,i){"1"===this.cursorData[i][t]?this.cursorDisplay[i][t].alpha=1:this.cursorDisplay[i][t].alpha=0},updateArrowSprite:function(t,i){"0"===this.arrowData[i][t]?this.arrowDisplay[i][t].alpha=0:"L"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=1.5*Math.PI):"R"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=.5*Math.PI):"D"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=Math.PI):"U"===this.arrowData[i][t]&&(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=0)},updateNextPuyoSprites:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer"),"spacer"!==s&&(this.nextPuyoPairs[e].children[0].filters=[this.colorFilters["".concat(s)]]),"spacer"!==o&&(this.nextPuyoPairs[e].children[1].filters=[this.colorFilters["".concat(o)]]),this.nextPuyoPairs[e].children[0].texture=this.puyoSprites["".concat(s,"_n.png")],this.nextPuyoPairs[e].children[1].texture=this.puyoSprites["".concat(o,"_n.png")]}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y)},determineConnections:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)if(i<this.Field.hiddenRows)t[i][e]="n";else if(this.dropDistances[i][e]>0)t[i][e]="n";else if(this.fieldData[i][e]===w||this.fieldData[i][e]===D)t[i][e]="n";else{var s={};s.up=!(i<=this.Field.hiddenRows)&&(this.fieldData[i][e]===this.fieldData[i-1][e]&&0===this.dropDistances[i-1][e]),s.left=0!==e&&(this.fieldData[i][e]===this.fieldData[i][e-1]&&0===this.dropDistances[i][e-1]),s.right=e!==this.Field.columns-1&&(this.fieldData[i][e]===this.fieldData[i][e+1]&&0===this.dropDistances[i][e+1]),s.down=i!==this.Field.totalRows-1&&(this.fieldData[i][e]===this.fieldData[i+1][e]&&0===this.dropDistances[i+1][e]);var o="";!0===s.up&&(o+="u"),!0===s.right&&(o+="r"),!0===s.down&&(o+="d"),!0===s.left&&(o+="l"),""===o&&(o="n"),t[i][e]=o}}return this.connectionData=t,t},determineColorNames:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)this.fieldData[i][e]===c?t[i][e]="red":this.fieldData[i][e]===g?t[i][e]="green":this.fieldData[i][e]===f?t[i][e]="blue":this.fieldData[i][e]===y?t[i][e]="yellow":this.fieldData[i][e]===m?t[i][e]="purple":this.fieldData[i][e]===D?t[i][e]="garbage":t[i][e]="spacer"}return this.colorNameData=t,t},initNextPuyos:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer");var a=new u(this.puyoSprites["".concat(s,"_n.png")]),r=new u(this.puyoSprites["".concat(o,"_n.png")]);a.y+=60,"spacer"!==s&&(a.filters=[this.colorFilters["".concat(s)]]),"spacer"!==o&&(r.filters=[this.colorFilters["".concat(o)]]),this.nextPuyoPairs[e]=new PIXI.Container,this.nextPuyoPairs[e].addChild(a),this.nextPuyoPairs[e].addChild(r),this.nextPuyoPairs[e].pivot.set(this.nextPuyoPairs[e].width/2,this.nextPuyoPairs[e].height/2),this.nextPuyoPairs[e].mask=this.fieldDisplay.nextWindowMask}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y),this.stage.addChild(this.nextPuyoPairs[0]),this.stage.addChild(this.nextPuyoPairs[1]),this.stage.addChild(this.nextPuyoPairs[2])},initGarbageDisplay:function(){if("full"===this.displayMode?(this.fieldDisplay.garbageTray=new u(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=456,this.fieldDisplay.garbageTray.y=480,this.stage.addChild(this.fieldDisplay.garbageTray)):"simple"===this.displayMode&&(this.fieldDisplay.garbageTray=new u(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=316,this.fieldDisplay.garbageTray.y=915,this.fieldDisplay.garbageTray.scale.set(.7,.7),this.stage.addChild(this.fieldDisplay.garbageTray)),"full"===this.displayMode){for(var t=[],i=0;i<this.Field.columns;i++)t[i]=new u(this.puyoSprites["spacer_n.png"]),t[i].x=468+t[i].width*i,t[i].origX=468+t[i].width*i,t[i].y=470,this.stage.addChild(t[i]);this.garbageDisplay=t}else if("simple"===this.displayMode){for(var e=[],s=0;s<this.Field.columns;s++)e[s]=new u(this.puyoSprites["spacer_n.png"]),e[s].scale.set(.7,.7),e[s].x=324+e[s].width*s,e[s].origX=324+e[s].width*s,e[s].y=910,this.stage.addChild(e[s]);this.garbageDisplay=e}},initFieldControls:function(){var t,i=this,e=0;this.fieldControls.reset=new u(this.fieldSprites["btn_reset.png"]),this.fieldControls.reset.x=452,this.fieldControls.reset.y=480,this.fieldControls.reset.interactive=!0,this.fieldControls.reset.buttonMode=!0,this.stage.addChild(this.fieldControls.reset),t=this.fieldControls.reset.height,this.fieldControls.pause=new u(this.fieldSprites["btn_pause.png"]),this.fieldControls.pause.x=528,this.fieldControls.pause.y=480+t*e,this.fieldControls.pause.interactive=!0,this.fieldControls.pause.buttonMode=!0,this.stage.addChild(this.fieldControls.pause),e+=1,this.fieldControls.play=new u(this.fieldSprites["btn_play.png"]),this.fieldControls.play.x=452,this.fieldControls.play.y=480+t*e,this.fieldControls.play.interactive=!0,this.fieldControls.play.buttonMode=!0,this.stage.addChild(this.fieldControls.play),this.fieldControls.auto=new u(this.fieldSprites["btn_auto.png"]),this.fieldControls.auto.x=528,this.fieldControls.auto.y=480+t*e,this.fieldControls.auto.interactive=!0,this.fieldControls.auto.buttonMode=!0,this.stage.addChild(this.fieldControls.auto),e+=1,this.fieldDisplay.disableTouchBehind=new u(p["/img/touch_disabler.png"].texture),this.fieldDisplay.disableTouchBehind.x=0,this.fieldDisplay.disableTouchBehind.y=0,this.fieldDisplay.disableTouchBehind.width=this.modeSettings.simple.width,this.fieldDisplay.disableTouchBehind.height=this.modeSettings.simple.height,this.stage.addChild(this.fieldDisplay.disableTouchBehind),this.fieldDisplay.disableTouchBehind.interactive=!1,this.fieldDisplay.disableTouchBehind.on("pointerdown",function(){i.controlField("edit")}),this.fieldControls.edit=new u(this.fieldSprites["btn_edit.png"]),this.fieldControls.edit.x=490,this.fieldControls.edit.y=480+e*this.fieldControls.edit.height,this.fieldControls.edit.interactive=!0,this.fieldControls.edit.buttonMode=!0,this.stage.addChild(this.fieldControls.edit)},initChainCounter:function(){this.chainCounterDisplay.firstDigit=new u(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.firstDigit.x=412,this.chainCounterDisplay.firstDigit.y=732,this.chainCounterDisplay.firstDigit.scale.set(.85,.85),this.chainCounterDisplay.firstDigit.origY=this.chainCounterDisplay.firstDigit.y,this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit=new u(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.secondDigit.x=452,this.chainCounterDisplay.secondDigit.y=732,this.chainCounterDisplay.secondDigit.scale.set(.85,.85),this.chainCounterDisplay.secondDigit.origY=this.chainCounterDisplay.secondDigit.y,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText=new u(this.chainCountSprites["chain_text.png"]),this.chainCounterDisplay.chainText.x=496,this.chainCounterDisplay.chainText.y=742,this.chainCounterDisplay.chainText.origY=this.chainCounterDisplay.chainText.y,this.chainCounterDisplay.chainText.scale.set(.85,.85),this.chainCounterDisplay.chainText.alpha=0,this.stage.addChild(this.chainCounterDisplay.firstDigit),this.stage.addChild(this.chainCounterDisplay.secondDigit),this.stage.addChild(this.chainCounterDisplay.chainText)},initShadowDisplay:function(){for(var t=this,i=[],e="",s=0;s<this.fieldData.length;s++){i[s]=[];for(var o=0;o<this.fieldData[0].length;o++)e=this.shadowData[s][o]===c?"red":this.shadowData[s][o]===g?"green":this.shadowData[s][o]===f?"blue":this.shadowData[s][o]===y?"yellow":this.shadowData[s][o]===m?"purple":this.shadowData[s][o]===D?"garbage":"spacer",i[s][o]=new u(this.puyoSprites["".concat(e,"_n.png")]),i[s][o].anchor.set(.5),i[s][o].alpha=.4,i[s][o].x=this.coordArray[s][o].x,i[s][o].y=this.coordArray[s][o].y,"spacer"!==e&&(i[s][o].filters=[this.colorFilters["".concat(e)]]),this.stage.addChild(i[s][o])}this.shadowDisplay=i;for(var a=this,r=function(i){for(var e=function(e){t.updateShadowSprite(e,i),t.shadowDisplay[i][e].interactive=!1,t.shadowDisplay[i][e].editPuyo=function(){a.isMouseDown=!0,"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(e,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(e,1,"0"),a.updateShadowSprite(e,i),a.updatePuyoSprites())},t.shadowDisplay[i][e].mouseOver=function(){!0===a.isMouseDown&&"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(e,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(e,1,"0"),a.updateShadowSprite(e,i),a.updatePuyoSprites())},t.shadowDisplay[i][e].mouseUp=function(){a.isMouseDown=!1},t.shadowDisplay[i][e].on("pointerdown",t.shadowDisplay[i][e].editPuyo),t.shadowDisplay[i][e].on("pointerover",t.shadowDisplay[i][e].mouseOver),t.shadowDisplay[i][e].on("pointerupoutside",t.shadowDisplay[i][e].mouseUp),t.shadowDisplay[i][e].on("pointerup",t.shadowDisplay[i][e].mouseUp)},s=0;s<t.Field.columns;s++)e(s)},n=0;n<this.Field.totalRows;n++)r(n)},initControlledPuyos:function(){for(var t=[],i=[],e=0;e<this.controlPuyoData.length;e++){i[e]=[];for(var s=0;s<this.controlPuyoData[0].length;s++)switch(this.controlPuyoData[e][s]){case"R":i[e][s]="red";break;case"G":i[e][s]="green";break;case"B":i[e][s]="blue";break;case"Y":i[e][s]="yellow";break;case"P":i[e][s]="purple";break;default:i[e][s]="spacer"}}for(var o=0;o<this.controlPuyoData.length;o++){t[o]=[];for(var a=0;a<this.controlPuyoData[0].length;a++)t[o][a]=new u(this.puyoSprites["".concat(i[o][a],"_n.png")]),t[o][a].anchor.set(.5),t[o][a].x=this.coordArray[o][a].x,t[o][a].y=this.coordArray[o][a].y-5*t[o][a].height,t[o][a].visible=!1,this.stage.addChild(t[o][a])}this.controlPuyoSprites=t},initActivePair:function(){for(var t=this,i=[],e=0;e<2;e++)switch(this.activePair.data[e]){case"R":i.push("red");break;case"G":i.push("green");break;case"B":i.push("blue");break;case"Y":i.push("yellow");break;case"P":i.push("purple");break;default:i.push("spacer")}void 0===i[0]&&(i[0]="spacer"),void 0===i[1]&&(i[0]="spacer");var s=new u(this.puyoSprites["".concat(i[0],"_n.png")]),o=new u(this.puyoSprites["".concat(i[1],"_n.png")]);s.anchor.set(.5,.5),o.anchor.set(.5,.5),s.y+=s.height,this.activePair.sprites=new PIXI.Container,this.activePair.sprites.addChild(s),this.activePair.sprites.addChild(o),this.activePair.sprites.pivot.set(0,60),this.activePair.sprites.position.set(this.coordArray[0][2].x,this.coordArray[0][2].y-60),this.stage.addChild(this.activePair.sprites),this.activePair.sprites.visible=!1,this.ticker.add(function(){t.activePair.sprites.rotation+=2*Math.PI/180,t.activePair.sprites.children[0].rotation-=2*Math.PI/180,t.activePair.sprites.children[1].rotation-=2*Math.PI/180})},initCursorDisplay:function(){for(var t=this,i=[],e=0;e<this.fieldData.length;e++){i[e]=[];for(var s=0;s<this.fieldData[0].length;s++)i[e][s]=new u(p["/img/cursor.png"].texture),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.cursorDisplay=i;for(var o=this,a=function(i){for(var e=function(e){t.updateCursorSprite(e,i),t.cursorDisplay[i][e].interactive=!1,t.cursorDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateCursorSprite(e,i),o.arrowData[i].splice(e,1,"0"),o.updateArrowSprite(e,i))},t.cursorDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateCursorSprite(e,i),o.arrowData[i].splice(e,1,"0"),o.updateArrowSprite(e,i))},t.cursorDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.cursorDisplay[i][e].on("pointerdown",t.cursorDisplay[i][e].editPuyo),t.cursorDisplay[i][e].on("pointerover",t.cursorDisplay[i][e].mouseOver),t.cursorDisplay[i][e].on("pointerupoutside",t.cursorDisplay[i][e].mouseUp),t.cursorDisplay[i][e].on("pointerup",t.cursorDisplay[i][e].mouseUp)},s=0;s<t.fieldData[0].length;s++)e(s)},r=0;r<this.fieldData.length;r++)a(r)},initArrowDisplay:function(){for(var t=this,i=[],e=0;e<this.fieldData.length;e++){i[e]=[];for(var s=0;s<this.fieldData[0].length;s++)i[e][s]=new u(p["/img/arrow.png"].texture),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.arrowDisplay=i;for(var o=this,a=function(i){for(var e=function(e){t.updateArrowSprite(e,i),t.arrowDisplay[i][e].interactive=!1,t.arrowDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateArrowSprite(e,i),o.cursorData[i].splice(e,1,"0"),o.updateCursorSprite(e,i))},t.arrowDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateArrowSprite(e,i),o.cursorData[i].splice(e,1,"0"),o.updateCursorSprite(e,i))},t.arrowDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.arrowDisplay[i][e].on("pointerdown",t.arrowDisplay[i][e].editPuyo),t.arrowDisplay[i][e].on("pointerover",t.arrowDisplay[i][e].mouseOver),t.arrowDisplay[i][e].on("pointerupoutside",t.arrowDisplay[i][e].mouseUp),t.arrowDisplay[i][e].on("pointerup",t.arrowDisplay[i][e].mouseUp)},s=0;s<t.fieldData[0].length;s++)e(s)},r=0;r<this.fieldData.length;r++)a(r)},initDumpDisplay:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]=new u(this.puyoSprites["spacer_n.png"]),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y-780,this.stage.addChild(t[i][e])}this.dumpDisplay=t;for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!1},updateDumpDisplay:function(){for(var t="",i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++){switch(this.chainDiff[i][e]){case"R":t="red";break;case"G":t="green";break;case"B":t="blue";break;case"Y":t="yellow";break;case"P":t="purple";break;case"J":t="garbage";break;default:t="spacer"}console.log(t),this.dumpDisplay[i][e].texture=this.puyoSprites["".concat(t,"_n.png")],this.dumpDisplay[i][e].anchor.set(.5),this.dumpDisplay[i][e].x=this.coordArray[i][e].x,this.dumpDisplay[i][e].y=this.coordArray[i][e].y-780}for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!0},initToolDisplay:function(){var t=this;this.fieldDisplay.editBubble=new u(p["/img/edit_bubble.png"].texture),this.fieldDisplay.editBubble.x=520,this.fieldDisplay.editBubble.y=704,this.fieldDisplay.editBubble.anchor.set(.87,0),this.fieldDisplay.editBubble.scale.set(0,0),this.fieldDisplay.editBubble.interactive=!0,this.fieldDisplay.editBubble.visible=!1,this.stage.addChild(this.fieldDisplay.editBubble),this.toolCursor=new u(p["/img/current_tool.png"].texture),this.toolCursor.anchor.set(.5,.5),this.toolCursor.visible=!1,this.stage.addChild(this.toolCursor),this.editorTools[0]=new PIXI.Container,this.editorTools[1]=new PIXI.Container;for(var i=[[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],p["/img/editor_x.png"].texture],[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],p["/img/editor_x.png"].texture]],e=[],s=["R","G","B","Y","P","J","0","R","G","B","Y","P","J","0"],o=0;o<i.length;o++){e[o]=[];for(var a=0;a<i[o].length;a++){var r=0,n=0;a>0&&(r=8),o>0&&(n=8),e[o][a]=new u(i[o][a]),e[o][a].interactive=!0,e[o][a].buttonMode=!0,e[o][a].puyoIndex=7*o+a,e[o][a].puyoColor=s[7*o+a],e[o][a].targetLayer=7*o+a<7?"main":"shadow",e[o][a].anchor.set(.5,.5);var l=void 0;l=s[7*o+a]===c?"red":s[7*o+a]===g?"green":s[7*o+a]===f?"blue":s[7*o+a]===y?"yellow":s[7*o+a]===m?"purple":s[7*o+a]===D?"garbage":"spacer",console.log(l),console.log(this.colorFilters["".concat(l)]),void 0!==l&&"spacer"!==l&&(e[o][a].filters=[this.colorFilters["".concat(l)]]),e[o][a].on("pointerdown",function(){t.editorCurrentTool.page=0,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),e[o][a].x=88+(e[o][a].width+r)*a,e[o][a].y=820+(e[o][a].height+n)*o,this.editorTools[0].addChild(e[o][a])}}for(var h=[[p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow_x.png"].texture,p["/img/cursor.png"].texture,p["/img/cursor_x.png"].texture]],d=[],w=["L","U","R","D","0","1","0"],S=0;S<h.length;S++){d[S]=[];for(var v=0;v<h[S].length;v++){var b=0,C=0;v>0&&(b=8),S>0&&(C=8),d[S][v]=new u(h[S][v]),d[S][v].interactive=!0,d[S][v].buttonMode=!0,d[S][v].puyoIndex=7*S+v,d[S][v].puyoColor=w[7*S+v],"L"===w[7*S+v]?d[S][v].rotation=1.5*Math.PI:"R"===w[7*S+v]?d[S][v].rotation=.5*Math.PI:"D"===w[7*S+v]&&(d[S][v].rotation=Math.PI),d[S][v].targetLayer=7*S+v<5?"arrow":"cursor",d[S][v].anchor.set(.5,.5),d[S][v].on("pointerdown",function(){t.editorCurrentTool.page=1,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),d[S][v].x=88+(64+b)*v,d[S][v].y=820+(60+C)*S,this.editorTools[1].addChild(d[S][v])}}this.editorWindow.left=new u(p["/img/picker_arrow_left.png"].texture),this.editorWindow.left.x=0,this.editorWindow.left.y=720,this.editorWindow.left.interactive=!0,this.editorWindow.left.buttonMode=!0,this.editorWindow.left.visible=!1,this.editorWindow.left.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.left),this.editorWindow.right=new u(p["/img/picker_arrow_right.png"].texture),this.editorWindow.right.x=552,this.editorWindow.right.y=720,this.editorWindow.right.interactive=!0,this.editorWindow.right.buttonMode=!0,this.editorWindow.right.visible=!1,this.editorWindow.right.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.right),this.editorTools[0].visible=!1,this.stage.addChild(this.editorTools[0]),this.editorTools[1].visible=!1,this.stage.addChild(this.editorTools[1])},openToolbox:function(t){this.timers.editBubble+=t;var i=this.timers.editBubble;this.fieldDisplay.disableTouchBehind.interactive=!0,this.timers.editBubble<=15?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.openToolbox),this.ticker.add(this.displayTools),this.editorWindow.left.visible=!0,this.editorWindow.right.visible=!0,this.timers.toolIntroFade=0)},displayTools:function(t){this.timers.toolIntroFade+=t;var i=this.timers.toolIntroFade,e=[],s=[];if(this.editorTools[this.toolPage].visible=!0,this.updateToolboxSelection(),i<=2*this.editorTools[this.toolPage].children.length+12){for(var o=0;o<this.editorTools[this.toolPage].children.length;o++)e.push(0-2*o);for(var a=0;a<this.editorTools[this.toolPage].children.length;a++)s.push((e[a]+i)/12),this.editorTools[this.toolPage].children[a].alpha=a<7?s[a]:.17*s[a],a===this.editorCurrentTool.item&&(this.toolCursor.alpha=s[a])}else this.ticker.remove(this.displayTools),this.updateToolboxSelection(),console.log("removed tool ticker")},updateToolboxSelection:function(){this.editorCurrentTool.page===this.toolPage?(this.toolCursor.visible=!0,this.toolCursor.position.set(this.editorCurrentTool.x,this.editorCurrentTool.y)):this.toolCursor.visible=!1},targetLayer:function(t){if("main"===t)for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)this.puyoDisplay[i][e].interactive=!0,this.shadowDisplay[i][e].interactive=!1,this.cursorDisplay[i][e].interactive=!1,this.arrowDisplay[i][e].interactive=!1;else if("shadow"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.puyoDisplay[s][o].interactive=!1,this.shadowDisplay[s][o].interactive=!0,this.cursorDisplay[s][o].interactive=!1,this.arrowDisplay[s][o].interactive=!1;else if("cursor"===t)for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.puyoDisplay[a][r].interactive=!1,this.shadowDisplay[a][r].interactive=!1,this.cursorDisplay[a][r].interactive=!0,this.arrowDisplay[a][r].interactive=!1;else if("arrow"===t)for(var n=0;n<this.Field.totalRows;n++)for(var l=0;l<this.Field.columns;l++)this.puyoDisplay[n][l].interactive=!1,this.shadowDisplay[n][l].interactive=!1,this.cursorDisplay[n][l].interactive=!1,this.arrowDisplay[n][l].interactive=!0},closeToolbox:function(t){this.timers.editBubble-=t;var i=this.timers.editBubble;this.editorTools[this.toolPage].visible=!1,this.editorWindow.left.visible=!1,this.editorWindow.right.visible=!1,this.toolCursor.visible=!1,this.ticker.remove(this.displayTools),this.timers.editBubble>=0?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.closeToolbox),this.gameState="idle",this.timers.editBubble=0,this.fieldDisplay.editBubble.visible=!1,this.fieldDisplay.disableTouchBehind.interactive=!1)},gameLoop:function(t){"idle"===this.gameState?this.stateEditField(t):"dropping"===this.gameState&&!1===this.needToReset?(this.animateDropPuyos(t),!0===this.needToChangeSlides&&this.animateDropDumpPuyos(t)):"popping"===this.gameState&&!1===this.needToReset&&this.animatePopPuyos(t),this.animateCursors(t),this.animateArrows(t),!0===this.inFocus&&(this.animateCursors(t),this.animateArrows(t),this.renderer.render(this.stage))},stateEditField:function(t){},animateDropPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.dropDistances[o][a]>0&&("idle"===this.puyoStates[o][a]||"checkDrops"===this.puyoStates[o][a]?this.puyoStates[o].splice(a,1,"dropping"):"dropping"===this.puyoStates[o][a]?this.puyoDisplay[o][a].y+this.Field.map[o][a].vy<this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight?(this.puyoDisplay[o][a].y+=this.Field.map[o][a].vy,this.Field.map[o][a].vy+=.703125*i):(this.puyoStates[o].splice(a,1,"bouncing"),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight+this.Field.cellHeight/2,this.puyoDisplay[o][a].anchor.set(.5,1)):"bouncing"===this.puyoStates[o][a]&&(this.cellTimer[o][a]+=1,this.cellTimer[o][a]<=8?(this.puyoDisplay[o][a].scale.y-=.025,this.puyoDisplay[o][a].scale.x+=.025):this.cellTimer[o][a]<=16?(this.puyoDisplay[o][a].scale.y+=.025,this.puyoDisplay[o][a].scale.x-=.025):(this.puyoDisplay[o][a].anchor.set(.5,.5),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight,this.puyoStates[o].splice(a,1,"checkPops"),this.droppingCells[o].splice(a,1,!1),this.dropDistances[o].splice(a,1,0),this.cellTimer[o].splice(a,1,0))));!1===this.stopGame&&(this.frame+=1)},animateDropDumpPuyos:function(t){!0===this.stopGame&&(t=0);var i=t*this.simulationSpeed;console.log(i);for(var e=0;e<Math.round(i);e++)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dropDumpDistances[s][o]>0&&(console.log("Detected cells with distance needed greater than 0"),"idle"===this.dumpPuyoStates[s][o]||"checkDrops"===this.dumpPuyoStates[s][o]?this.dumpPuyoStates[s].splice(o,1,"dropping"):"dropping"===this.dumpPuyoStates[s][o]?this.dumpDisplay[s][o].y+this.dumpVelocity[s][o]<this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight?(console.log("dropping dumps"),this.dumpDisplay[s][o].y+=this.dumpVelocity[s][o],this.dumpVelocity[s][o]+=.703125):(console.log("dump bounce state"),this.dumpPuyoStates[s].splice(o,1,"bouncing"),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight+this.Field.cellHeight/2,this.dumpDisplay[s][o].anchor.set(.5,1)):"bouncing"===this.dumpPuyoStates[s][o]&&(this.dumpCellTimer[s][o]+=1,this.dumpCellTimer[s][o]<=8?(this.dumpDisplay[s][o].scale.y-=.025,this.dumpDisplay[s][o].scale.x+=.025):this.dumpCellTimer[s][o]<=16?(this.dumpDisplay[s][o].scale.y+=.025,this.dumpDisplay[s][o].scale.x-=.025):(console.log("it is no more."),this.dumpDisplay[s][o].anchor.set(.5,.5),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight,this.dumpPuyoStates[s].splice(o,1,"checkPops"),this.droppingDumpCells[s].splice(o,1,!1),this.dropDumpDistances[s].splice(o,1,0),this.dumpCellTimer[s].splice(o,1,0),this.dumpVelocity[s].splice(o,1,3.75))));!1===this.stopGame&&(this.frame+=1)},animatePopPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)!0===this.poppingCells[o][a]?(this.puyoStates[o].splice(a,1,"popping"),Math.cos(i/3*Math.PI)>=0?this.puyoDisplay[o][a].alpha=1:this.puyoDisplay[o][a].alpha=0,this.cellTimer[o][a]+=1,this.cellTimer[o][a]>=24&&(console.log("need to finish popping"),this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0))):(this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0));!1===this.stopGame&&(this.frame+=1)},animateCursors:function(t){for(var i=this.timers.cursor,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)Math.cos(i/60*Math.PI)>=0?this.cursorDisplay[e][s].scale.set(.9,.9):this.cursorDisplay[e][s].scale.set(1,1);this.timers.cursor+=t},setDropData:function(){for(var t=o.a.Simulate.dropPuyos(this.Field),i=[],e=0;e<this.Field.totalRows;e++){i[e]=[];for(var s=0;s<this.Field.columns;s++)t.dropDistances[e][s]>0?i[e][s]=!0:i[e][s]=!1}this.droppingCells=i,this.dropDistances=t.dropDistances,this.dropPuyosResult=o.a.mapToStringArray(t.dropResult)},setPopData:function(){var t=o.a.Simulate.clearPuyos(this.Field);this.poppingCells=t.animationMatrix,this.clearPuyosResult=o.a.mapToStringArray(t.newField.map),0!==t.popData.poppingGroups.length?this.calculateScore(t.popData):this.gameState="chainStopped"},mergeInShadowLayer:function(t){for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)"0"!==this.shadowData[i][e]&&this.shadowData[i][e]!==this.fieldData[i][e]&&(this.fieldData[i].splice(e,1,this.shadowData[i][e]),!0===t&&(console.log("Replacing old shadow puyo forever..."),this.shadowData[i].splice(e,1,"0"),this.updateShadowSprite(e,i)));this.updatePuyoSprites(),console.log("merged shadow layer")},setMouseDown:function(t){this.isMouseDown=t},controlField:function(t){if("reset"===t){for(var i in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[i]=0;this.resetField()}else if("back"===t)console.log("I didn't make a function for back yet.");else if("pause"===t)this.chainAutoPlay=!1;else if("play"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!1),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||(this.simulationSpeed=24),this.playStep();else if("auto"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!1),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||8!==this.simulationSpeed?"popping"===this.gameState||"dropping"===this.gameState?this.simulationSpeed=8:"chainStopped"===this.gameState&&(this.simulationSpeed=1):this.simulationSpeed=24,this.playChain();else if("edit"===t)"editor"!==this.gameState?(this.ticker.add(this.openToolbox),this.ticker.remove(this.closeToolbox),this.gameState="editor",this.fieldDisplay.editBubble.visible=!0):"editor"===this.gameState&&(this.gameState="idle",this.ticker.remove(this.openToolbox),this.ticker.add(this.closeToolbox));else if("empty"===t){for(var e in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[e]=0;this.emptyField()}},resetField:function(){var t=this;this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=t.fieldOriginal,t.needToReset=!1})},emptyField:function(){var t=this;this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.updatePuyoSprites(),t.shadowData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.cursorData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.arrowData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns);for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);t.needToReset=!1})},calculateScore:function(t){this.chainLength+=1;var i=Object(s.a)(new Set(t.poppingColors));console.log(i);for(var e=this.fieldSettings.colorBonus[i.length-1],o=this.fieldSettings.chainPower[this.chainLength-1],a=0,r=0,n=0;n<t.poppingGroups.length;n++){var l=t.poppingGroups[n].length;r+=l,a+=l>=11?this.fieldSettings.groupBonus[this.fieldSettings.groupBonus.length-1]:this.fieldSettings.groupBonus[l-4]}var h=o+e+a;h<1?h=1:h>999&&(h=999),this.stepScore=10*r*h,this.score+=this.stepScore,this.calculateGarbage()},calculateGarbage:function(){this.garbagePoints=this.stepScore/this.fieldSettings.targetPoint+this.leftoverGarbagePoints,this.stepGarbage=Math.floor(this.garbagePoints),this.leftoverGarbagePoints=this.garbagePoints-this.stepGarbage,this.garbage+=this.stepGarbage},animateChainCounter:function(t){var i=this.timers.chainLength;this.timers.chainLength+=t,this.timers.chainLength<=30?(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY-16*(-1/225*Math.pow(i-15,2)+1)):(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.remove(this.animateChainCounter),console.log("counter bounce over"))},animateGarbageTray:function(t){var i=this.timers.garbageTray,e=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;if(i<8){for(var s=0;s<6;s++)this.garbageDisplay[s].x=this.garbageDisplay[s].x+(this.garbageDisplay[s].origX-e)/8;for(var o=0;o<3;o++)this.garbageDisplay[o].x<this.garbageDisplay.origX&&(this.garbageDisplay[o].x=this.garbageDisplay.origX);for(var a=3;a<6;a++)this.garbageDisplay[a].x>this.garbageDisplay.origX&&(this.garbageDisplay[a].x=this.garbageDisplay.origX);this.timers.garbageTray+=1}else this.ticker.remove(this.animateGarbageTray),console.log("removed garbage tray animation")},animateArrows:function(t){for(var i=this.timers.arrow,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)"R"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x+8*Math.cos(i/60*Math.PI)),"L"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x-8*Math.cos(i/60*Math.PI)),"U"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y-8*Math.cos(i/60*Math.PI)),"D"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y+8*Math.cos(i/60*Math.PI));this.timers.arrow+=t},animateNextPuyos:function(t){var i=this.timers.next;if(this.nextPuyoPairs[0].y=this.nextCoord[0].y-(this.nextCoord[0].y-106)/8*i,this.nextPuyoPairs[1].x=this.nextCoord[1].x-(this.nextCoord[1].x-this.nextCoord[0].x)/8*i,this.nextPuyoPairs[1].y=this.nextCoord[1].y-(this.nextCoord[1].y-this.nextCoord[0].y)/8*i,this.nextPuyoPairs[1].scale.set(.8+.025*i,.8+.025*i),this.nextPuyoPairs[2].y=this.nextCoord[2].y-(this.nextCoord[2].y-this.nextCoord[1].y)/8*i,i>=8)return this.ticker.remove(this.animateNextPuyos),this.nextQueuePosition+=2,this.timers.next=0,this.updateNextPuyoSprites(),this.updateDumpDisplay(),this.setDumpMatrixDropData(),this.needToChangeSlides=!0,void this.controlField("play");this.timers.next+=1},playStep:function(){"idle"===this.gameState?(this.chainAutoPlay=!1,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!1,this.gameState="dropping")},playChain:function(){"idle"===this.gameState?(this.chainAutoPlay=!0,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!0,this.gameState="dropping")},setDumpMatrixDropData:function(){for(var t=new o.a.Field({columns:6,visibleRows:12,hiddenRows:14,totalRows:26,puyoToClear:4},this.combinedMatrix),i=o.a.Simulate.dropPuyos(t),e=[],s=0;s<this.Field.totalRows;s++){e[s]=[];for(var a=0;a<this.Field.columns;a++)i.dropDistances[s][a]>0?e[s][a]=!0:e[s][a]=!1}for(var r=[],n=0;n<this.Field.totalRows;n++){r[n]=[];for(var l=0;l<this.Field.columns;l++)r[n][l]=i.dropDistances[n][l]}this.droppingDumpCells=e,this.dropDumpDistances=r},updateWithNextSlide:function(){console.log("Updating with next slide"),this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.gameState="idle",this.shadowData=l(this.importedData[this.currentSlide+1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.importedData[this.currentSlide+1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.importedData[this.currentSlide+1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide+=1;for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.updateShadowSprite(i,t),this.updateCursorSprite(i,t),this.updateArrowSprite(i,t)},prevSlide:function(){if(this.currentSlide>0&&"idle"===this.gameState){this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.importedData[this.currentSlide-1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition-=2;for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.dumpDisplay[t][i].visible=!1;this.shadowData=l(this.importedData[this.currentSlide-1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.importedData[this.currentSlide-1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.importedData[this.currentSlide-1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide-=1,this.updatePuyoSprites(),this.updateNextPuyoSprites();for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)this.updateShadowSprite(s,e),this.updateCursorSprite(s,e),this.updateArrowSprite(s,e)}},nextSlide:function(){this.currentSlide<this.importedData.length-1&&"idle"===this.gameState?(this.fieldData=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),this.ticker.add(this.animateNextPuyos)):console.log("No more slides")},countGarbage:function(t,i){this.checkCrown(t,i)},checkCrown:function(t,i){i<6&&(t-720>=0?(this.garbageIcons.splice(i,1,"crown"),this.checkCrown(t-720,i+1)):this.checkMoon(t,i))},checkMoon:function(t,i){i<6&&(t-360>=0?(this.garbageIcons.splice(i,1,"moon"),this.checkStar(t-360,i+1)):this.checkStar(t,i))},checkStar:function(t,i){i<6&&(t-180>=0?(this.garbageIcons.splice(i,1,"star"),this.checkRock(t-180,i+1)):this.checkRock(t,i))},checkRock:function(t,i){i<6&&(t-30>=0?(this.garbageIcons.splice(i,1,"rock"),this.checkRock(t-30,i+1)):this.checkLine(t,i))},checkLine:function(t,i){i<6&&(t-6>=0?(this.garbageIcons.splice(i,1,"line"),this.checkLine(t-6,i+1)):this.checkUnit(t,i))},checkUnit:function(t,i){i<6&&t-1>=0&&(this.garbageIcons.splice(i,1,"unit"),this.checkUnit(t-1,i+1))}},computed:{chainDiff:function(){if(void 0!==this.importedData){for(var t=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),i=l(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),e=[],s=0;s<this.fieldSettings.totalRows;s++){e[s]=[];for(var a=0;a<this.fieldSettings.columns;a++)"0"===t[s][a]&&"0"!==i[s][a]?e[s][a]=i[s][a]:e[s][a]="0"}var r=new o.a.Field(this.fieldSettings,e);return o.a.mapToStringArray(o.a.Simulate.dropPuyos(r).dropResult)}return n("0",this.fieldSettings.totalRows,this.fieldSettings.columns)},combinedMatrix:function(){for(var t=JSON.parse(JSON.stringify(this.chainDiff)),i=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),e=0;e<this.Field.totalRows;e++)t.push(i[e]);return t},Field:function(){return new o.a.Field(this.fieldSettings,this.fieldData)},coordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124}}return t},dumpCoordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124-60*this.Field.totalRows}}return t},isPopping:function(){if(this.poppingCells.length===this.Field.totalRows&&this.poppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.poppingCells[t][i])return!0;return!1},isDropping:function(){if(this.droppingCells.length===this.Field.totalRows&&this.droppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.droppingCells[t][i])return!0;if(!0===this.needToChangeSlides&&this.droppingDumpCells.length===this.Field.totalRows&&this.droppingDumpCells[0].length===this.Field.columns)for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)if(!0===this.droppingDumpCells[e][s])return!0;return!1},Easers:function(){return{editBubble:BezierEasing(.14,.18,0,1.16)}},fieldDataString:function(){return h(this.fieldData).join("")},shadowDataString:function(){return h(this.shadowData).join("")},cursorDataString:function(){return h(this.cursorData).join("")},arrowDataString:function(){return h(this.arrowData).join("")},scoreString:function(){var t=this.score.toString(),i=8-t.length;if(t.length>8)return"99999999";for(var e=0;e<i;e++)t="0"+t;return t},chainLengthString:function(){var t=this.chainLength.toString();return t.length<2&&(t="0"+t),t},inFocus:function(){return void 0!==this.showModal?!0===this.showModal?(console.log("Chainsim entering focus."),!0):(console.log("Chainsim exiting focus"),!1):(console.log("Show modal undefined"),!1)}},watch:{gameState:function(t,i){var e=this;if(this.frame=0,"dropping"===t?(console.log("Checking drops"),this.setDropData(),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),!1===this.isDropping&&(!0===this.needToChangeSlides?this.updateWithNextSlide():this.gameState="popping")):"popping"===t?(console.log("Checking pops"),this.setPopData(),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites()):"idle"===t&&this.ticker.addOnce(function(){console.log("resetting field"),e.updatePuyoSprites();for(var t=0;t<e.Field.totalRows;t++)for(var i=0;i<e.Field.columns;i++)e.dumpDisplay[t][i].visible=!1}),"idle"===t||"editor"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.shadowDisplay[s][o].visible=!0,this.cursorDisplay[s][o].visible=!0,this.arrowDisplay[s][o].visible=!0;else for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.shadowDisplay[a][r].visible=!1,this.cursorDisplay[a][r].visible=!1,this.arrowDisplay[a][r].visible=!1},isPopping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):(this.fieldData=this.clearPuyosResult,console.log("set cleared puyo field"),this.gameState="dropping"))},isDropping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):void 0!==this.importedData&&this.currentSlide<this.importedData.length-1&&!0===this.needToChangeSlides?!0===this.importedData[this.currentSlide+this.slideChange].autoDrop&&this.updateWithNextSlide():(this.fieldData=this.dropPuyosResult,console.log("Dropped the new puyo field"),this.updatePuyoSprites(),!0===this.chainAutoPlay?this.gameState="popping":(this.simulationSpeed=1,this.gameState="chainStopped")))},needToChangeSlides:function(t,i){if(!0===t)for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)this.shadowDisplay[e][s].visible=!1,this.cursorDisplay[e][s].visible=!1,this.arrowDisplay[e][s].visible=!1},chainLength:function(){this.ticker.remove(this.animateChainCounter),this.timers.chainLength=0,this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.add(this.animateChainCounter)},garbage:function(){this.ticker.remove(this.animateGarbageTray),this.timers.garbageTray=0;for(var t=0;t<6;t++)this.garbageDisplay[t].x=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;this.garbageIcons=["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],this.countGarbage(this.garbage,0),console.log(this.garbageDisplay);for(var i=0;i<6;i++)this.garbageDisplay[i].texture=this.puyoSprites["".concat(this.garbageIcons[i],".png")];this.ticker.add(this.animateGarbageTray)},scoreString:function(){if(!0===this.gameLoaded)for(var t=0;t<8;t++)this.scoreDisplay[t].texture=this.fieldSprites["score_".concat(this.scoreString[t],".png")]},chainLengthString:function(){this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText.alpha=0,"0"!==this.chainLengthString[0]?(this.chainCounterDisplay.firstDigit.alpha=1,this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[0],".png")]):this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["spacer.png"],this.chainLength>0?(this.chainCounterDisplay.secondDigit.alpha=1,this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[1],".png")],this.chainCounterDisplay.chainText.alpha=1):this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["spacer.png"]}}},v=(e(205),e(1)),b=Object(v.a)(S,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"game-container"},[e("div",{ref:"game",attrs:{id:"game"}})]),t._v(" "),t.gameLoaded?e("div",t._l(t.fieldControls,function(i,s){return e("chainsim-control-button",{key:"Control_"+s,attrs:{gameLoaded:t.gameLoaded,fieldSprites:t.fieldSprites,button:i,buttonName:s},on:{controlField:t.controlField}})})):t._e()])},[],!1,null,null,null);b.options.__file="Chainsim.vue";i.default=b.exports}}]);