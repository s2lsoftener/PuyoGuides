(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{131:function(t,i,e){"use strict";var s={Puyo:{None:"0",Red:"R",Green:"G",Blue:"B",Yellow:"Y",Purple:"P",Nuisance:"J",Point:"T",Sun:"S",Hard:"H",Iron:"I",Block:"L"}},o=function(t,i,e){this.puyo=t,this.x=i,this.y=e,this.newY=e,this.yDiff=this.newY-this.y,this.toPop=!1,this.toDrop=!1,this.vy=0,this.accel=.703125};o.prototype={isColoredPuyo:function(){return this.puyo===s.Puyo.Red||this.puyo===s.Puyo.Green||this.puyo===s.Puyo.Blue||this.puyo===s.Puyo.Yellow||this.puyo===s.Puyo.Purple},checkSides:function(t){var i=[];return this.x>0&&t.map[this.y][this.x].puyo===t.map[this.y][this.x-1].puyo&&i.push(t.map[this.y][this.x-1]),this.y>t.hiddenRows&&t.map[this.y][this.x].puyo===t.map[this.y-1][this.x].puyo&&i.push(t.map[this.y-1][this.x]),this.x<t.columns-1&&t.map[this.y][this.x].puyo===t.map[this.y][this.x+1].puyo&&i.push(t.map[this.y][this.x+1]),this.y<t.totalRows-1&&t.map[this.y][this.x].puyo===t.map[this.y+1][this.x].puyo&&i.push(t.map[this.y+1][this.x]),i},adjacentPuyos:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo!==s.Puyo.Red&&i[o].puyo!==s.Puyo.Green&&i[o].puyo!==s.Puyo.Blue&&i[o].puyo!==s.Puyo.Yellow&&i[o].puyo!==s.Puyo.Purple||e.push(i[o]);return e},adjacentNuisance:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo===s.Puyo.Nuisance&&e.push(i[o]);return e}};var a={Constants:s,Puyo:o,Field:function(t,i){var e,a;this.visibleRows=t.visibleRows,this.columns=t.columns,this.hiddenRows=t.hiddenRows,this.totalRows=t.visibleRows+t.hiddenRows,this.cellWidth=64,this.cellHeight=60,this.puyoToClear=4,this.fieldWidthPx=this.cellWidth*(this.columns+2),this.fieldHeightPx=this.cellHeight*(this.visibleRows+this.hiddenRows+2),e=i.length>=this.totalRows?this.totalRows:i.length,a=i[0].length>=this.columns?this.columns:i[0].length;var r=i.length-this.totalRows;if(void 0!==i){this.map=[];for(var l=0;l<i.length;l++){this.map[l]=[];for(var n=0;n<i[l].length;n++)this.map[l][n]=new o(s.Puyo.None,n,l)}for(var h=e-1;h>=r||h>=0;h--)for(var p=0;p<a;p++)this.map[h][p]=new o(i[h][p],p,h)}else{this.map=[];for(var d=0;d<i.length;d++){this.map[d]=[];for(var u=0;u<i[d].length;u++)this.map[d][u]=new o(s.Puyo.None,u,d)}}},Simulate:{filterColors:function(t,i,e){return e.indexOf(t===i)},checkPops:function(t){for(var i=[],e=0;e<t.totalRows;e++){i[e]=[];for(var s=0;s<t.columns;s++)i[e][s]=!1}for(var o=[],a=[],r=t.hiddenRows;r<t.totalRows;r++)for(var l=0;l<t.columns;l++)if(t.map[r][l].isColoredPuyo()&&!1===i[r][l]){i[r][l]=!0;var n=[];n.push(t.map[r][l]);for(var h=0;h<n.length;h++)for(var p=n[h].checkSides(t),d=0;d<p.length;d++){var u=p[d];u.puyo===n[h].puyo&&!1===i[u.y][u.x]&&(i[u.y][u.x]=!0,n.push(u))}n.length>=t.puyoToClear&&(o.push(n),a.push(n[0].puyo))}return{poppingGroups:o,poppingColors:a.filter(this.filterColors)}},checkGarbagePops:function(t,i){for(var e=[],o=0;o<t.totalRows;o++){e[o]=[];for(var a=0;a<t.columns;a++)e[o][a]=!1}if(i.poppingGroups.length>0){var r=i.poppingGroups,l=[];for(var n in r)for(var h in r[n]){var p=r[n][h].x,d=r[n][h].y;d>0&&t.map[d-1][p].puyo===s.Puyo.Nuisance&&!1===e[d-1][p]&&(e[d-1][p]=!0,l.push(t.map[d-1][p])),p>0&&t.map[d][p-1].puyo===s.Puyo.Nuisance&&!1===e[d][p-1]&&(e[d][p-1]=!0,l.push(t.map[d][p-1])),p<t.columns-1&&t.map[d][p+1].puyo===s.Puyo.Nuisance&&!1===e[d][p+1]&&(e[d][p+1]=!0,l.push(t.map[d][p+1])),d<t.visibleRows+t.hiddenRows-1&&t.map[d+1][p].puyo===s.Puyo.Nuisance&&!1===e[d+1][p]&&(e[d+1][p]=!0,l.push(t.map[d+1][p]))}return l}return[]},clearPuyos:function(t){for(var i=JSON.parse(JSON.stringify(t)),e=this.checkPops(t),a=this.checkGarbagePops(t,e),r=[],l=0;l<t.totalRows;l++){r[l]=[];for(var n=0;n<t.columns;n++)r[l][n]=!1}if(e.poppingGroups.length>0){var h=e.poppingGroups;for(var p in h)for(var d in h[p]){var u=h[p][d].x,c=h[p][d].y;h[p][d].toPop=!0,i.map[c][u]=new o(s.Puyo.None,u,c),r[c][u]=!0}}if(a.length>0)for(var y in a){var g=a[y].x,f=a[y].y;a[y].toPop=!0,i.map[f][g]=new o(s.Puyo.None,g,f),r[f][g]=!0}return{newField:i,popData:e,garbageToClear:a,animationMatrix:r}},dropPuyos:function(t){for(var i=[],e=0;e<t.totalRows;e++)i[e]=[];for(var a=0;a<t.columns;a++){for(var r=[],l=t.totalRows-1;l>=0;l--)r.push(t.map[l][a]);for(var n=[],h=0;h<r.length;h++)r[h].puyo!==s.Puyo.None&&n.push(r[h]);for(var p=[],d=0;d<n.length;d++)if(n[d].puyo===s.Puyo.Block){var u=t.totalRows-1-n[d].y;if(p.length<u){var c=new o(s.Puyo.None,a,t.totalRows-1-p.length);p.push(c),d-=1}else p.push(n[d])}else p.push(n[d]);for(var y=p.length;y<t.totalRows;y++){var g=new o(s.Puyo.None,a,t.totalRows-1-p.length);p.push(g)}p.reverse();for(var f=0;f<p.length;f++)i[f][a]=p[f]}for(var m=0;m<i.length;m++)for(var D=0;D<i[m].length;D++)i[m][D].newY=m,i[m][D].yDiff=i[m][D].newY-i[m][D].y;for(var v=[],w=[],S=0;S<t.totalRows;S++){v[S]=[],w[S]=[];for(var P=0;P<t.columns;P++)v[S][P]=i[S][P],w[S][P]=t.map[S][P].yDiff}return{dropResult:v,dropDistances:w}}},mapToStringArray:function(t){for(var i=[],e=0;e<t.length;e++){i[e]=[];for(var s=0;s<t[0].length;s++)i[e][s]=t[e][s].puyo}return i},stringTo2dArray:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t[6*o+a]}return s},uniformMatrix:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t}return s},flatten2dTo1d:function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[0].length;s++)i.push(t[e][s]);return i}};i.a=a},136:function(t,i,e){"use strict";(function(t){e(138);var i,s=e(62);!function(i){if("object"===("undefined"==typeof exports?"undefined":Object(s.a)(exports))&&void 0!==t)t.exports=i();else if("function"==typeof define&&e(139))define([],i);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).BezierEasing=i()}}(function(){return function(){return function t(e,s,o){function a(l,n){if(!s[l]){if(!e[l]){if(!n&&"function"==typeof i&&i)return i(l,!0);if(r)return r(l,!0);var h=new Error("Cannot find module '"+l+"'");throw h.code="MODULE_NOT_FOUND",h}var p=s[l]={exports:{}};e[l][0].call(p.exports,function(t){return a(e[l][1][t]||t)},p,p.exports,t,e,s,o)}return s[l].exports}for(var r="function"==typeof i&&i,l=0;l<o.length;l++)a(o[l]);return a}}()({1:[function(t,i,e){var s=4,o=.001,a=1e-7,r=10,l=11,n=1/(l-1),h="function"==typeof Float32Array;function p(t,i){return 1-3*i+3*t}function d(t,i){return 3*i-6*t}function u(t){return 3*t}function c(t,i,e){return((p(i,e)*t+d(i,e))*t+u(i))*t}function y(t,i,e){return 3*p(i,e)*t*t+2*d(i,e)*t+u(i)}function g(t){return t}i.exports=function(t,i,e,p){if(!(0<=t&&t<=1&&0<=e&&e<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===i&&e===p)return g;for(var d=h?new Float32Array(l):new Array(l),u=0;u<l;++u)d[u]=c(u*n,t,e);function f(i){for(var h=0,p=1,u=l-1;p!==u&&d[p]<=i;++p)h+=n;var g=h+(i-d[--p])/(d[p+1]-d[p])*n,f=y(g,t,e);return f>=o?function(t,i,e,o){for(var a=0;a<s;++a){var r=y(i,e,o);if(0===r)return i;i-=(c(i,e,o)-t)/r}return i}(i,g,t,e):0===f?g:function(t,i,e,s,o){var l,n,h=0;do{(l=c(n=i+(e-i)/2,s,o)-t)>0?e=n:i=n}while(Math.abs(l)>a&&++h<r);return n}(i,h,h+n,t,e)}return function(t){return 0===t?0:1===t?1:c(f(t),i,p)}}},{}]},{},[1])(1)})}).call(this,e(137)(t))},147:function(t,i,e){},199:function(t,i){var e={Puyo:{None:"0",Red:"R",Green:"G",Blue:"B",Yellow:"Y",Purple:"P",Nuisance:"J",Point:"T",Sun:"S",Hard:"H",Iron:"I",Block:"L"}},s=function(t,i,e){this.puyo=t,this.x=i,this.y=e,this.newY=e,this.yDiff=this.newY-this.y,this.toPop=!1,this.toDrop=!1,this.vy=0,this.accel=.703125};s.prototype={isColoredPuyo:function(){return this.puyo===e.Puyo.Red||this.puyo===e.Puyo.Green||this.puyo===e.Puyo.Blue||this.puyo===e.Puyo.Yellow||this.puyo===e.Puyo.Purple},checkSides:function(t){var i=[];return this.x>0&&t.map[this.y][this.x].puyo===t.map[this.y][this.x-1].puyo&&i.push(t.map[this.y][this.x-1]),this.y>t.hiddenRows&&t.map[this.y][this.x].puyo===t.map[this.y-1][this.x].puyo&&i.push(t.map[this.y-1][this.x]),this.x<t.columns-1&&t.map[this.y][this.x].puyo===t.map[this.y][this.x+1].puyo&&i.push(t.map[this.y][this.x+1]),this.y<t.totalRows-1&&t.map[this.y][this.x].puyo===t.map[this.y+1][this.x].puyo&&i.push(t.map[this.y+1][this.x]),i},adjacentPuyos:function(t){for(var i=this.checkSides(t),s=[],o=0;o<i.length;o++)i[o].puyo!==e.Puyo.Red&&i[o].puyo!==e.Puyo.Green&&i[o].puyo!==e.Puyo.Blue&&i[o].puyo!==e.Puyo.Yellow&&i[o].puyo!==e.Puyo.Purple||s.push(i[o]);return s},adjacentNuisance:function(t){for(var i=this.checkSides(t),s=[],o=0;o<i.length;o++)i[o].puyo===e.Puyo.Nuisance&&s.push(i[o]);return s}};var o={Constants:e,Puyo:s,Field:function(t,i){var o,a;this.visibleRows=t.visibleRows,this.columns=t.columns,this.hiddenRows=t.hiddenRows,this.totalRows=t.visibleRows+t.hiddenRows,this.cellWidth=64,this.cellHeight=60,this.puyoToClear=4,this.fieldWidthPx=this.cellWidth*(this.columns+2),this.fieldHeightPx=this.cellHeight*(this.visibleRows+this.hiddenRows+2),o=i.length>=this.totalRows?this.totalRows:i.length,a=i[0].length>=this.columns?this.columns:i[0].length;var r=i.length-this.totalRows;if(void 0!==i){this.map=[];for(var l=0;l<i.length;l++){this.map[l]=[];for(var n=0;n<i[l].length;n++)this.map[l][n]=new s(e.Puyo.None,n,l)}for(var h=o-1;h>=r||h>=0;h--)for(var p=0;p<a;p++)this.map[h][p]=new s(i[h][p],p,h)}else{this.map=[];for(var d=0;d<i.length;d++){this.map[d]=[];for(var u=0;u<i[d].length;u++)this.map[d][u]=new s(e.Puyo.None,u,d)}}},Simulate:{filterColors:function(t,i,e){return e.indexOf(t===i)},checkPops:function(t){for(var i=[],e=0;e<t.totalRows;e++){i[e]=[];for(var s=0;s<t.columns;s++)i[e][s]=!1}for(var o=[],a=[],r=t.hiddenRows;r<t.totalRows;r++)for(var l=0;l<t.columns;l++)if(t.map[r][l].isColoredPuyo()&&!1===i[r][l]){i[r][l]=!0;var n=[];n.push(t.map[r][l]);for(var h=0;h<n.length;h++)for(var p=n[h].checkSides(t),d=0;d<p.length;d++){var u=p[d];u.puyo===n[h].puyo&&!1===i[u.y][u.x]&&(i[u.y][u.x]=!0,n.push(u))}n.length>=t.puyoToClear&&(o.push(n),a.push(n[0].puyo))}return{poppingGroups:o,poppingColors:a.filter(this.filterColors)}},checkGarbagePops:function(t,i){for(var s=[],o=0;o<t.totalRows;o++){s[o]=[];for(var a=0;a<t.columns;a++)s[o][a]=!1}if(i.poppingGroups.length>0){var r=i.poppingGroups,l=[];for(var n in r)for(var h in r[n]){var p=r[n][h].x,d=r[n][h].y;d>0&&t.map[d-1][p].puyo===e.Puyo.Nuisance&&!1===s[d-1][p]&&(s[d-1][p]=!0,l.push(t.map[d-1][p])),p>0&&t.map[d][p-1].puyo===e.Puyo.Nuisance&&!1===s[d][p-1]&&(s[d][p-1]=!0,l.push(t.map[d][p-1])),p<t.columns-1&&t.map[d][p+1].puyo===e.Puyo.Nuisance&&!1===s[d][p+1]&&(s[d][p+1]=!0,l.push(t.map[d][p+1])),d<t.visibleRows+t.hiddenRows-1&&t.map[d+1][p].puyo===e.Puyo.Nuisance&&!1===s[d+1][p]&&(s[d+1][p]=!0,l.push(t.map[d+1][p]))}return l}return[]},clearPuyos:function(t){for(var i=JSON.parse(JSON.stringify(t)),o=this.checkPops(t),a=this.checkGarbagePops(t,o),r=[],l=0;l<t.totalRows;l++){r[l]=[];for(var n=0;n<t.columns;n++)r[l][n]=!1}if(o.poppingGroups.length>0){var h=o.poppingGroups;for(var p in h)for(var d in h[p]){var u=h[p][d].x,c=h[p][d].y;h[p][d].toPop=!0,i.map[c][u]=new s(e.Puyo.None,u,c),r[c][u]=!0}}if(a.length>0)for(var y in a){var g=a[y].x,f=a[y].y;a[y].toPop=!0,i.map[f][g]=new s(e.Puyo.None,g,f),r[f][g]=!0}return{newField:i,popData:o,garbageToClear:a,animationMatrix:r}},dropPuyos:function(t){for(var i=[],o=0;o<t.totalRows;o++)i[o]=[];for(var a=0;a<t.columns;a++){for(var r=[],l=t.totalRows-1;l>=0;l--)r.push(t.map[l][a]);for(var n=[],h=0;h<r.length;h++)r[h].puyo!==e.Puyo.None&&n.push(r[h]);for(var p=[],d=0;d<n.length;d++)if(n[d].puyo===e.Puyo.Block){var u=t.totalRows-1-n[d].y;if(p.length<u){var c=new s(e.Puyo.None,a,t.totalRows-1-p.length);p.push(c),d-=1}else p.push(n[d])}else p.push(n[d]);for(var y=p.length;y<t.totalRows;y++){var g=new s(e.Puyo.None,a,t.totalRows-1-p.length);p.push(g)}p.reverse();for(var f=0;f<p.length;f++)i[f][a]=p[f]}for(var m=0;m<i.length;m++)for(var D=0;D<i[m].length;D++)i[m][D].newY=m,i[m][D].yDiff=i[m][D].newY-i[m][D].y;for(var v=[],w=[],S=0;S<t.totalRows;S++){v[S]=[],w[S]=[];for(var P=0;P<t.columns;P++)v[S][P]=i[S][P],w[S][P]=t.map[S][P].yDiff}return{dropResult:v,dropDistances:w}}},mapToStringArray:function(t){for(var i=[],e=0;e<t.length;e++){i[e]=[];for(var s=0;s<t[0].length;s++)i[e][s]=t[e][s].puyo}return i},stringTo2dArray:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t[6*o+a]}return s},uniformMatrix:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t}return s},flatten2dTo1d:function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[0].length;s++)i.push(t[e][s]);return i}};t.exports=o},200:function(t,i,e){"use strict";var s=e(147);e.n(s).a},218:function(t,i,e){"use strict";e.r(i);e(135),e(13),e(17),e(83);var s=e(9),o=(e(134),e(129),e(131)),a=(e(136),e(199));var r=o.a.uniformMatrix,l=o.a.stringTo2dArray,n=o.a.flatten2dTo1d,h=PIXI.loader,p=PIXI.loader.resources,d=PIXI.Sprite,u=o.a.Constants.Puyo.Red,c=o.a.Constants.Puyo.Green,y=o.a.Constants.Puyo.Blue,g=o.a.Constants.Puyo.Yellow,f=o.a.Constants.Puyo.Purple,m=o.a.Constants.Puyo.Nuisance,D=o.a.Constants.Puyo.None,v={name:"ChainDrillMaker",props:["importedData","mersenneData","useRandomSeed","manualData","useManualData","slideText"],data:function(){return{fieldSettings:{columns:6,visibleRows:12,hiddenRows:1,totalRows:13,puyoToClear:4,colorBonus:[0,3,6,12,24],groupBonus:[0,2,3,4,5,6,7,10],chainPower:[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512,544,576,608,640,672],targetPoint:70},currentSlide:0,gameMode:"editor",gameState:"idle",gameData:void 0,gameReplay:!0,gamePlayable:!0,fieldData:[[]],fieldOriginal:[[]],fieldHistory:[],connectionData:[[]],colorNameData:[[]],shadowData:[[]],cursorData:[[]],arrowData:[[]],clearPuyosResult:[[]],dropPuyosResult:[[]],score:0,stepScore:0,garbage:0,stepGarbage:0,garbagePoints:0,leftoverGarbagePoints:0,chainLength:0,garbageIcons:["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],poppingCells:[[]],droppingCells:[[]],dropDistances:[[]],dropTimings:[[]],displayMode:"simple",modeSettings:{simple:{width:608,height:974,antialias:!0,transparent:!0,resolution:1},full:{width:872,height:854,antialias:!0,transparent:!1,resolution:1}},app:void 0,stage:void 0,renderer:void 0,ticker:void 0,interaction:void 0,scaleFactor:.45,texturesToLoad:["/img/arle_bg.png","/img/field.json","/img/puyo.json","/img/arrow.png","/img/arrow_x.png","/img/cursor.png","/img/cursor_x.png","/img/chain_font.json","/img/edit_bubble.png","/img/touch_disabler.png","/img/picker_arrow_left.png","/img/picker_arrow_right.png","/img/editor_x.png","/img/current_tool.png","/img/next_background_1p_mask.png","/img/rotate_container.png"],puyoSprites:{},fieldSprites:{},scoreSprites:{},chainCountSprites:{},puyoDisplay:[[]],dumpDisplay:[[]],shadowDisplay:[],scoreDisplay:[],garbageDisplay:[],cursorDisplay:[],arrowDisplay:[],chainCountDisplay:{},fieldDisplay:{},cellTimer:[[]],puyoStates:[[]],editorTools:[],editorSelectors:[],editorWindow:{},playCtrlDisplay:{},loadingText:"Loading...",texturesLoaded:!1,gameLoaded:!1,fieldControls:{},simulationSpeed:1,needToReset:!1,isMouseDown:!1,isMouseOver:!1,frame:0,delta:0,stopGame:!1,chainAutoPlay:!1,timers:{editBubble:0,toolIntroFade:0,chainLength:0,garbageTray:0,cursor:0,arrow:0,next:0},needToChangeSlides:!1,slideChange:1,onTrack:!0,changingSlideText:!1,editorCurrentTool:{page:0,item:6,puyo:"0",layer:"main",x:520,y:820},toolCursor:void 0,toolPage:0,nextPuyoData:"RRBGYYPP",nextPuyoPairs:[],nextQueuePosition:0,nextCoord:[{x:510,y:256},{x:556,y:376},{x:556,y:536}],nextPuyoSeed:void 0,controlPuyoData:[[]],controlPuyoSprites:[[]],activePair:{data:"00",axisPuyo:{x:2,y:13},freePuyo:{x:2,y:14}},activeMatrix:[["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","0","0","0","0"]],droppedPair:!1,colorSettings:{red:{hue:0,brightness:100,contrast:0,saturate:0},green:{hue:0,brightness:100,contrast:0,saturate:0},blue:{hue:0,brightness:100,contrast:0,saturate:0},yellow:{hue:0,brightness:100,contrast:0,saturate:0},purple:{hue:0,brightness:100,contrast:0,saturate:0},garbage:{hue:0,brightness:100,contrast:0,saturate:0}},colorFilters:{red:new PIXI.filters.ColorMatrixFilter,green:new PIXI.filters.ColorMatrixFilter,blue:new PIXI.filters.ColorMatrixFilter,yellow:new PIXI.filters.ColorMatrixFilter,purple:new PIXI.filters.ColorMatrixFilter,garbage:new PIXI.filters.ColorMatrixFilter},dumpCellContainer:void 0,droppingDumpCells:[[]],dropDumpDistances:[[]],mergedDump:!1,dumpVelocity:[[]],dumpPuyoStates:[[]],dumpCellTimer:[[]]}},mounted:function(){this.initData(),this.initGame()},methods:{initData:function(){!0===this.useManualData?(console.log("Using handmade color sequence"),this.nextPuyoData=this.manualData.nextQueue,this.nextPuyoSeed=this.manualData.seed,this.gameData=JSON.parse(JSON.stringify(this.importedData.fields))):!0===this.useRandomSeed?(console.log("Using chain seeed from mersenne output"),this.nextPuyoData=this.mersenneData.nextQueue,this.nextPuyoSeed=this.mersenneData.seed,this.gameData=JSON.parse(JSON.stringify(this.importedData.fields))):(console.log("Using imported chain seed."),this.nextPuyoData=this.importedData.next.nextQueue,this.nextPuyoSeed=this.importedData.next.seed,this.gameData=JSON.parse(JSON.stringify(this.importedData.fields))),this.fieldData=l(this.gameData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=l(this.gameData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=l(this.gameData[this.currentSlide].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.gameData[this.currentSlide].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.gameData[this.currentSlide].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.connectionData=r("n",this.fieldSettings.totalRows,this.fieldSettings.columns),this.colorNameData=r("spacer",this.fieldSettings.totalRows,this.fieldSettings.columns),this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=r("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=r("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=r("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=r("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=r(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns)},initGame:function(){var t=this;this.renderer=new PIXI.autoDetectRenderer(this.modeSettings.simple.width,this.modeSettings.simple.height,{antialias:!0,transparent:!0,resolution:1}),this.renderer.view.style.width="".concat(this.modeSettings.simple.width*this.scaleFactor,"px"),this.renderer.view.style.height="".concat(this.modeSettings.simple.height*this.scaleFactor,"px"),this.renderer.view.height=this.modeSettings.simple.height,this.$refs.game.appendChild(this.renderer.view),this.stage=new PIXI.Container,new Promise(function(t,i){setInterval(function(){h.progress<100?(console.log(h.progress),console.log("Chainsim says not loaded")):t("Chainsim Assets loaded...!")},50)}).then(function(i){console.log(i),t.runSetup()})},runSetup:function(){var t=this;if(localStorage.getItem("puyocolors"))try{this.colorSettings=JSON.parse(localStorage.getItem("puyocolors")),console.log("Found color settings in localStorage")}catch(t){console.log("Removing puyocolors from localStorage."),localStorage.removeItem("puyocolors"),console.log("Using default color settings instead."),this.colorSettings={red:{hue:0,brightness:100,contrast:0,saturate:0},green:{hue:0,brightness:100,contrast:0,saturate:0},blue:{hue:0,brightness:100,contrast:0,saturate:0},yellow:{hue:0,brightness:100,contrast:0,saturate:0},purple:{hue:0,brightness:100,contrast:0,saturate:0},garbage:{hue:0,brightness:100,contrast:0,saturate:0}}}this.texturesLoaded=!0,this.fieldSprites=p["/img/field.json"].textures,this.puyoSprites=p["/img/puyo.json"].textures,this.chainCountSprites=p["/img/chain_font.json"].textures,this.initFieldDisplay(),this.initScoreDisplay(),this.initGameOverX(),this.initShadowDisplay(),this.initPuyoDisplay(),this.initDumpDisplay(),this.initActivePair(),this.initCursorDisplay(),this.initArrowDisplay(),this.initGarbageDisplay(),this.initNextPuyos(),!1===this.gamePlayable?this.initFieldControls():this.initPlayControls(),this.initChainCounter(),this.initToolDisplay(),this.initKeyboardControls(),this.gameLoaded=!0,this.ticker=new PIXI.ticker.Ticker,this.ticker.add(function(i){return t.gameLoop(i)}),this.ticker.start(),this.dropActivePair()},initFieldDisplay:function(){this.fieldDisplay.charBG=new d(p["/img/arle_bg.png"].texture),this.fieldDisplay.charBG.x=17,this.fieldDisplay.charBG.y=183,this.stage.addChild(this.fieldDisplay.charBG),this.fieldDisplay.borderTop=new d(this.fieldSprites["field_border_top.png"]),this.fieldDisplay.borderTop.y=132,this.stage.addChild(this.fieldDisplay.borderTop),this.fieldDisplay.borderLeftTop=new d(this.fieldSprites["field_border_left_tophalf.png"]),this.fieldDisplay.borderLeftTop.y=184,this.stage.addChild(this.fieldDisplay.borderLeftTop),this.fieldDisplay.borderLeftBottom=new d(this.fieldSprites["field_border_left_bottomhalf.png"]),this.fieldDisplay.borderLeftBottom.y=536,this.stage.addChild(this.fieldDisplay.borderLeftBottom),this.fieldDisplay.borderRightTop=new d(this.fieldSprites["field_border_right_tophalf.png"]),this.fieldDisplay.borderRightTop.x=417,this.fieldDisplay.borderRightTop.y=184,this.stage.addChild(this.fieldDisplay.borderRightTop),this.fieldDisplay.borderRightBottom=new d(this.fieldSprites["field_border_right_bottomhalf.png"]),this.fieldDisplay.borderRightBottom.x=417,this.fieldDisplay.borderRightBottom.y=536,this.stage.addChild(this.fieldDisplay.borderRightBottom),this.fieldDisplay.borderBottom=new d(this.fieldSprites["field_border_bottom.png"]),this.fieldDisplay.borderBottom.y=902,this.stage.addChild(this.fieldDisplay.borderBottom),this.fieldDisplay.nextWindowBorder=new d(this.fieldSprites["next_border_1p.png"]),this.fieldDisplay.nextWindowBorder.x=456,this.fieldDisplay.nextWindowBorder.y=160,this.stage.addChild(this.fieldDisplay.nextWindowBorder),this.fieldDisplay.nextWindowInner=new d(this.fieldSprites["next_background_1p.png"]),this.fieldDisplay.nextWindowInner.x=456,this.fieldDisplay.nextWindowInner.y=160,this.stage.addChild(this.fieldDisplay.nextWindowInner),this.fieldDisplay.nextWindowMask=new d(p["/img/next_background_1p_mask.png"].texture),this.fieldDisplay.nextWindowMask.position.set(456,160),this.stage.addChild(this.fieldDisplay.nextWindowMask)},initScoreDisplay:function(){var t=150;"full"===this.displayMode?t=150:"simple"===this.displayMode&&(t=32);for(var i=[],e=0;e<8;e++)i[e]=new d(this.fieldSprites["score_0.png"]),i[e].anchor.set(.5),i[e].x=t+.9*i[e].width*e,i[e].y=935,this.stage.addChild(i[e]);this.scoreDisplay=i},initGameOverX:function(){this.fieldDisplay.redX=new d(this.puyoSprites["death_X.png"]),this.fieldDisplay.redX.anchor.set(.5),this.fieldDisplay.redX.x=this.coordArray[1][2].x,this.fieldDisplay.redX.y=this.coordArray[1][2].y,this.stage.addChild(this.fieldDisplay.redX)},initPuyoDisplay:function(){for(var t=this,i=[],e=0;e<this.Field.totalRows;e++){i[e]=[];for(var s=0;s<this.Field.columns;s++)i[e][s]=new d(this.puyoSprites["red_urdl.png"]),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.puyoDisplay=i;for(var o=this,a=function(i){for(var e=function(e){!1===t.gameReplay&&(t.puyoDisplay[i][e].interactive=!0),t.puyoDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(e,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][e]&&(o.shadowData[i].splice(e,1,"0"),o.updateShadowSprite(e,i)),o.updatePuyoSprites())},t.puyoDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(e,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][e]&&(o.shadowData[i].splice(e,1,"0"),o.updateShadowSprite(e,i)),o.updatePuyoSprites())},t.puyoDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.puyoDisplay[i][e].on("pointerdown",t.puyoDisplay[i][e].editPuyo),t.puyoDisplay[i][e].on("pointerover",t.puyoDisplay[i][e].mouseOver),t.puyoDisplay[i][e].on("pointerupoutside",t.puyoDisplay[i][e].mouseUp),t.puyoDisplay[i][e].on("pointerup",t.puyoDisplay[i][e].mouseUp)},s=0;s<t.Field.columns;s++)e(s)},r=0;r<this.Field.totalRows;r++)a(r);this.updatePuyoSprites()},updatePuyoSprites:function(){this.determineConnections(),this.determineColorNames();for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.puyoDisplay[t][i].x=this.coordArray[t][i].x,this.puyoDisplay[t][i].y=this.coordArray[t][i].y,"spacer"!==this.colorNameData[t][i]&&(this.puyoDisplay[t][i].filters=[this.colorFilters["".concat(this.colorNameData[t][i])]]),this.puyoDisplay[t][i].spritename="".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png"),this.puyoDisplay[t][i].texture=this.puyoSprites["".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png")],this.puyoDisplay[t][i].anchor.set(.5,.5),this.puyoDisplay[t][i].scale.set(1,1);!1===this.gameLoaded&&(this.colorFilters.red.hue(this.colorSettings.red.hue),this.colorFilters.green.hue(this.colorSettings.green.hue),this.colorFilters.blue.hue(this.colorSettings.blue.hue),this.colorFilters.yellow.hue(this.colorSettings.yellow.hue),this.colorFilters.purple.hue(this.colorSettings.purple.hue),this.colorFilters.garbage.hue(this.colorSettings.garbage.hue)),console.log("updated sprites")},updateShadowSprite:function(t,i){var e="";e=this.shadowData[i][t]===u?"red":this.shadowData[i][t]===c?"green":this.shadowData[i][t]===y?"blue":this.shadowData[i][t]===g?"yellow":this.shadowData[i][t]===f?"purple":this.shadowData[i][t]===m?"garbage":"spacer",this.shadowDisplay[i][t].texture=this.puyoSprites["".concat(e,"_n.png")],"spacer"!==e&&(this.shadowDisplay[i][t].filters=[this.colorFilters["".concat(e)]]),console.log("Updated the shadow sprite.")},updateCursorSprite:function(t,i){"1"===this.cursorData[i][t]?this.cursorDisplay[i][t].alpha=1:this.cursorDisplay[i][t].alpha=0},updateArrowSprite:function(t,i){"0"===this.arrowData[i][t]?this.arrowDisplay[i][t].alpha=0:"L"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=1.5*Math.PI):"R"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=.5*Math.PI):"D"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=Math.PI):"U"===this.arrowData[i][t]&&(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=0)},updateNextPuyoSprites:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer"),this.nextPuyoPairs[e].children[0].texture=this.puyoSprites["".concat(s,"_n.png")],this.nextPuyoPairs[e].children[1].texture=this.puyoSprites["".concat(o,"_n.png")]}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y)},determineConnections:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)if(i<this.Field.hiddenRows)t[i][e]="n";else if(this.dropDistances[i][e]>0)t[i][e]="n";else if(this.fieldData[i][e]===D||this.fieldData[i][e]===m)t[i][e]="n";else{var s={};s.up=!(i<=this.Field.hiddenRows)&&(this.fieldData[i][e]===this.fieldData[i-1][e]&&0===this.dropDistances[i-1][e]),s.left=0!==e&&(this.fieldData[i][e]===this.fieldData[i][e-1]&&0===this.dropDistances[i][e-1]),s.right=e!==this.Field.columns-1&&(this.fieldData[i][e]===this.fieldData[i][e+1]&&0===this.dropDistances[i][e+1]),s.down=i!==this.Field.totalRows-1&&(this.fieldData[i][e]===this.fieldData[i+1][e]&&0===this.dropDistances[i+1][e]);var o="";!0===s.up&&(o+="u"),!0===s.right&&(o+="r"),!0===s.down&&(o+="d"),!0===s.left&&(o+="l"),""===o&&(o="n"),t[i][e]=o}}return this.connectionData=t,t},determineColorNames:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)this.fieldData[i][e]===u?t[i][e]="red":this.fieldData[i][e]===c?t[i][e]="green":this.fieldData[i][e]===y?t[i][e]="blue":this.fieldData[i][e]===g?t[i][e]="yellow":this.fieldData[i][e]===f?t[i][e]="purple":this.fieldData[i][e]===m?t[i][e]="garbage":t[i][e]="spacer"}return this.colorNameData=t,t},initNextPuyos:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer");var a=new d(this.puyoSprites["".concat(s,"_n.png")]),r=new d(this.puyoSprites["".concat(o,"_n.png")]);a.y+=60,"spacer"!==s&&(a.filters=[this.colorFilters["".concat(s)]]),"spacer"!==o&&(r.filters=[this.colorFilters["".concat(o)]]),this.nextPuyoPairs[e]=new PIXI.Container,this.nextPuyoPairs[e].addChild(a),this.nextPuyoPairs[e].addChild(r),this.nextPuyoPairs[e].pivot.set(this.nextPuyoPairs[e].width/2,this.nextPuyoPairs[e].height/2),this.nextPuyoPairs[e].mask=this.fieldDisplay.nextWindowMask}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y),this.stage.addChild(this.nextPuyoPairs[0]),this.stage.addChild(this.nextPuyoPairs[1]),this.stage.addChild(this.nextPuyoPairs[2])},initGarbageDisplay:function(){if("full"===this.displayMode?(this.fieldDisplay.garbageTray=new d(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=456,this.fieldDisplay.garbageTray.y=480,this.stage.addChild(this.fieldDisplay.garbageTray)):"simple"===this.displayMode&&(this.fieldDisplay.garbageTray=new d(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=316,this.fieldDisplay.garbageTray.y=915,this.fieldDisplay.garbageTray.scale.set(.7,.7),this.stage.addChild(this.fieldDisplay.garbageTray)),"full"===this.displayMode){for(var t=[],i=0;i<this.Field.columns;i++)t[i]=new d(this.puyoSprites["spacer_n.png"]),t[i].x=468+t[i].width*i,t[i].origX=468+t[i].width*i,t[i].y=470,this.stage.addChild(t[i]);this.garbageDisplay=t}else if("simple"===this.displayMode){for(var e=[],s=0;s<this.Field.columns;s++)e[s]=new d(this.puyoSprites["spacer_n.png"]),e[s].scale.set(.7,.7),e[s].x=324+e[s].width*s,e[s].origX=324+e[s].width*s,e[s].y=910,this.stage.addChild(e[s]);this.garbageDisplay=e}},initFieldControls:function(){var t,i=this,e=0;this.fieldControls.reset=new d(this.fieldSprites["btn_reset.png"]),this.fieldControls.reset.x=452,this.fieldControls.reset.y=480,this.fieldControls.reset.interactive=!0,this.fieldControls.reset.buttonMode=!0,this.stage.addChild(this.fieldControls.reset),t=this.fieldControls.reset.height,this.fieldControls.pause=new d(this.fieldSprites["btn_pause.png"]),this.fieldControls.pause.x=528,this.fieldControls.pause.y=480+t*e,this.fieldControls.pause.interactive=!0,this.fieldControls.pause.buttonMode=!0,this.stage.addChild(this.fieldControls.pause),e+=1,this.fieldControls.play=new d(this.fieldSprites["btn_play.png"]),this.fieldControls.play.x=452,this.fieldControls.play.y=480+t*e,this.fieldControls.play.interactive=!0,this.fieldControls.play.buttonMode=!0,this.stage.addChild(this.fieldControls.play),this.fieldControls.auto=new d(this.fieldSprites["btn_auto.png"]),this.fieldControls.auto.x=528,this.fieldControls.auto.y=480+t*e,this.fieldControls.auto.interactive=!0,this.fieldControls.auto.buttonMode=!0,this.stage.addChild(this.fieldControls.auto),e+=1,this.fieldDisplay.disableTouchBehind=new d(p["/img/touch_disabler.png"].texture),this.fieldDisplay.disableTouchBehind.x=0,this.fieldDisplay.disableTouchBehind.y=0,this.fieldDisplay.disableTouchBehind.width=this.modeSettings.simple.width,this.fieldDisplay.disableTouchBehind.height=this.modeSettings.simple.height,this.stage.addChild(this.fieldDisplay.disableTouchBehind),this.fieldDisplay.disableTouchBehind.interactive=!1,this.fieldDisplay.disableTouchBehind.on("pointerdown",function(){i.controlField("edit")}),this.fieldControls.edit=new d(this.fieldSprites["btn_edit.png"]),this.fieldControls.edit.x=490,this.fieldControls.edit.y=480+e*this.fieldControls.edit.height,this.fieldControls.edit.interactive=!0,this.fieldControls.edit.buttonMode=!0,this.stage.addChild(this.fieldControls.edit)},initChainCounter:function(){this.chainCountSprites.firstDigit=new d(this.chainCountSprites["spacer.png"]),this.chainCountSprites.firstDigit.x=412,this.chainCountSprites.firstDigit.y=732,this.chainCountSprites.firstDigit.scale.set(.85,.85),this.chainCountSprites.secondDigit=new d(this.chainCountSprites["spacer.png"]),this.chainCountSprites.secondDigit.x=452,this.chainCountSprites.secondDigit.y=732,this.chainCountSprites.secondDigit.scale.set(.85,.85),this.chainCountSprites.chainText=new d(this.chainCountSprites["chain_text.png"]),this.chainCountSprites.chainText.x=496,this.chainCountSprites.chainText.y=742,this.chainCountSprites.chainText.scale.set(.85,.85),this.chainCountDisplay=new PIXI.Container,this.chainCountDisplay.addChild(this.chainCountSprites.firstDigit),this.chainCountDisplay.addChild(this.chainCountSprites.secondDigit),this.chainCountDisplay.addChild(this.chainCountSprites.chainText),this.chainCountDisplay.origY=this.chainCountDisplay.y,this.chainCountSprites.firstDigit.alpha=0,this.chainCountSprites.secondDigit.alpha=0,this.chainCountSprites.chainText.alpha=0,this.stage.addChild(this.chainCountDisplay)},initShadowDisplay:function(){for(var t=this,i=[],e="",s=0;s<this.fieldData.length;s++){i[s]=[];for(var o=0;o<this.fieldData[0].length;o++)e=this.shadowData[s][o]===u?"red":this.shadowData[s][o]===c?"green":this.shadowData[s][o]===y?"blue":this.shadowData[s][o]===g?"yellow":this.shadowData[s][o]===f?"purple":this.shadowData[s][o]===m?"garbage":"spacer",i[s][o]=new d(this.puyoSprites["".concat(e,"_n.png")]),i[s][o].anchor.set(.5),!0===this.gameReplay?i[s][o].alpha=.2:i[s][o].alpha=.4,i[s][o].x=this.coordArray[s][o].x,i[s][o].y=this.coordArray[s][o].y,"spacer"!==e&&(i[s][o].filters=[this.colorFilters["".concat(e)]]),this.stage.addChild(i[s][o])}this.shadowDisplay=i;for(var a=this,r=function(i){for(var e=function(e){t.updateShadowSprite(e,i),t.shadowDisplay[i][e].interactive=!1,t.shadowDisplay[i][e].editPuyo=function(){a.isMouseDown=!0,"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(e,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(e,1,"0"),a.updateShadowSprite(e,i),a.updatePuyoSprites())},t.shadowDisplay[i][e].mouseOver=function(){!0===a.isMouseDown&&"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(e,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(e,1,"0"),a.updateShadowSprite(e,i),a.updatePuyoSprites())},t.shadowDisplay[i][e].mouseUp=function(){a.isMouseDown=!1},t.shadowDisplay[i][e].on("pointerdown",t.shadowDisplay[i][e].editPuyo),t.shadowDisplay[i][e].on("pointerover",t.shadowDisplay[i][e].mouseOver),t.shadowDisplay[i][e].on("pointerupoutside",t.shadowDisplay[i][e].mouseUp),t.shadowDisplay[i][e].on("pointerup",t.shadowDisplay[i][e].mouseUp)},s=0;s<t.Field.columns;s++)e(s)},l=0;l<this.Field.totalRows;l++)r(l)},initActivePair:function(){for(var t=[],i=0;i<2;i++)switch(this.activePair.data[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}void 0===t[0]&&(t[0]="spacer"),void 0===t[1]&&(t[0]="spacer");var e=new d(this.puyoSprites["".concat(t[0],"_n.png")]),s=new d(this.puyoSprites["".concat(t[1],"_n.png")]);e.anchor.set(.5,.5),s.anchor.set(.5,.5),e.position.set(this.activeCoordArray[1][2].x,this.activeCoordArray[1][2].y),s.position.set(this.activeCoordArray[0][2].x,this.activeCoordArray[0][2].y),e.cellPos={x:2,y:1},s.cellPos={x:2,y:0},"spacer"!==t[0]&&(e.filters=[this.colorFilters["".concat(t[0])]]),"spacer"!==t[1]&&(s.filters=[this.colorFilters["".concat(t[1])]]),this.stage.addChild(e),this.stage.addChild(s),this.activePair.axisPuyo=e,this.activePair.freePuyo=s},updateActivePair:function(){this.activePair.data="".concat(this.nextPuyoData[this.nextQueuePosition-2]).concat(this.nextPuyoData[this.nextQueuePosition-1]);for(var t=this.activePair.axisPuyo,i=this.activePair.freePuyo,e=[],s=0;s<2;s++)switch(this.activePair.data[s]){case"R":e.push("red");break;case"G":e.push("green");break;case"B":e.push("blue");break;case"Y":e.push("yellow");break;case"P":e.push("purple");break;default:e.push("spacer")}void 0===e[0]&&(e[0]="spacer"),void 0===e[1]&&(e[0]="spacer"),"spacer"!==e[0]&&(t.filters=[this.colorFilters["".concat(e[0])]]),"spacer"!==e[1]&&(i.filters=[this.colorFilters["".concat(e[1])]]),t.visible=!0,i.visible=!0,t.cellPos={x:2,y:1},i.cellPos={x:2,y:0},t.position.set(this.activeCoordArray[1][2].x,this.activeCoordArray[1][2].y),i.position.set(this.activeCoordArray[0][2].x,this.activeCoordArray[0][2].y),t.texture=this.puyoSprites["".concat(e[0],"_n.png")],i.texture=this.puyoSprites["".concat(e[1],"_n.png")]},slideActivePair:function(t){var i=this.activePair.axisPuyo,e=this.activePair.freePuyo;"left"===t&&i.cellPos.x>0&&e.cellPos.x>0?(i.cellPos.x-=1,e.cellPos.x-=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x):"right"===t&&i.cellPos.x<this.Field.columns-1&&e.cellPos.x<this.Field.columns-1&&(i.cellPos.x+=1,e.cellPos.x+=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x)},rotateActivePair:function(t){var i=this.activePair.axisPuyo,e=this.activePair.freePuyo;"ccw"===t&&0===i.cellPos.x&&0===e.cellPos.x&&0===e.cellPos.y?(i.cellPos.x+=1,e.cellPos.y+=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):"ccw"===t&&i.cellPos.x===this.Field.columns-1&&e.cellPos.x===this.Field.columns-1&&2===e.cellPos.y?(i.cellPos.x-=1,e.cellPos.y-=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):"cw"===t&&0===i.cellPos.x&&0===e.cellPos.x&&2===e.cellPos.y?(i.cellPos.x+=1,e.cellPos.y-=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):"cw"===t&&i.cellPos.x===this.Field.columns-1&&e.cellPos.x===this.Field.columns-1&&0===e.cellPos.y?(i.cellPos.x-=1,e.cellPos.y+=1,i.x=this.activeCoordArray[i.cellPos.y][i.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):e.cellPos.y<i.cellPos.y?("ccw"===t?(e.cellPos.y+=1,e.cellPos.x-=1):"cw"===t&&(e.cellPos.y+=1,e.cellPos.x+=1),e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):e.cellPos.y===i.cellPos.y&&e.cellPos.x<i.cellPos.x?("ccw"===t?(e.cellPos.y+=1,e.cellPos.x+=1):"cw"===t&&(e.cellPos.y-=1,e.cellPos.x+=1),e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):e.cellPos.y===i.cellPos.y&&e.cellPos.x>i.cellPos.x?("ccw"===t?(e.cellPos.y-=1,e.cellPos.x-=1):"cw"===t&&(e.cellPos.y+=1,e.cellPos.x-=1),e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y):e.cellPos.y>i.cellPos.y&&("ccw"===t?(e.cellPos.y-=1,e.cellPos.x+=1):"cw"===t&&(e.cellPos.y-=1,e.cellPos.x-=1),e.x=this.activeCoordArray[e.cellPos.y][e.cellPos.x].x,e.y=this.activeCoordArray[e.cellPos.y][e.cellPos.x].y)},dropActivePair:function(){"idle"===this.gameState&&!1===this.droppedPair?(this.droppedPair=!0,console.log(this.gameData),this.currentSlide===this.gameData.length-1?this.gameData.push({fieldData:n(this.createNextFieldData()),fieldOriginal:n(this.createNextFieldData()),shadowData:"000000000000000000000000000000000000000000000000000000000000000000000000000000",cursorData:"000000000000000000000000000000000000000000000000000000000000000000000000000000",arrowData:"000000000000000000000000000000000000000000000000000000000000000000000000000000",autoDrop:!0,advanceNext:!0}):this.currentSlide<this.gameData.length-1&&(this.gameData[this.currentSlide+1].fieldData=n(this.createNextFieldData()),this.gameData[this.currentSlide+1].fieldOriginal=n(this.createNextFieldData())),this.playToNextSlide()):console.log("You can only place Puyos while the board is in an idle state.")},initCursorDisplay:function(){for(var t=this,i=[],e=0;e<this.fieldData.length;e++){i[e]=[];for(var s=0;s<this.fieldData[0].length;s++)i[e][s]=new d(p["/img/cursor.png"].texture),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.cursorDisplay=i;for(var o=this,a=function(i){for(var e=function(e){t.updateCursorSprite(e,i),t.cursorDisplay[i][e].interactive=!1,t.cursorDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateCursorSprite(e,i),o.arrowData[i].splice(e,1,"0"),o.updateArrowSprite(e,i))},t.cursorDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateCursorSprite(e,i),o.arrowData[i].splice(e,1,"0"),o.updateArrowSprite(e,i))},t.cursorDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.cursorDisplay[i][e].on("pointerdown",t.cursorDisplay[i][e].editPuyo),t.cursorDisplay[i][e].on("pointerover",t.cursorDisplay[i][e].mouseOver),t.cursorDisplay[i][e].on("pointerupoutside",t.cursorDisplay[i][e].mouseUp),t.cursorDisplay[i][e].on("pointerup",t.cursorDisplay[i][e].mouseUp)},s=0;s<t.fieldData[0].length;s++)e(s)},r=0;r<this.fieldData.length;r++)a(r)},initArrowDisplay:function(){for(var t=this,i=[],e=0;e<this.fieldData.length;e++){i[e]=[];for(var s=0;s<this.fieldData[0].length;s++)i[e][s]=new d(p["/img/arrow.png"].texture),i[e][s].anchor.set(.5),i[e][s].x=this.coordArray[e][s].x,i[e][s].y=this.coordArray[e][s].y,this.stage.addChild(i[e][s])}this.arrowDisplay=i;for(var o=this,a=function(i){for(var e=function(e){t.updateArrowSprite(e,i),t.arrowDisplay[i][e].interactive=!1,t.arrowDisplay[i][e].editPuyo=function(){o.isMouseDown=!0,"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateArrowSprite(e,i),o.cursorData[i].splice(e,1,"0"),o.updateCursorSprite(e,i))},t.arrowDisplay[i][e].mouseOver=function(){!0===o.isMouseDown&&"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(e,1,o.editorCurrentTool.puyo),o.updateArrowSprite(e,i),o.cursorData[i].splice(e,1,"0"),o.updateCursorSprite(e,i))},t.arrowDisplay[i][e].mouseUp=function(){o.isMouseDown=!1},t.arrowDisplay[i][e].on("pointerdown",t.arrowDisplay[i][e].editPuyo),t.arrowDisplay[i][e].on("pointerover",t.arrowDisplay[i][e].mouseOver),t.arrowDisplay[i][e].on("pointerupoutside",t.arrowDisplay[i][e].mouseUp),t.arrowDisplay[i][e].on("pointerup",t.arrowDisplay[i][e].mouseUp)},s=0;s<t.fieldData[0].length;s++)e(s)},r=0;r<this.fieldData.length;r++)a(r)},initDumpDisplay:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]=new d(this.puyoSprites["spacer_n.png"]),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y-780,this.stage.addChild(t[i][e])}this.dumpDisplay=t;for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!1},updateDumpDisplay:function(){for(var t="",i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++){switch(this.chainDiff[i][e]){case"R":t="red";break;case"G":t="green";break;case"B":t="blue";break;case"Y":t="yellow";break;case"P":t="purple";break;case"J":t="garbage";break;default:t="spacer"}console.log(t),this.dumpDisplay[i][e].texture=this.puyoSprites["".concat(t,"_n.png")],this.dumpDisplay[i][e].anchor.set(.5),this.dumpDisplay[i][e].x=this.coordArray[i][e].x,this.dumpDisplay[i][e].y=this.coordArray[i][e].y-780,"spacer"!==t&&(this.dumpDisplay[i][e].filters=[this.colorFilters["".concat(t)]])}for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!0},initPlayControls:function(){var t,i=this,e=0;this.playCtrlDisplay.rotateLeft=new d(this.fieldSprites["btn_rotateleft.png"]),this.playCtrlDisplay.rotateLeft.x=452,this.playCtrlDisplay.rotateLeft.y=480,this.playCtrlDisplay.rotateLeft.interactive=!0,this.playCtrlDisplay.rotateLeft.buttonMode=!0,this.playCtrlDisplay.rotateLeft.on("pointerdown",function(){i.playCtrlDisplay.rotateLeft.texture=i.fieldSprites["btn_rotateleft_pressed.png"]}).on("pointerup",function(){i.playCtrlDisplay.rotateLeft.texture=i.fieldSprites["btn_rotateleft.png"],i.rotateActivePair("ccw")}).on("pointerup",function(){i.playCtrlDisplay.rotateLeft.texture=i.fieldSprites["btn_rotateleft.png"]}),this.stage.addChild(this.playCtrlDisplay.rotateLeft),t=this.playCtrlDisplay.rotateLeft.height,this.playCtrlDisplay.rotateRight=new d(this.fieldSprites["btn_rotateright.png"]),this.playCtrlDisplay.rotateRight.x=528,this.playCtrlDisplay.rotateRight.y=480+t*e,this.playCtrlDisplay.rotateRight.interactive=!0,this.playCtrlDisplay.rotateRight.buttonMode=!0,this.playCtrlDisplay.rotateRight.on("pointerdown",function(){i.playCtrlDisplay.rotateRight.texture=i.fieldSprites["btn_rotateright_pressed.png"]}).on("pointerup",function(){i.playCtrlDisplay.rotateRight.texture=i.fieldSprites["btn_rotateright.png"],i.rotateActivePair("cw")}).on("pointerup",function(){i.playCtrlDisplay.rotateRight.texture=i.fieldSprites["btn_rotateright.png"]}),this.stage.addChild(this.playCtrlDisplay.rotateRight),e+=1,this.playCtrlDisplay.moveLeft=new d(this.fieldSprites["btn_left.png"]),this.playCtrlDisplay.moveLeft.x=452,this.playCtrlDisplay.moveLeft.y=480+t*e,this.playCtrlDisplay.moveLeft.interactive=!0,this.playCtrlDisplay.moveLeft.buttonMode=!0,this.playCtrlDisplay.moveLeft.on("pointerdown",function(){i.playCtrlDisplay.moveLeft.texture=i.fieldSprites["btn_left_pressed.png"]}).on("pointerup",function(){i.playCtrlDisplay.moveLeft.texture=i.fieldSprites["btn_left.png"],i.slideActivePair("left")}).on("pointerup",function(){i.playCtrlDisplay.moveLeft.texture=i.fieldSprites["btn_left.png"]}),this.stage.addChild(this.playCtrlDisplay.moveLeft),this.playCtrlDisplay.moveRight=new d(this.fieldSprites["btn_right.png"]),this.playCtrlDisplay.moveRight.x=528,this.playCtrlDisplay.moveRight.y=480+t*e,this.playCtrlDisplay.moveRight.interactive=!0,this.playCtrlDisplay.moveRight.buttonMode=!0,this.playCtrlDisplay.moveRight.on("pointerdown",function(){i.playCtrlDisplay.moveRight.texture=i.fieldSprites["btn_right_pressed.png"]}).on("pointerup",function(){i.playCtrlDisplay.moveRight.texture=i.fieldSprites["btn_right.png"],i.slideActivePair("right")}).on("pointerup",function(){i.playCtrlDisplay.moveRight.texture=i.fieldSprites["btn_right.png"]}),this.stage.addChild(this.playCtrlDisplay.moveRight),e+=1,this.playCtrlDisplay.moveDown=new d(this.fieldSprites["btn_down.png"]),this.playCtrlDisplay.moveDown.x=490,this.playCtrlDisplay.moveDown.y=480+t*e,this.playCtrlDisplay.moveDown.interactive=!0,this.playCtrlDisplay.moveDown.buttonMode=!0,this.playCtrlDisplay.moveDown.on("pointerdown",function(){i.playCtrlDisplay.moveDown.texture=i.fieldSprites["btn_down_pressed.png"]}).on("pointerup",function(){i.playCtrlDisplay.moveDown.texture=i.fieldSprites["btn_down.png"],i.dropActivePair()}).on("pointerup",function(){i.playCtrlDisplay.moveDown.texture=i.fieldSprites["btn_down.png"]}),this.stage.addChild(this.playCtrlDisplay.moveDown)},initToolDisplay:function(){var t=this;this.fieldDisplay.editBubble=new d(p["/img/edit_bubble.png"].texture),this.fieldDisplay.editBubble.x=520,this.fieldDisplay.editBubble.y=704,this.fieldDisplay.editBubble.anchor.set(.87,0),this.fieldDisplay.editBubble.scale.set(0,0),this.fieldDisplay.editBubble.interactive=!0,this.fieldDisplay.editBubble.visible=!1,this.stage.addChild(this.fieldDisplay.editBubble),this.toolCursor=new d(p["/img/current_tool.png"].texture),this.toolCursor.anchor.set(.5,.5),this.toolCursor.visible=!1,this.stage.addChild(this.toolCursor),this.editorTools[0]=new PIXI.Container,this.editorTools[1]=new PIXI.Container;for(var i=[[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],p["/img/editor_x.png"].texture],[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],p["/img/editor_x.png"].texture]],e=[],s=["R","G","B","Y","P","J","0","R","G","B","Y","P","J","0"],o=0;o<i.length;o++){e[o]=[];for(var a=0;a<i[o].length;a++){var r=0,l=0;a>0&&(r=8),o>0&&(l=8),e[o][a]=new d(i[o][a]),e[o][a].interactive=!0,e[o][a].buttonMode=!0,e[o][a].puyoIndex=7*o+a,e[o][a].puyoColor=s[7*o+a],e[o][a].targetLayer=7*o+a<7?"main":"shadow",e[o][a].anchor.set(.5,.5),e[o][a].on("pointerdown",function(){t.editorCurrentTool.page=0,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),e[o][a].x=88+(e[o][a].width+r)*a,e[o][a].y=820+(e[o][a].height+l)*o,this.editorTools[0].addChild(e[o][a])}}for(var n=[[p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow.png"].texture,p["/img/arrow_x.png"].texture,p["/img/cursor.png"].texture,p["/img/cursor_x.png"].texture]],h=[],u=["L","U","R","D","0","1","0"],c=0;c<n.length;c++){h[c]=[];for(var y=0;y<n[c].length;y++){var g=0,f=0;y>0&&(g=8),c>0&&(f=8),h[c][y]=new d(n[c][y]),h[c][y].interactive=!0,h[c][y].buttonMode=!0,h[c][y].puyoIndex=7*c+y,h[c][y].puyoColor=u[7*c+y],"L"===u[7*c+y]?h[c][y].rotation=1.5*Math.PI:"R"===u[7*c+y]?h[c][y].rotation=.5*Math.PI:"D"===u[7*c+y]&&(h[c][y].rotation=Math.PI),h[c][y].targetLayer=7*c+y<5?"arrow":"cursor",h[c][y].anchor.set(.5,.5),h[c][y].on("pointerdown",function(){t.editorCurrentTool.page=1,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),h[c][y].x=88+(64+g)*y,h[c][y].y=820+(60+f)*c,this.editorTools[1].addChild(h[c][y])}}this.editorWindow.left=new d(p["/img/picker_arrow_left.png"].texture),this.editorWindow.left.x=0,this.editorWindow.left.y=720,this.editorWindow.left.interactive=!0,this.editorWindow.left.buttonMode=!0,this.editorWindow.left.visible=!1,this.editorWindow.left.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.left),this.editorWindow.right=new d(p["/img/picker_arrow_right.png"].texture),this.editorWindow.right.x=552,this.editorWindow.right.y=720,this.editorWindow.right.interactive=!0,this.editorWindow.right.buttonMode=!0,this.editorWindow.right.visible=!1,this.editorWindow.right.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.right),this.editorTools[0].visible=!1,this.stage.addChild(this.editorTools[0]),this.editorTools[1].visible=!1,this.stage.addChild(this.editorTools[1])},openToolbox:function(t){this.timers.editBubble+=t;var i=this.timers.editBubble;this.fieldDisplay.disableTouchBehind.interactive=!0,this.timers.editBubble<=15?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.openToolbox),this.ticker.add(this.displayTools),this.editorWindow.left.visible=!0,this.editorWindow.right.visible=!0,this.timers.toolIntroFade=0)},displayTools:function(t){this.timers.toolIntroFade+=t;var i=this.timers.toolIntroFade,e=[],s=[];if(this.editorTools[this.toolPage].visible=!0,this.updateToolboxSelection(),i<=2*this.editorTools[this.toolPage].children.length+12){for(var o=0;o<this.editorTools[this.toolPage].children.length;o++)e.push(0-2*o);for(var a=0;a<this.editorTools[this.toolPage].children.length;a++)s.push((e[a]+i)/12),this.editorTools[this.toolPage].children[a].alpha=a<7?s[a]:.17*s[a],a===this.editorCurrentTool.item&&(this.toolCursor.alpha=s[a])}else this.ticker.remove(this.displayTools),this.updateToolboxSelection(),console.log("removed tool ticker")},updateToolboxSelection:function(){this.editorCurrentTool.page===this.toolPage?(this.toolCursor.visible=!0,this.toolCursor.position.set(this.editorCurrentTool.x,this.editorCurrentTool.y)):this.toolCursor.visible=!1},targetLayer:function(t){if("main"===t)for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)this.puyoDisplay[i][e].interactive=!0,this.shadowDisplay[i][e].interactive=!1,this.cursorDisplay[i][e].interactive=!1,this.arrowDisplay[i][e].interactive=!1;else if("shadow"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.puyoDisplay[s][o].interactive=!1,this.shadowDisplay[s][o].interactive=!0,this.cursorDisplay[s][o].interactive=!1,this.arrowDisplay[s][o].interactive=!1;else if("cursor"===t)for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.puyoDisplay[a][r].interactive=!1,this.shadowDisplay[a][r].interactive=!1,this.cursorDisplay[a][r].interactive=!0,this.arrowDisplay[a][r].interactive=!1;else if("arrow"===t)for(var l=0;l<this.Field.totalRows;l++)for(var n=0;n<this.Field.columns;n++)this.puyoDisplay[l][n].interactive=!1,this.shadowDisplay[l][n].interactive=!1,this.cursorDisplay[l][n].interactive=!1,this.arrowDisplay[l][n].interactive=!0},closeToolbox:function(t){this.timers.editBubble-=t;var i=this.timers.editBubble;this.editorTools[this.toolPage].visible=!1,this.editorWindow.left.visible=!1,this.editorWindow.right.visible=!1,this.toolCursor.visible=!1,this.ticker.remove(this.displayTools),this.timers.editBubble>=0?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.closeToolbox),this.gameState="idle",this.timers.editBubble=0,this.fieldDisplay.editBubble.visible=!1,this.fieldDisplay.disableTouchBehind.interactive=!1)},gameLoop:function(t){"idle"===this.gameState?this.stateEditField(t):"dropping"===this.gameState&&!1===this.needToReset?(this.animateDropPuyos(t),!0===this.needToChangeSlides&&this.animateDropDumpPuyos(t)):"popping"===this.gameState&&!1===this.needToReset&&this.animatePopPuyos(t),this.renderer.render(this.stage)},stateEditField:function(t){},animateDropPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.dropDistances[o][a]>0&&("idle"===this.puyoStates[o][a]||"checkDrops"===this.puyoStates[o][a]?this.puyoStates[o].splice(a,1,"dropping"):"dropping"===this.puyoStates[o][a]?this.puyoDisplay[o][a].y+this.Field.map[o][a].vy<this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight?(this.puyoDisplay[o][a].y+=this.Field.map[o][a].vy,this.Field.map[o][a].vy+=.703125*i):(this.puyoStates[o].splice(a,1,"bouncing"),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight+this.Field.cellHeight/2,this.puyoDisplay[o][a].anchor.set(.5,1)):"bouncing"===this.puyoStates[o][a]&&(this.cellTimer[o][a]+=1,this.cellTimer[o][a]<=8?(this.puyoDisplay[o][a].scale.y-=.025,this.puyoDisplay[o][a].scale.x+=.025):this.cellTimer[o][a]<=16?(this.puyoDisplay[o][a].scale.y+=.025,this.puyoDisplay[o][a].scale.x-=.025):(this.puyoDisplay[o][a].anchor.set(.5,.5),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight,this.puyoStates[o].splice(a,1,"checkPops"),this.droppingCells[o].splice(a,1,!1),this.dropDistances[o].splice(a,1,0),this.cellTimer[o].splice(a,1,0))));!1===this.stopGame&&(this.frame+=1)},animateDropDumpPuyos:function(t){!0===this.stopGame&&(t=0);var i=t*this.simulationSpeed;console.log(i);for(var e=0;e<Math.round(i);e++)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dropDumpDistances[s][o]>0&&(console.log("Detected cells with distance needed greater than 0"),"idle"===this.dumpPuyoStates[s][o]||"checkDrops"===this.dumpPuyoStates[s][o]?this.dumpPuyoStates[s].splice(o,1,"dropping"):"dropping"===this.dumpPuyoStates[s][o]?this.dumpDisplay[s][o].y+this.dumpVelocity[s][o]<this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight?(console.log("dropping dumps"),this.dumpDisplay[s][o].y+=this.dumpVelocity[s][o],this.dumpVelocity[s][o]+=.703125*this.frame):(console.log("dump bounce state"),this.dumpPuyoStates[s].splice(o,1,"bouncing"),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight+this.Field.cellHeight/2,this.dumpDisplay[s][o].anchor.set(.5,1)):"bouncing"===this.dumpPuyoStates[s][o]&&(this.dumpCellTimer[s][o]+=1,this.dumpCellTimer[s][o]<=8?(this.dumpDisplay[s][o].scale.y-=.025,this.dumpDisplay[s][o].scale.x+=.025):this.dumpCellTimer[s][o]<=16?(this.dumpDisplay[s][o].scale.y+=.025,this.dumpDisplay[s][o].scale.x-=.025):(console.log("it is no more."),this.dumpDisplay[s][o].anchor.set(.5,.5),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight,this.dumpPuyoStates[s].splice(o,1,"checkPops"),this.droppingDumpCells[s].splice(o,1,!1),this.dropDumpDistances[s].splice(o,1,0),this.dumpCellTimer[s].splice(o,1,0),this.dumpVelocity[s].splice(o,1,3.75))));!1===this.stopGame&&(this.frame+=1)},animatePopPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)!0===this.poppingCells[o][a]?(this.puyoStates[o].splice(a,1,"popping"),Math.cos(i/3*Math.PI)>=0?this.puyoDisplay[o][a].alpha=1:this.puyoDisplay[o][a].alpha=0,this.cellTimer[o][a]+=1,this.cellTimer[o][a]>=24&&(console.log("need to finish popping"),this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0))):(this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0));!1===this.stopGame&&(this.frame+=1)},animateCursors:function(t){for(var i=this.timers.cursor,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)Math.cos(i/30*Math.PI)>=0?this.cursorDisplay[e][s].scale.set(.9,.9):this.cursorDisplay[e][s].scale.set(1,1);this.timers.cursor+=t},setDropData:function(){for(var t=o.a.Simulate.dropPuyos(this.Field),i=[],e=0;e<this.Field.totalRows;e++){i[e]=[];for(var s=0;s<this.Field.columns;s++)t.dropDistances[e][s]>0?i[e][s]=!0:i[e][s]=!1}this.droppingCells=i,this.dropDistances=t.dropDistances,this.dropPuyosResult=o.a.mapToStringArray(t.dropResult)},setPopData:function(){var t=o.a.Simulate.clearPuyos(this.Field);this.poppingCells=t.animationMatrix,this.clearPuyosResult=o.a.mapToStringArray(t.newField.map),0!==t.popData.poppingGroups.length?this.calculateScore(t.popData):this.gameState=this.gamePlayable?"idle":"chainStopped"},mergeInShadowLayer:function(t){for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)"0"!==this.shadowData[i][e]&&this.shadowData[i][e]!==this.fieldData[i][e]&&(this.fieldData[i].splice(e,1,this.shadowData[i][e]),!0===t&&(console.log("Replacing old shadow puyo forever..."),this.shadowData[i].splice(e,1,"0"),this.updateShadowSprite(e,i)));this.updatePuyoSprites(),console.log("merged shadow layer")},controlField:function(t){if("reset"===t){for(var i in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[i]=0;this.resetField()}else if("back"===t)console.log("I didn't make a function for back yet.");else if("pause"===t)this.chainAutoPlay=!1;else if("play"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),!1===this.needToChangeSlides&&!1===this.gameReplay&&this.mergeInShadowLayer(!0),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||(this.simulationSpeed=24),this.playStep();else if("auto"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),!1===this.needToChangeSlides&&!1===this.gameReplay&&this.mergeInShadowLayer(!0),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||8!==this.simulationSpeed?"popping"===this.gameState||"dropping"===this.gameState?this.simulationSpeed=8:"chainStopped"===this.gameState&&(this.simulationSpeed=1):this.simulationSpeed=24,this.playChain();else if("edit"===t)"editor"!==this.gameState?(this.ticker.add(this.openToolbox),this.ticker.remove(this.closeToolbox),this.gameState="editor",this.fieldDisplay.editBubble.visible=!0):"editor"===this.gameState&&(this.gameState="idle",this.ticker.remove(this.openToolbox),this.ticker.add(this.closeToolbox));else if("empty"===t){for(var e in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[e]=0;this.emptyField()}},resetField:function(){var t=this;this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=t.fieldOriginal,t.needToReset=!1})},emptyField:function(){var t=this;this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=r("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.updatePuyoSprites(),t.shadowData=r("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.cursorData=r("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.arrowData=r("0",t.fieldSettings.totalRows,t.fieldSettings.columns);for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);t.needToReset=!1})},calculateScore:function(t){this.chainLength+=1;var i=Object(s.a)(new Set(t.poppingColors));console.log(i);for(var e=this.fieldSettings.colorBonus[i.length-1],o=this.fieldSettings.chainPower[this.chainLength-1],a=0,r=0,l=0;l<t.poppingGroups.length;l++){var n=t.poppingGroups[l].length;r+=n,a+=n>=11?this.fieldSettings.groupBonus[this.fieldSettings.groupBonus.length-1]:this.fieldSettings.groupBonus[n-4]}var h=o+e+a;h<1?h=1:h>999&&(h=999),this.stepScore=10*r*h,this.score+=this.stepScore,this.calculateGarbage()},calculateGarbage:function(){this.garbagePoints=this.stepScore/this.fieldSettings.targetPoint+this.leftoverGarbagePoints,this.stepGarbage=Math.floor(this.garbagePoints),this.leftoverGarbagePoints=this.garbagePoints-this.stepGarbage,this.garbage+=this.stepGarbage},animateChainCounter:function(t){var i=this.timers.chainLength;this.timers.chainLength+=t,this.timers.chainLength<=30?this.chainCountDisplay.y=this.chainCountDisplay.origY-16*(-1/225*Math.pow(i-15,2)+1):(this.chainCountDisplay.y=this.chainCountDisplay.origY,this.ticker.remove(this.animateChainCounter),console.log("counter bounce over"))},animateGarbageTray:function(t){var i=this.timers.garbageTray,e=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;if(i<8){for(var s=0;s<6;s++)this.garbageDisplay[s].x=this.garbageDisplay[s].x+(this.garbageDisplay[s].origX-e)/8;for(var o=0;o<3;o++)this.garbageDisplay[o].x<this.garbageDisplay.origX&&(this.garbageDisplay[o].x=this.garbageDisplay.origX);for(var a=3;a<6;a++)this.garbageDisplay[a].x>this.garbageDisplay.origX&&(this.garbageDisplay[a].x=this.garbageDisplay.origX);this.timers.garbageTray+=1}else this.ticker.remove(this.animateGarbageTray),console.log("removed garbage tray animation")},animateArrows:function(t){for(var i=this.timers.arrow,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)"R"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x+8*Math.cos(i/30*Math.PI)),"L"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x-8*Math.cos(i/30*Math.PI)),"U"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y-8*Math.cos(i/30*Math.PI)),"D"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y+8*Math.cos(i/30*Math.PI));this.timers.arrow+=t},animateNextPuyos:function(t){var i=this.timers.next;if(this.nextPuyoPairs[0].y=this.nextCoord[0].y-(this.nextCoord[0].y-80)/12*i,this.nextPuyoPairs[1].x=this.nextCoord[1].x-(this.nextCoord[1].x-this.nextCoord[0].x)/12*i,this.nextPuyoPairs[1].y=this.nextCoord[1].y-(this.nextCoord[1].y-this.nextCoord[0].y)/12*i,this.nextPuyoPairs[1].scale.set(.8+.2/12*i,.8+.2/12*i),this.nextPuyoPairs[2].y=this.nextCoord[2].y-(this.nextCoord[2].y-this.nextCoord[1].y)/12*i,i>=12)return this.ticker.remove(this.animateNextPuyos),this.gameData[this.currentSlide].puyoPair="".concat(this.nextPuyoData[this.nextQueuePosition]).concat(this.nextPuyoData[this.nextQueuePosition+1]),this.nextQueuePosition+=2,this.timers.next=0,this.updateNextPuyoSprites(),this.updateActivePair(),void(this.droppedPair=!1);this.timers.next+=1},playStep:function(){"idle"===this.gameState?(this.chainAutoPlay=!1,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!1,this.gameState="dropping")},playChain:function(){"idle"===this.gameState?(this.chainAutoPlay=!0,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!0,this.gameState="dropping")},setDumpMatrixDropData:function(){for(var t=new o.a.Field({columns:6,visibleRows:12,hiddenRows:14,totalRows:26,puyoToClear:4},this.combinedMatrix),i=o.a.Simulate.dropPuyos(t),e=[],s=0;s<this.Field.totalRows;s++){e[s]=[];for(var a=0;a<this.Field.columns;a++)i.dropDistances[s][a]>0?e[s][a]=!0:e[s][a]=!1}for(var r=[],l=0;l<this.Field.totalRows;l++){r[l]=[];for(var n=0;n<this.Field.columns;n++)r[l][n]=i.dropDistances[l][n]}this.droppingDumpCells=e,this.dropDumpDistances=r},updateWithNextSlide:function(){var t=this;console.log("Updating with next slide"),this.activePair.axisPuyo.visible=!1,this.activePair.freePuyo.visible=!1,this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDumpDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingDumpCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.gameData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.gameState="idle",this.shadowData=l(this.gameData[this.currentSlide+1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.gameData[this.currentSlide+1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.gameData[this.currentSlide+1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide+=1;for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)this.updateShadowSprite(e,i),this.updateCursorSprite(e,i),this.updateArrowSprite(e,i);this.ticker.addOnce(function(){t.updatePuyoSprites();for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.dumpDisplay[i][e].visible=!1;t.controlField("auto")})},prevSlide:function(){if(2===this.currentSlide&&"idle"===this.gameState){this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.gameData[this.currentSlide-1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition-=2;for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.dumpDisplay[t][i].visible=!1;this.shadowData=l(this.gameData[this.currentSlide-1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.gameData[this.currentSlide-1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.gameData[this.currentSlide-1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide-=1,this.updatePuyoSprites(),this.updateNextPuyoSprites();for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)this.updateShadowSprite(s,e),this.updateCursorSprite(s,e),this.updateArrowSprite(s,e);this.updateActivePair(),this.checkIfOnTrack()}else if(this.currentSlide>2&&"idle"===this.gameState){this.poppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=r(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=r(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.gameData[this.currentSlide-2].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition-=4;for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.dumpDisplay[o][a].visible=!1;this.shadowData=l(this.gameData[this.currentSlide-2].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.gameData[this.currentSlide-2].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.gameData[this.currentSlide-2].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide-=2,this.updatePuyoSprites(),this.updateNextPuyoSprites();for(var n=0;n<this.Field.totalRows;n++)for(var h=0;h<this.Field.columns;h++)this.updateShadowSprite(h,n),this.updateCursorSprite(h,n),this.updateArrowSprite(h,n);this.updateActivePair(),this.playToNextSlide()}},nextSlide:function(){this.currentSlide<this.gameData.length-1&&"idle"===this.gameState?(this.fieldData=this.gamePlayable?this.fieldData:l(this.gameData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),this.ticker.add(this.animateNextPuyos)):console.log("No more slides")},playToNextSlide:function(){this.currentSlide<this.gameData.length-1&&"idle"===this.gameState?(this.fieldData=this.gamePlayable?this.fieldData:l(this.gameData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),this.setDumpMatrixDropData(),this.updateDumpDisplay(),this.needToChangeSlides=!0,this.controlField("play")):console.log("No more slides")},createNextFieldData:function(){var t=this.activePair.axisPuyo,i=this.activePair.freePuyo,e=JSON.parse(JSON.stringify(this.fieldData));if(!0===this.checkDropInBounds){if(t.cellPos.x===i.cellPos.x){for(var s=[],o=0;o<this.Field.totalRows;o++)"0"!==this.fieldData[o][t.cellPos.x]&&s.push(this.fieldData[o][t.cellPos.x]);t.cellPos.y<i.cellPos.y?(s.unshift(this.activePair.data[1]),s.unshift(this.activePair.data[0])):(s.unshift(this.activePair.data[0]),s.unshift(this.activePair.data[1]));for(var a=[],r=0;r<this.Field.totalRows-s.length;r++)a.push("0");a.forEach(function(t){s.unshift(t)});for(var l=0;l<this.Field.totalRows;l++)e[l].splice([t.cellPos.x],1,s[l]);return e}if(t.cellPos.x!==i.cellPos.x){for(var n=[],h=0;h<this.Field.totalRows;h++)"0"!==this.fieldData[h][t.cellPos.x]&&n.push(this.fieldData[h][t.cellPos.x]);n.unshift(this.activePair.data[0]);for(var p=[],d=0;d<this.Field.totalRows-n.length;d++)p.push("0");p.forEach(function(t){n.unshift(t)});for(var u=0;u<this.Field.totalRows;u++)e[u].splice([t.cellPos.x],1,n[u]);for(var c=[],y=0;y<this.Field.totalRows;y++)"0"!==this.fieldData[y][i.cellPos.x]&&c.push(this.fieldData[y][i.cellPos.x]);c.unshift(this.activePair.data[1]);for(var g=[],f=0;f<this.Field.totalRows-c.length;f++)g.push("0");g.forEach(function(t){c.unshift(t)});for(var m=0;m<this.Field.totalRows;m++)e[m].splice([i.cellPos.x],1,c[m]);return e}}},countGarbage:function(t,i){this.checkCrown(t,i)},checkCrown:function(t,i){i<6&&(t-720>=0?(this.garbageIcons.splice(i,1,"crown"),this.checkCrown(t-720,i+1)):this.checkMoon(t,i))},checkMoon:function(t,i){i<6&&(t-360>=0?(this.garbageIcons.splice(i,1,"moon"),this.checkStar(t-360,i+1)):this.checkStar(t,i))},checkStar:function(t,i){i<6&&(t-180>=0?(this.garbageIcons.splice(i,1,"star"),this.checkRock(t-180,i+1)):this.checkRock(t,i))},checkRock:function(t,i){i<6&&(t-30>=0?(this.garbageIcons.splice(i,1,"rock"),this.checkRock(t-30,i+1)):this.checkLine(t,i))},checkLine:function(t,i){i<6&&(t-6>=0?(this.garbageIcons.splice(i,1,"line"),this.checkLine(t-6,i+1)):this.checkUnit(t,i))},checkUnit:function(t,i){i<6&&t-1>=0&&(this.garbageIcons.splice(i,1,"unit"),this.checkUnit(t-1,i+1))},saveJSON:function(t,i,e){var s=new Blob([t],{type:e});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(s,i);else{var o=document.createElement("a"),a=URL.createObjectURL(s);o.href=a,o.download=i,document.body.appendChild(o),o.click(),setTimeout(function(){document.body.removeChild(o),window.URL.revokeObjectURL(a)},0)}},keyboard:function(t){var i=this,e={};return e.code=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){!0===i.isMouseOver&&(t.keyCode===e.code&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1),t.preventDefault())},e.upHandler=function(t){!0===i.isMouseOver&&(t.keyCode===e.code&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0),t.preventDefault())},window.addEventListener("keydown",e.downHandler.bind(e),!1),window.addEventListener("keyup",e.upHandler.bind(e),!1),e},initKeyboardControls:function(){var t=this,i=this.keyboard(37),e=this.keyboard(39),s=this.keyboard(40),o=this.keyboard(90),a=this.keyboard(88);i.press=function(){t.slideActivePair("left"),t.playCtrlDisplay.moveLeft.texture=t.fieldSprites["btn_left_pressed.png"]},e.press=function(){t.slideActivePair("right"),t.playCtrlDisplay.moveRight.texture=t.fieldSprites["btn_right_pressed.png"]},s.press=function(){t.dropActivePair(),t.playCtrlDisplay.moveDown.texture=t.fieldSprites["btn_down_pressed.png"]},o.press=function(){t.rotateActivePair("ccw"),t.playCtrlDisplay.rotateLeft.texture=t.fieldSprites["btn_rotateleft_pressed.png"]},a.press=function(){t.rotateActivePair("cw"),t.playCtrlDisplay.rotateRight.texture=t.fieldSprites["btn_rotateright_pressed.png"]},i.release=function(){t.playCtrlDisplay.moveLeft.texture=t.fieldSprites["btn_left.png"]},e.release=function(){t.playCtrlDisplay.moveRight.texture=t.fieldSprites["btn_right.png"]},s.release=function(){t.playCtrlDisplay.moveDown.texture=t.fieldSprites["btn_down.png"]},o.release=function(){t.playCtrlDisplay.rotateLeft.texture=t.fieldSprites["btn_rotateleft.png"]},a.release=function(){t.playCtrlDisplay.rotateRight.texture=t.fieldSprites["btn_rotateright.png"]}},checkIfOnTrack:function(){for(var t=!0,i=0;i<this.fieldSettings.totalRows;i++)for(var e=0;e<this.fieldSettings.columns;e++)"0"!==this.fieldData[i][e]&&this.fieldData[i][e]!==this.shadowData[i][e]&&(t=!1);this.onTrack=t},changeSlideText:function(){console.log("Updating slide text."),this.gameData[this.currentSlide].slideText=this.slideText}},computed:{chainDiff:function(){for(var t=this.fieldData,i=l(this.gameData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),e=[],s=0;s<this.fieldSettings.totalRows;s++){e[s]=[];for(var a=0;a<this.fieldSettings.columns;a++)"0"===t[s][a]&&"0"!==i[s][a]?e[s][a]=i[s][a]:e[s][a]="0"}var r=new o.a.Field(this.fieldSettings,e);return o.a.mapToStringArray(o.a.Simulate.dropPuyos(r).dropResult)},combinedMatrix:function(){for(var t=JSON.parse(JSON.stringify(this.chainDiff)),i=this.fieldData,e=0;e<this.Field.totalRows;e++)t.push(i[e]);return t},Field:function(){return new o.a.Field(this.fieldSettings,this.fieldData)},coordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124}}return t},activeCoordArray:function(){for(var t=[],i=0;i<3;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124-120}}return t},dumpCoordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124-60*this.Field.totalRows}}return t},checkDropInBounds:function(){if(!0!==this.gameLoaded)return!1;var t=this.activePair.axisPuyo,i=this.activePair.freePuyo;if(t.cellPos.x===i.cellPos.x){for(var e=[],s=0;s<this.Field.totalRows;s++)"0"!==this.fieldData[s][t.cellPos.x]&&e.push(this.fieldData[s][t.cellPos.x]);return e.length<=this.Field.totalRows-2}if(t.cellPos.x!==i.cellPos.x){for(var o,a,r=[],l=0;l<this.Field.totalRows;l++)"0"!==this.fieldData[l][t.cellPos.x]&&r.push(this.fieldData[l][t.cellPos.x]);o=r.length<=this.Field.totalRows-1;for(var n=[],h=0;h<this.Field.totalRows;h++)"0"!==this.fieldData[h][i.cellPos.x]&&n.push(this.fieldData[h][i.cellPos.x]);return a=n.length<=this.Field.totalRows-1,!0===o&&!0===a}},isPopping:function(){if(this.poppingCells.length===this.Field.totalRows&&this.poppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.poppingCells[t][i])return!0;return!1},isDropping:function(){if(this.droppingCells.length===this.Field.totalRows&&this.droppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.droppingCells[t][i])return!0;if(!0===this.needToChangeSlides&&this.droppingDumpCells.length===this.Field.totalRows&&this.droppingDumpCells[0].length===this.Field.columns)for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)if(!0===this.droppingDumpCells[e][s])return!0;return!1},Easers:function(){return{editBubble:BezierEasing(.14,.18,0,1.16)}},fieldDataString:function(){return n(this.fieldData).join("")},shadowDataString:function(){return n(this.shadowData).join("")},cursorDataString:function(){return n(this.cursorData).join("")},arrowDataString:function(){return n(this.arrowData).join("")},scoreString:function(){var t=this.score.toString(),i=8-t.length;if(t.length>8)return"99999999";for(var e=0;e<i;e++)t="0"+t;return t},chainLengthString:function(){var t=this.chainLength.toString();return t.length<2&&(t="0"+t),t},copyPaster:function(){if(!0===this.gameLoaded)return this.gameData.length>1?JSON.stringify(function(t){for(var i=JSON.parse(JSON.stringify(t.fields)),e={columns:6,visibleRows:12,hiddenRows:1,totalRows:13,puyoToClear:4,colorBonus:[0,3,6,12,24],groupBonus:[0,2,3,4,5,6,7,10],chainPower:[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512,544,576,608,640,672],targetPoint:70},s=function(t){for(var i=0;i<e.totalRows;i++)for(var s=0;s<e.columns;s++)if(!0===t[i][s])return!0;return!1},o=[],r=0;r<i.length;r++){var l=i[r].fieldData,n=a.stringTo2dArray(l,e.totalRows,e.columns),h=new a.Field(e,n);s(a.Simulate.clearPuyos(h).animationMatrix)?o[r]=!0:o[r]=!1}for(var p="",d=i.length-1;d>=0;d--)!0===o[d]&&d>0?(p=i[d].fieldData,i[d-1].shadowData=p,i[d-1].advanceNext=!0):d===i.length-1?(p=i[d].fieldData,i[d].shadowData=p,i[d].advanceNext=!0):0===d?(i[d].shadowData=p,i[d].advanceNext=!0):(i[d-1].shadowData=p,i[d-1].advanceNext=!0);for(var u="",c=1;c<i.length-1;c++)u+=i[c].puyoPair;return{fields:i,next:{seed:t.next.seed,nextQueue:u}}}({fields:this.gameData,next:{seed:this.nextPuyoSeed,nextQueue:this.nextPuyoData}})):JSON.stringify({fields:this.gameData,next:{seed:this.nextPuyoSeed,nextQueue:this.nextPuyoData}})}},watch:{gameState:function(t,i){var e=this;if(this.frame=0,"dropping"===t?(this.ticker.remove(this.animateNextPuyos),this.activePair.freePuyo.visible=!1,this.activePair.axisPuyo.visible=!1,console.log("Checking drops"),this.setDropData(),this.puyoStates=r("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=r("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),!1===this.isDropping&&(!0===this.needToChangeSlides?this.updateWithNextSlide():this.gameState="popping")):"popping"===t?(this.ticker.remove(this.animateNextPuyos),this.activePair.axisPuyo.visible=!1,this.activePair.freePuyo.visible=!1,console.log("Checking pops"),this.setPopData(),this.puyoStates=r("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites()):"idle"===t&&this.ticker.addOnce(function(){console.log("resetting field"),e.updatePuyoSprites();for(var t=0;t<e.Field.totalRows;t++)for(var i=0;i<e.Field.columns;i++)e.dumpDisplay[t][i].visible=!1;e.checkIfOnTrack(),e.ticker.add(e.animateNextPuyos)}),"idle"===t||"editor"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.shadowDisplay[s][o].visible=!0,this.cursorDisplay[s][o].visible=!0,this.arrowDisplay[s][o].visible=!0;else for(var a=0;a<this.Field.totalRows;a++)for(var l=0;l<this.Field.columns;l++)!1===this.gameReplay&&(this.shadowDisplay[a][l].visible=!1),this.cursorDisplay[a][l].visible=!1,this.arrowDisplay[a][l].visible=!1},isPopping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):(this.fieldData=this.clearPuyosResult,console.log("set cleared puyo field"),this.gameState="dropping"))},isDropping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):this.currentSlide<this.gameData.length-1&&!0===this.needToChangeSlides?!0===this.gameData[this.currentSlide+this.slideChange].autoDrop&&this.updateWithNextSlide():(this.fieldData=this.dropPuyosResult,console.log("Dropped the new puyo field"),this.updatePuyoSprites(),!0===this.chainAutoPlay?this.gameState="popping":(this.simulationSpeed=1,this.gameState=this.gamePlayable?"idle":"chainStopped")))},needToChangeSlides:function(t,i){if(!0===t)for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)!1===this.gameReplay&&(this.shadowDisplay[e][s].visible=!1),this.cursorDisplay[e][s].visible=!1,this.arrowDisplay[e][s].visible=!1},chainLength:function(){this.ticker.remove(this.animateChainCounter),this.timers.chainLength=0,this.chainCountDisplay.y=this.chainCountDisplay.origY,this.ticker.add(this.animateChainCounter)},garbage:function(){this.ticker.remove(this.animateGarbageTray),this.timers.garbageTray=0;for(var t=0;t<6;t++)this.garbageDisplay[t].x=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;this.garbageIcons=["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],this.countGarbage(this.garbage,0),console.log(this.garbageDisplay);for(var i=0;i<6;i++)this.garbageDisplay[i].texture=this.puyoSprites["".concat(this.garbageIcons[i],".png")];this.ticker.add(this.animateGarbageTray)},scoreString:function(){if(!0===this.gameLoaded)for(var t=0;t<8;t++)this.scoreDisplay[t].texture=this.fieldSprites["score_".concat(this.scoreString[t],".png")]},chainLengthString:function(){this.chainCountSprites.firstDigit.alpha=0,this.chainCountSprites.secondDigit.alpha=0,this.chainCountSprites.chainText.alpha=0,"0"!==this.chainLengthString[0]?(this.chainCountSprites.firstDigit.alpha=1,this.chainCountSprites.firstDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[0],".png")]):this.chainCountSprites.firstDigit.texture=this.chainCountSprites["spacer.png"],this.chainLength>0?(this.chainCountSprites.secondDigit.alpha=1,this.chainCountSprites.secondDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[1],".png")],this.chainCountSprites.chainText.alpha=1):this.chainCountSprites.secondDigit.texture=this.chainCountSprites["spacer.png"]},currentSlide:function(){this.$emit("change-comment-input",this.gameData[this.currentSlide].slideText)},slideText:function(){this.gameData[this.currentSlide].slideText=this.slideText}}},w=(e(200),e(1)),S=Object(w.a)(v,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"game-container",attrs:{id:"chainsim"},on:{mousedown:function(i){t.isMouseOver=!0},mouseout:function(i){t.isMouseOver=!1},mouseover:t.changeSlideText}},[e("div",{staticClass:"game-wrapper"},[e("div",{ref:"game",attrs:{id:"game"}})]),t._v(" "),e("div",{staticClass:"error-container",class:{"error-true":!t.onTrack&&"idle"===t.gameState&&(!1===t.isDropping||!1===t.isPopping)&&!1===t.droppedPair}},[t._v("\n    You're off track! But that's OK. Hit undo, or keep experimenting.\n  ")]),t._v(" "),e("button",{staticClass:"undo",on:{click:t.prevSlide}},[t._v("Undo")]),e("br"),e("br"),t._v(" "),e("button",{on:{click:function(i){t.saveJSON(t.copyPaster,"chainJSON.json","text/plain")}}},[t._v("Save JSON")]),e("br"),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.copyPaster,expression:"copyPaster"}],staticStyle:{"vertical-align":"middle"},attrs:{rows:"10",cols:"20"},domProps:{value:t.copyPaster},on:{input:function(i){i.target.composing||(t.copyPaster=i.target.value)}}})])},[],!1,null,"20908d3d",null);S.options.__file="ChainDrillMaker.vue";i.default=S.exports}}]);