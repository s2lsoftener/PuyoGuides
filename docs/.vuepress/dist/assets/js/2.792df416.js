(window.webpackJsonp=window.webpackJsonp||[]).push([[2,24],{129:function(t,i,s){"use strict";s.d(i,"a",function(){return e});var e=new(s(0).a)({data:{assetsLoaded:!1},methods:{setLoaded:function(){this.assetsLoaded=!0}}})},130:function(t,i,s){"use strict";s(131);var e=s(7),o=s(81),a=s(5),r=/./.toString,n=function(t){s(10)(RegExp.prototype,"toString",t,!0)};s(6)(function(){return"/a/b"!=r.call({source:"a",flags:"b"})})?n(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?o.call(t):void 0)}):"toString"!=r.name&&n(function(){return r.call(this)})},131:function(t,i,s){s(5)&&"g"!=/./g.flags&&s(8).f(RegExp.prototype,"flags",{configurable:!0,get:s(81)})},132:function(t,i,s){"use strict";s(82)("anchor",function(t){return function(i){return t(this,"a","name",i)}})},133:function(t,i,s){"use strict";var e={Puyo:{None:"0",Red:"R",Green:"G",Blue:"B",Yellow:"Y",Purple:"P",Nuisance:"J",Point:"T",Sun:"S",Hard:"H",Iron:"I",Block:"L"}},o=function(t,i,s){this.puyo=t,this.x=i,this.y=s,this.newY=s,this.yDiff=this.newY-this.y,this.toPop=!1,this.toDrop=!1,this.vy=0,this.accel=.703125};o.prototype={isColoredPuyo:function(){return this.puyo===e.Puyo.Red||this.puyo===e.Puyo.Green||this.puyo===e.Puyo.Blue||this.puyo===e.Puyo.Yellow||this.puyo===e.Puyo.Purple},checkSides:function(t){var i=[];return this.x>0&&t.map[this.y][this.x].puyo===t.map[this.y][this.x-1].puyo&&i.push(t.map[this.y][this.x-1]),this.y>t.hiddenRows&&t.map[this.y][this.x].puyo===t.map[this.y-1][this.x].puyo&&i.push(t.map[this.y-1][this.x]),this.x<t.columns-1&&t.map[this.y][this.x].puyo===t.map[this.y][this.x+1].puyo&&i.push(t.map[this.y][this.x+1]),this.y<t.totalRows-1&&t.map[this.y][this.x].puyo===t.map[this.y+1][this.x].puyo&&i.push(t.map[this.y+1][this.x]),i},adjacentPuyos:function(t){for(var i=this.checkSides(t),s=[],o=0;o<i.length;o++)i[o].puyo!==e.Puyo.Red&&i[o].puyo!==e.Puyo.Green&&i[o].puyo!==e.Puyo.Blue&&i[o].puyo!==e.Puyo.Yellow&&i[o].puyo!==e.Puyo.Purple||s.push(i[o]);return s},adjacentNuisance:function(t){for(var i=this.checkSides(t),s=[],o=0;o<i.length;o++)i[o].puyo===e.Puyo.Nuisance&&s.push(i[o]);return s}};var a={Constants:e,Puyo:o,Field:function(t,i){var s,a;this.visibleRows=t.visibleRows,this.columns=t.columns,this.hiddenRows=t.hiddenRows,this.totalRows=t.visibleRows+t.hiddenRows,this.cellWidth=64,this.cellHeight=60,this.puyoToClear=4,this.fieldWidthPx=this.cellWidth*(this.columns+2),this.fieldHeightPx=this.cellHeight*(this.visibleRows+this.hiddenRows+2),s=i.length>=this.totalRows?this.totalRows:i.length,a=i[0].length>=this.columns?this.columns:i[0].length;var r=i.length-this.totalRows;if(void 0!==i){this.map=[];for(var n=0;n<i.length;n++){this.map[n]=[];for(var l=0;l<i[n].length;l++)this.map[n][l]=new o(e.Puyo.None,l,n)}for(var h=s-1;h>=r||h>=0;h--)for(var d=0;d<a;d++)this.map[h][d]=new o(i[h][d],d,h)}else{this.map=[];for(var p=0;p<i.length;p++){this.map[p]=[];for(var u=0;u<i[p].length;u++)this.map[p][u]=new o(e.Puyo.None,u,p)}}},Simulate:{filterColors:function(t,i,s){return s.indexOf(t===i)},checkPops:function(t){for(var i=[],s=0;s<t.totalRows;s++){i[s]=[];for(var e=0;e<t.columns;e++)i[s][e]=!1}for(var o=[],a=[],r=t.hiddenRows;r<t.totalRows;r++)for(var n=0;n<t.columns;n++)if(t.map[r][n].isColoredPuyo()&&!1===i[r][n]){i[r][n]=!0;var l=[];l.push(t.map[r][n]);for(var h=0;h<l.length;h++)for(var d=l[h].checkSides(t),p=0;p<d.length;p++){var u=d[p];u.puyo===l[h].puyo&&!1===i[u.y][u.x]&&(i[u.y][u.x]=!0,l.push(u))}l.length>=t.puyoToClear&&(o.push(l),a.push(l[0].puyo))}return{poppingGroups:o,poppingColors:a.filter(this.filterColors)}},checkGarbagePops:function(t,i){for(var s=[],o=0;o<t.totalRows;o++){s[o]=[];for(var a=0;a<t.columns;a++)s[o][a]=!1}if(i.poppingGroups.length>0){var r=i.poppingGroups,n=[];for(var l in r)for(var h in r[l]){var d=r[l][h].x,p=r[l][h].y;p>0&&t.map[p-1][d].puyo===e.Puyo.Nuisance&&!1===s[p-1][d]&&(s[p-1][d]=!0,n.push(t.map[p-1][d])),d>0&&t.map[p][d-1].puyo===e.Puyo.Nuisance&&!1===s[p][d-1]&&(s[p][d-1]=!0,n.push(t.map[p][d-1])),d<t.columns-1&&t.map[p][d+1].puyo===e.Puyo.Nuisance&&!1===s[p][d+1]&&(s[p][d+1]=!0,n.push(t.map[p][d+1])),p<t.visibleRows+t.hiddenRows-1&&t.map[p+1][d].puyo===e.Puyo.Nuisance&&!1===s[p+1][d]&&(s[p+1][d]=!0,n.push(t.map[p+1][d]))}return n}return[]},clearPuyos:function(t){for(var i=JSON.parse(JSON.stringify(t)),s=this.checkPops(t),a=this.checkGarbagePops(t,s),r=[],n=0;n<t.totalRows;n++){r[n]=[];for(var l=0;l<t.columns;l++)r[n][l]=!1}if(s.poppingGroups.length>0){var h=s.poppingGroups;for(var d in h)for(var p in h[d]){var u=h[d][p].x,c=h[d][p].y;h[d][p].toPop=!0,i.map[c][u]=new o(e.Puyo.None,u,c),r[c][u]=!0}}if(a.length>0)for(var g in a){var y=a[g].x,f=a[g].y;a[g].toPop=!0,i.map[f][y]=new o(e.Puyo.None,y,f),r[f][y]=!0}return{newField:i,popData:s,garbageToClear:a,animationMatrix:r}},dropPuyos:function(t){for(var i=[],s=0;s<t.totalRows;s++)i[s]=[];for(var a=0;a<t.columns;a++){for(var r=[],n=t.totalRows-1;n>=0;n--)r.push(t.map[n][a]);for(var l=[],h=0;h<r.length;h++)r[h].puyo!==e.Puyo.None&&l.push(r[h]);for(var d=[],p=0;p<l.length;p++)if(l[p].puyo===e.Puyo.Block){var u=t.totalRows-1-l[p].y;if(d.length<u){var c=new o(e.Puyo.None,a,t.totalRows-1-d.length);d.push(c),p-=1}else d.push(l[p])}else d.push(l[p]);for(var g=d.length;g<t.totalRows;g++){var y=new o(e.Puyo.None,a,t.totalRows-1-d.length);d.push(y)}d.reverse();for(var f=0;f<d.length;f++)i[f][a]=d[f]}for(var m=0;m<i.length;m++)for(var D=0;D<i[m].length;D++)i[m][D].newY=m,i[m][D].yDiff=i[m][D].newY-i[m][D].y;for(var S=[],w=[],v=0;v<t.totalRows;v++){S[v]=[],w[v]=[];for(var b=0;b<t.columns;b++)S[v][b]=i[v][b],w[v][b]=t.map[v][b].yDiff}return{dropResult:S,dropDistances:w}}},mapToStringArray:function(t){for(var i=[],s=0;s<t.length;s++){i[s]=[];for(var e=0;e<t[0].length;e++)i[s][e]=t[s][e].puyo}return i},stringTo2dArray:function(t,i,s){for(var e=[],o=0;o<i;o++){e[o]=[];for(var a=0;a<s;a++)e[o][a]=t[6*o+a]}return e},uniformMatrix:function(t,i,s){for(var e=[],o=0;o<i;o++){e[o]=[];for(var a=0;a<s;a++)e[o][a]=t}return e},flatten2dTo1d:function(t){for(var i=[],s=0;s<t.length;s++)for(var e=0;e<t[0].length;e++)i.push(t[s][e]);return i}};i.a=a},135:function(t,i,s){"use strict";s.r(i);var e={name:"ChainsimControlButton",props:["gameLoaded","button","fieldSprites","buttonName"],render:function(t){return t()},methods:{onButtonDown:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,"_pressed.png")]},onButtonUp:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,".png")],this.$emit("controlField",this.buttonName)},onButtonUpOutside:function(){this.button.texture=this.fieldSprites["btn_".concat(this.buttonName,".png")]}},mounted:function(){!0===this.gameLoaded&&this.button.on("pointerdown",this.onButtonDown).on("pointerup",this.onButtonUp).on("pointerupoutside",this.onButtonUpOutside)},watch:{gameLoaded:function(){this.button.on("pointerdown",this.onButtonDown).on("pointerup",this.onButtonUp).on("pointerupoutside",this.onButtonUpOutside)}}},o=s(1),a=Object(o.a)(e,void 0,void 0,!1,null,null,null);a.options.__file="ChainsimControlButton.vue";i.default=a.exports},143:function(t,i,s){},169:function(t,i,s){"use strict";var e=s(143);s.n(e).a},186:function(t,i,s){"use strict";s.r(i);s(12),s(17),s(83);var e=s(9),o=(s(130),s(132),s(133)),a=s(135),r=s(129),n=o.a.uniformMatrix,l=o.a.stringTo2dArray,h=o.a.flatten2dTo1d,d=window.PIXI,p=d.loader,u=d.loader.resources,c=d.Sprite,g=window.BezierEasing,y=o.a.Constants.Puyo.Red,f=o.a.Constants.Puyo.Green,m=o.a.Constants.Puyo.Blue,D=o.a.Constants.Puyo.Yellow,S=o.a.Constants.Puyo.Purple,w=o.a.Constants.Puyo.Nuisance,v=o.a.Constants.Puyo.None,b={name:"Chainsim",props:["importedData","nextQueue","item","showModal"],components:{ChainsimControlButton:a.default},data:function(){return{fieldSettings:{columns:6,visibleRows:12,hiddenRows:1,totalRows:13,puyoToClear:4,colorBonus:[0,3,6,12,24],groupBonus:[0,2,3,4,5,6,7,10],chainPower:[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512,544,576,608,640,672],targetPoint:70},currentSlide:0,gameMode:"editor",gameState:"idle",fieldData:[[]],fieldOriginal:[[]],fieldHistory:[],connectionData:[[]],colorNameData:[[]],shadowData:[[]],cursorData:[[]],arrowData:[[]],clearPuyosResult:[[]],dropPuyosResult:[[]],score:0,stepScore:0,garbage:0,stepGarbage:0,garbagePoints:0,leftoverGarbagePoints:0,chainLength:0,garbageIcons:["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],poppingCells:[[]],droppingCells:[[]],dropDistances:[[]],dropTimings:[[]],displayMode:"simple",modeSettings:{simple:{width:608,height:974,antialias:!0,transparent:!0,resolution:1},full:{width:872,height:854,antialias:!0,transparent:!1,resolution:1}},app:void 0,stage:void 0,renderer:void 0,ticker:void 0,interaction:void 0,scaleFactor:.45,texturesToLoad:["/img/arle_bg.png","/img/field.json","/img/puyo.json","/img/arrow.png","/img/arrow_x.png","/img/cursor.png","/img/cursor_x.png","/img/chain_font.json","/img/edit_bubble.png","/img/touch_disabler.png","/img/picker_arrow_left.png","/img/picker_arrow_right.png","/img/editor_x.png","/img/current_tool.png","/img/next_background_1p_mask.png","/img/rotate_container.png"],puyoSprites:{},fieldSprites:{},scoreSprites:{},chainCountSprites:{},puyoDisplay:[[]],dumpDisplay:[[]],shadowDisplay:[],scoreDisplay:[],garbageDisplay:[],cursorDisplay:[],arrowDisplay:[],chainCounterDisplay:{},fieldDisplay:{},cellTimer:[[]],puyoStates:[[]],editorTools:[],editorSelectors:[],editorWindow:{},loadingText:"Loading...",texturesLoaded:!1,gameLoaded:!1,fieldControls:{},simulationSpeed:1,needToReset:!1,isMouseDown:!1,frame:0,delta:0,stopGame:!1,chainAutoPlay:!1,timers:{editBubble:0,toolIntroFade:0,chainLength:0,garbageTray:0,cursor:0,arrow:0,next:0},needToChangeSlides:!1,slideChange:1,editorCurrentTool:{page:0,item:6,puyo:"0",layer:"main",x:520,y:820},toolCursor:void 0,toolPage:0,nextPuyoData:"RRBGYYPP",nextPuyoPairs:[],nextQueuePosition:0,nextCoord:[{x:510,y:256},{x:556,y:376},{x:556,y:536}],controlPuyoData:[[]],controlPuyoSprites:[[]],activePair:{data:"RB"},dumpCellContainer:void 0,droppingDumpCells:[[]],dropDumpDistances:[[]],mergedDump:!1,dumpVelocity:[[]],dumpPuyoStates:[[]],dumpCellTimer:[[]],colorSettings:{red:{r:255,g:255,b:255,tint:!1},green:{r:255,g:255,b:255,tint:!1},blue:{r:255,g:255,b:255,tint:!1},yellow:{r:255,g:255,b:255,tint:!1},purple:{r:255,g:255,b:255,tint:!1},garbage:{r:255,g:255,b:255,tint:!1}}}},mounted:function(){var t=this;this.initData(),this.initGame(),r.a.$on("openModal",function(i){t.updateChainsim(i)}),r.a.$on("stopChainsim",function(){t.closeModal()})},methods:{updateChainsim:function(t){var i=this;this.gameState="idle",this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(t.importedData[t.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=l(t.importedData[t.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=l(t.importedData[t.currentSlide].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(t.importedData[t.currentSlide].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(t.importedData[t.currentSlide].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData=t.nextQueue,this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition=0;for(var s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)this.dumpDisplay[s][e].visible=!1;this.currentSlide=0,this.ticker.addOnce(function(){i.updatePuyoSprites(),i.updateNextPuyoSprites(),i.updateDumpDisplay();for(var t=0;t<i.Field.totalRows;t++)for(var s=0;s<i.Field.columns;s++)i.updateShadowSprite(s,t),i.updateCursorSprite(s,t),i.updateArrowSprite(s,t)})},closeModal:function(){var t=this;this.gameState="idle",this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData="000000",this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition=0;for(var i=0;i<this.Field.totalRows;i++)for(var s=0;s<this.Field.columns;s++)this.dumpDisplay[i][s].visible=!1;this.currentSlide=0,this.ticker.addOnce(function(){t.updatePuyoSprites(),t.updateNextPuyoSprites(),t.updateDumpDisplay();for(var i=0;i<t.Field.totalRows;i++)for(var s=0;s<t.Field.columns;s++)t.updateShadowSprite(s,i),t.updateCursorSprite(s,i),t.updateArrowSprite(s,i);r.a.$emit("closeModal")})},log:function(t){console.log(t)},initData:function(){this.fieldData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.controlPuyoData=n("0",6,this.fieldSettings.columns),this.controlPuyoData=[["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","B","0","0","0"],["0","0","R","0","0","0"],["0","0","0","0","0","0"]],this.connectionData=n("n",this.fieldSettings.totalRows,this.fieldSettings.columns),this.colorNameData=n("spacer",this.fieldSettings.totalRows,this.fieldSettings.columns),this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingDumpCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=n("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=n(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData="000000"},initGame:function(){var t=this;this.renderer=new d.autoDetectRenderer(this.modeSettings.simple.width,this.modeSettings.simple.height,{antialias:!0,transparent:!0,resolution:1}),this.renderer.view.style.width="".concat(this.modeSettings.simple.width*this.scaleFactor,"px"),this.renderer.view.style.height="".concat(this.modeSettings.simple.height*this.scaleFactor,"px"),this.$refs.game.appendChild(this.renderer.view),this.stage=new d.Container,new Promise(function(t,i){setInterval(function(){p.progress<100?(console.log(p.progress),console.log("Chainsim says not loaded")):t("Chainsim Assets loaded...!")},50)}).then(function(i){console.log(i),t.runSetup()})},runSetup:function(){var t=this;if(localStorage.getItem("puyotint"))try{this.colorSettings=JSON.parse(localStorage.getItem("puyotint")),console.log("Found color settings in localStorage")}catch(t){console.log("Removing puyotint from localStorage."),localStorage.removeItem("puyotint"),console.log("Using default color settings instead."),this.colorSettings={red:{r:255,g:255,b:255,tint:!1},green:{r:255,g:255,b:255,tint:!1},blue:{r:255,g:255,b:255,tint:!1},yellow:{r:255,g:255,b:255,tint:!1},purple:{r:255,g:255,b:255,tint:!1},garbage:{r:255,g:255,b:255,tint:!1}}}this.texturesLoaded=!0,this.fieldSprites=u["/img/field.json"].textures,this.puyoSprites=u["/img/puyo.json"].textures,this.chainCountSprites=u["/img/chain_font.json"].textures,this.initFieldDisplay(),this.initScoreDisplay(),this.initGameOverX(),this.initPuyoDisplay(),this.initDumpDisplay(),this.initShadowDisplay(),this.initCursorDisplay(),this.initArrowDisplay(),this.initGarbageDisplay(),this.initNextPuyos(),this.initFieldControls(),this.initChainCounter(),this.initToolDisplay(),this.gameLoaded=!0,this.ticker=new d.ticker.Ticker,this.ticker.add(function(i){return t.gameLoop(i)}),this.ticker.start()},initFieldDisplay:function(){this.fieldDisplay.charBG=new c(u["/img/arle_bg.png"].texture),this.fieldDisplay.charBG.x=17,this.fieldDisplay.charBG.y=183,this.stage.addChild(this.fieldDisplay.charBG),this.fieldDisplay.borderTop=new c(this.fieldSprites["field_border_top.png"]),this.fieldDisplay.borderTop.y=132,this.stage.addChild(this.fieldDisplay.borderTop),this.fieldDisplay.borderLeftTop=new c(this.fieldSprites["field_border_left_tophalf.png"]),this.fieldDisplay.borderLeftTop.y=184,this.stage.addChild(this.fieldDisplay.borderLeftTop),this.fieldDisplay.borderLeftBottom=new c(this.fieldSprites["field_border_left_bottomhalf.png"]),this.fieldDisplay.borderLeftBottom.y=536,this.stage.addChild(this.fieldDisplay.borderLeftBottom),this.fieldDisplay.borderRightTop=new c(this.fieldSprites["field_border_right_tophalf.png"]),this.fieldDisplay.borderRightTop.x=417,this.fieldDisplay.borderRightTop.y=184,this.stage.addChild(this.fieldDisplay.borderRightTop),this.fieldDisplay.borderRightBottom=new c(this.fieldSprites["field_border_right_bottomhalf.png"]),this.fieldDisplay.borderRightBottom.x=417,this.fieldDisplay.borderRightBottom.y=536,this.stage.addChild(this.fieldDisplay.borderRightBottom),this.fieldDisplay.borderBottom=new c(this.fieldSprites["field_border_bottom.png"]),this.fieldDisplay.borderBottom.y=902,this.stage.addChild(this.fieldDisplay.borderBottom),this.fieldDisplay.nextWindowBorder=new c(this.fieldSprites["next_border_1p.png"]),this.fieldDisplay.nextWindowBorder.x=456,this.fieldDisplay.nextWindowBorder.y=160,this.stage.addChild(this.fieldDisplay.nextWindowBorder),this.fieldDisplay.nextWindowInner=new c(this.fieldSprites["next_background_1p.png"]),this.fieldDisplay.nextWindowInner.x=456,this.fieldDisplay.nextWindowInner.y=160,this.stage.addChild(this.fieldDisplay.nextWindowInner),this.fieldDisplay.nextWindowMask=new c(u["/img/next_background_1p_mask.png"].texture),this.fieldDisplay.nextWindowMask.position.set(456,160),this.stage.addChild(this.fieldDisplay.nextWindowMask)},initScoreDisplay:function(){var t=150;"full"===this.displayMode?t=150:"simple"===this.displayMode&&(t=32);for(var i=[],s=0;s<8;s++)i[s]=new c(this.fieldSprites["score_0.png"]),i[s].anchor.set(.5),i[s].x=t+.9*i[s].width*s,i[s].y=935,this.stage.addChild(i[s]);this.scoreDisplay=i},initGameOverX:function(){this.fieldDisplay.redX=new c(this.puyoSprites["death_X.png"]),this.fieldDisplay.redX.anchor.set(.5),this.fieldDisplay.redX.x=this.coordArray[1][2].x,this.fieldDisplay.redX.y=this.coordArray[1][2].y,this.stage.addChild(this.fieldDisplay.redX)},initPuyoDisplay:function(){for(var t=this,i=[],s=0;s<this.Field.totalRows;s++){i[s]=[];for(var e=0;e<this.Field.columns;e++)i[s][e]=new c(this.puyoSprites["red_urdl.png"]),i[s][e].anchor.set(.5),i[s][e].x=this.coordArray[s][e].x,i[s][e].y=this.coordArray[s][e].y,this.stage.addChild(i[s][e])}this.puyoDisplay=i;for(var o=this,a=function(i){for(var s=function(s){t.puyoDisplay[i][s].interactive=!0,t.puyoDisplay[i][s].editPuyo=function(){o.isMouseDown=!0,"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(s,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][s]&&(o.shadowData[i].splice(s,1,"0"),o.updateShadowSprite(s,i)),o.updatePuyoSprites())},t.puyoDisplay[i][s].mouseOver=function(){!0===o.isMouseDown&&"main"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.fieldData[i].splice(s,1,o.editorCurrentTool.puyo),"0"!==o.shadowData[i][s]&&(o.shadowData[i].splice(s,1,"0"),o.updateShadowSprite(s,i)),o.updatePuyoSprites())},t.puyoDisplay[i][s].mouseUp=function(){o.isMouseDown=!1},t.puyoDisplay[i][s].on("pointerdown",t.puyoDisplay[i][s].editPuyo),t.puyoDisplay[i][s].on("pointerover",t.puyoDisplay[i][s].mouseOver),t.puyoDisplay[i][s].on("pointerupoutside",t.puyoDisplay[i][s].mouseUp),t.puyoDisplay[i][s].on("pointerup",t.puyoDisplay[i][s].mouseUp)},e=0;e<t.Field.columns;e++)s(e)},r=0;r<this.Field.totalRows;r++)a(r);this.updatePuyoSprites()},componentToHex:function(t){var i=t.toString(16);return 1===i.length?"0"+i:i},rgbToHex:function(t,i,s){return parseInt(this.componentToHex(parseInt(t,10))+this.componentToHex(parseInt(i,10))+this.componentToHex(parseInt(s,10)),16)},updatePuyoSprites:function(){this.determineConnections(),this.determineColorNames();for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.puyoDisplay[t][i].x=this.coordArray[t][i].x,this.puyoDisplay[t][i].y=this.coordArray[t][i].y,"spacer"!==this.colorNameData[t][i]&&!0===this.colorSettings["".concat(this.colorNameData[t][i])].tint&&(this.puyoDisplay[t][i].tint=this.rgbToHex(this.colorSettings["".concat(this.colorNameData[t][i])].r,this.colorSettings["".concat(this.colorNameData[t][i])].g,this.colorSettings["".concat(this.colorNameData[t][i])].b)),this.puyoDisplay[t][i].spritename="".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png"),this.puyoDisplay[t][i].texture=this.puyoSprites["".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png")],this.puyoDisplay[t][i].anchor.set(.5,.5),this.puyoDisplay[t][i].scale.set(1,1);console.log("updated sprites")},updateShadowSprite:function(t,i){var s="";s=this.shadowData[i][t]===y?"red":this.shadowData[i][t]===f?"green":this.shadowData[i][t]===m?"blue":this.shadowData[i][t]===D?"yellow":this.shadowData[i][t]===S?"purple":this.shadowData[i][t]===w?"garbage":"spacer",this.shadowDisplay[i][t].texture=this.puyoSprites["".concat(s,"_n.png")],"spacer"!==s&&!0===this.colorSettings[s].tint&&(this.shadowDisplay[i][t].tint=this.rgbToHex(this.colorSettings[s].r,this.colorSettings[s].g,this.colorSettings[s].b)),console.log("Updated the shadow sprite.")},updateCursorSprite:function(t,i){"1"===this.cursorData[i][t]?this.cursorDisplay[i][t].alpha=1:this.cursorDisplay[i][t].alpha=0},updateArrowSprite:function(t,i){"0"===this.arrowData[i][t]?this.arrowDisplay[i][t].alpha=0:"L"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=1.5*Math.PI):"R"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=.5*Math.PI):"D"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=Math.PI):"U"===this.arrowData[i][t]&&(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=0)},updateNextPuyoSprites:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var s=0;s<3;s++){var e=t[2*s+0],o=t[2*s+1];void 0===e&&(e="spacer"),void 0===o&&(o="spacer"),this.nextPuyoPairs[s].children[0].texture=this.puyoSprites["".concat(e,"_n.png")],this.nextPuyoPairs[s].children[1].texture=this.puyoSprites["".concat(o,"_n.png")],"spacer"!==e&&!0===this.colorSettings[e].tint&&(this.nextPuyoPairs[s].children[0].tint=this.rgbToHex(this.colorSettings[e].r,this.colorSettings[e].g,this.colorSettings[e].b)),"spacer"!==o&&!0===this.colorSettings[o].tint&&(this.nextPuyoPairs[s].children[1].tint=this.rgbToHex(this.colorSettings[o].r,this.colorSettings[o].g,this.colorSettings[o].b))}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y)},determineConnections:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var s=0;s<this.Field.columns;s++)if(i<this.Field.hiddenRows)t[i][s]="n";else if(this.dropDistances[i][s]>0)t[i][s]="n";else if(this.fieldData[i][s]===v||this.fieldData[i][s]===w)t[i][s]="n";else{var e={};e.up=!(i<=this.Field.hiddenRows)&&(this.fieldData[i][s]===this.fieldData[i-1][s]&&0===this.dropDistances[i-1][s]),e.left=0!==s&&(this.fieldData[i][s]===this.fieldData[i][s-1]&&0===this.dropDistances[i][s-1]),e.right=s!==this.Field.columns-1&&(this.fieldData[i][s]===this.fieldData[i][s+1]&&0===this.dropDistances[i][s+1]),e.down=i!==this.Field.totalRows-1&&(this.fieldData[i][s]===this.fieldData[i+1][s]&&0===this.dropDistances[i+1][s]);var o="";!0===e.up&&(o+="u"),!0===e.right&&(o+="r"),!0===e.down&&(o+="d"),!0===e.left&&(o+="l"),""===o&&(o="n"),t[i][s]=o}}return this.connectionData=t,t},determineColorNames:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var s=0;s<this.Field.columns;s++)this.fieldData[i][s]===y?t[i][s]="red":this.fieldData[i][s]===f?t[i][s]="green":this.fieldData[i][s]===m?t[i][s]="blue":this.fieldData[i][s]===D?t[i][s]="yellow":this.fieldData[i][s]===S?t[i][s]="purple":this.fieldData[i][s]===w?t[i][s]="garbage":t[i][s]="spacer"}return this.colorNameData=t,t},initNextPuyos:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var s=0;s<3;s++){var e=t[2*s+0],o=t[2*s+1];void 0===e&&(e="spacer"),void 0===o&&(o="spacer");var a=new c(this.puyoSprites["".concat(e,"_n.png")]),r=new c(this.puyoSprites["".concat(o,"_n.png")]);a.y+=60,"spacer"!==e&&!0===this.colorSettings[e].tint&&(a.tint=this.rgbToHex(this.colorSettings[e].r,this.colorSettings[e].g,this.colorSettings[e].b)),"spacer"!==o&&!0===this.colorSettings[o].tint&&(r.tint=this.rgbToHex(this.colorSettings[o].r,this.colorSettings[o].g,this.colorSettings[o].b)),this.nextPuyoPairs[s]=new d.Container,this.nextPuyoPairs[s].addChild(a),this.nextPuyoPairs[s].addChild(r),this.nextPuyoPairs[s].pivot.set(this.nextPuyoPairs[s].width/2,this.nextPuyoPairs[s].height/2),this.nextPuyoPairs[s].mask=this.fieldDisplay.nextWindowMask}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y),this.stage.addChild(this.nextPuyoPairs[0]),this.stage.addChild(this.nextPuyoPairs[1]),this.stage.addChild(this.nextPuyoPairs[2])},initGarbageDisplay:function(){if("full"===this.displayMode?(this.fieldDisplay.garbageTray=new c(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=456,this.fieldDisplay.garbageTray.y=480,this.stage.addChild(this.fieldDisplay.garbageTray)):"simple"===this.displayMode&&(this.fieldDisplay.garbageTray=new c(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=316,this.fieldDisplay.garbageTray.y=915,this.fieldDisplay.garbageTray.scale.set(.7,.7),this.stage.addChild(this.fieldDisplay.garbageTray)),"full"===this.displayMode){for(var t=[],i=0;i<this.Field.columns;i++)t[i]=new c(this.puyoSprites["spacer_n.png"]),t[i].x=468+t[i].width*i,t[i].origX=468+t[i].width*i,t[i].y=470,this.stage.addChild(t[i]);this.garbageDisplay=t}else if("simple"===this.displayMode){for(var s=[],e=0;e<this.Field.columns;e++)s[e]=new c(this.puyoSprites["spacer_n.png"]),s[e].scale.set(.7,.7),s[e].x=324+s[e].width*e,s[e].origX=324+s[e].width*e,s[e].y=910,this.stage.addChild(s[e]);this.garbageDisplay=s}},initFieldControls:function(){var t,i=this,s=0;this.fieldControls.reset=new c(this.fieldSprites["btn_reset.png"]),this.fieldControls.reset.x=452,this.fieldControls.reset.y=480,this.fieldControls.reset.interactive=!0,this.fieldControls.reset.buttonMode=!0,this.stage.addChild(this.fieldControls.reset),t=this.fieldControls.reset.height,this.fieldControls.pause=new c(this.fieldSprites["btn_pause.png"]),this.fieldControls.pause.x=528,this.fieldControls.pause.y=480+t*s,this.fieldControls.pause.interactive=!0,this.fieldControls.pause.buttonMode=!0,this.stage.addChild(this.fieldControls.pause),s+=1,this.fieldControls.play=new c(this.fieldSprites["btn_play.png"]),this.fieldControls.play.x=452,this.fieldControls.play.y=480+t*s,this.fieldControls.play.interactive=!0,this.fieldControls.play.buttonMode=!0,this.stage.addChild(this.fieldControls.play),this.fieldControls.auto=new c(this.fieldSprites["btn_auto.png"]),this.fieldControls.auto.x=528,this.fieldControls.auto.y=480+t*s,this.fieldControls.auto.interactive=!0,this.fieldControls.auto.buttonMode=!0,this.stage.addChild(this.fieldControls.auto),s+=1,this.fieldDisplay.disableTouchBehind=new c(u["/img/touch_disabler.png"].texture),this.fieldDisplay.disableTouchBehind.x=0,this.fieldDisplay.disableTouchBehind.y=0,this.fieldDisplay.disableTouchBehind.width=this.modeSettings.simple.width,this.fieldDisplay.disableTouchBehind.height=this.modeSettings.simple.height,this.stage.addChild(this.fieldDisplay.disableTouchBehind),this.fieldDisplay.disableTouchBehind.interactive=!1,this.fieldDisplay.disableTouchBehind.on("pointerdown",function(){i.controlField("edit")}),this.fieldControls.edit=new c(this.fieldSprites["btn_edit.png"]),this.fieldControls.edit.x=490,this.fieldControls.edit.y=480+s*this.fieldControls.edit.height,this.fieldControls.edit.interactive=!0,this.fieldControls.edit.buttonMode=!0,this.stage.addChild(this.fieldControls.edit)},initChainCounter:function(){this.chainCounterDisplay.firstDigit=new c(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.firstDigit.x=412,this.chainCounterDisplay.firstDigit.y=732,this.chainCounterDisplay.firstDigit.scale.set(.85,.85),this.chainCounterDisplay.firstDigit.origY=this.chainCounterDisplay.firstDigit.y,this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit=new c(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.secondDigit.x=452,this.chainCounterDisplay.secondDigit.y=732,this.chainCounterDisplay.secondDigit.scale.set(.85,.85),this.chainCounterDisplay.secondDigit.origY=this.chainCounterDisplay.secondDigit.y,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText=new c(this.chainCountSprites["chain_text.png"]),this.chainCounterDisplay.chainText.x=496,this.chainCounterDisplay.chainText.y=742,this.chainCounterDisplay.chainText.origY=this.chainCounterDisplay.chainText.y,this.chainCounterDisplay.chainText.scale.set(.85,.85),this.chainCounterDisplay.chainText.alpha=0,this.stage.addChild(this.chainCounterDisplay.firstDigit),this.stage.addChild(this.chainCounterDisplay.secondDigit),this.stage.addChild(this.chainCounterDisplay.chainText)},initShadowDisplay:function(){for(var t=this,i=[],s="",e=0;e<this.fieldData.length;e++){i[e]=[];for(var o=0;o<this.fieldData[0].length;o++)s=this.shadowData[e][o]===y?"red":this.shadowData[e][o]===f?"green":this.shadowData[e][o]===m?"blue":this.shadowData[e][o]===D?"yellow":this.shadowData[e][o]===S?"purple":this.shadowData[e][o]===w?"garbage":"spacer",i[e][o]=new c(this.puyoSprites["".concat(s,"_n.png")]),i[e][o].anchor.set(.5),i[e][o].alpha=.4,i[e][o].x=this.coordArray[e][o].x,i[e][o].y=this.coordArray[e][o].y,"spacer"!==s&&!0===this.colorSettings[s].tint&&(i[e][o].tint=this.rgbToHex(this.colorSettings[s].r,this.colorSettings[s].g,this.colorSettings[s].b)),this.stage.addChild(i[e][o])}this.shadowDisplay=i;for(var a=this,r=function(i){for(var s=function(s){t.updateShadowSprite(s,i),t.shadowDisplay[i][s].interactive=!1,t.shadowDisplay[i][s].editPuyo=function(){a.isMouseDown=!0,"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(s,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(s,1,"0"),a.updateShadowSprite(s,i),a.updatePuyoSprites())},t.shadowDisplay[i][s].mouseOver=function(){!0===a.isMouseDown&&"shadow"===a.editorCurrentTool.layer&&"idle"===a.gameState&&(a.shadowData[i].splice(s,1,a.editorCurrentTool.puyo),a.fieldData[i].splice(s,1,"0"),a.updateShadowSprite(s,i),a.updatePuyoSprites())},t.shadowDisplay[i][s].mouseUp=function(){a.isMouseDown=!1},t.shadowDisplay[i][s].on("pointerdown",t.shadowDisplay[i][s].editPuyo),t.shadowDisplay[i][s].on("pointerover",t.shadowDisplay[i][s].mouseOver),t.shadowDisplay[i][s].on("pointerupoutside",t.shadowDisplay[i][s].mouseUp),t.shadowDisplay[i][s].on("pointerup",t.shadowDisplay[i][s].mouseUp)},e=0;e<t.Field.columns;e++)s(e)},n=0;n<this.Field.totalRows;n++)r(n)},initControlledPuyos:function(){for(var t=[],i=[],s=0;s<this.controlPuyoData.length;s++){i[s]=[];for(var e=0;e<this.controlPuyoData[0].length;e++)switch(this.controlPuyoData[s][e]){case"R":i[s][e]="red";break;case"G":i[s][e]="green";break;case"B":i[s][e]="blue";break;case"Y":i[s][e]="yellow";break;case"P":i[s][e]="purple";break;default:i[s][e]="spacer"}}for(var o=0;o<this.controlPuyoData.length;o++){t[o]=[];for(var a=0;a<this.controlPuyoData[0].length;a++)t[o][a]=new c(this.puyoSprites["".concat(i[o][a],"_n.png")]),t[o][a].anchor.set(.5),t[o][a].x=this.coordArray[o][a].x,t[o][a].y=this.coordArray[o][a].y-5*t[o][a].height,t[o][a].visible=!1,this.stage.addChild(t[o][a])}this.controlPuyoSprites=t},initActivePair:function(){for(var t=this,i=[],s=0;s<2;s++)switch(this.activePair.data[s]){case"R":i.push("red");break;case"G":i.push("green");break;case"B":i.push("blue");break;case"Y":i.push("yellow");break;case"P":i.push("purple");break;default:i.push("spacer")}void 0===i[0]&&(i[0]="spacer"),void 0===i[1]&&(i[0]="spacer");var e=new c(this.puyoSprites["".concat(i[0],"_n.png")]),o=new c(this.puyoSprites["".concat(i[1],"_n.png")]);e.anchor.set(.5,.5),o.anchor.set(.5,.5),e.y+=e.height,this.activePair.sprites=new d.Container,this.activePair.sprites.addChild(e),this.activePair.sprites.addChild(o),this.activePair.sprites.pivot.set(0,60),this.activePair.sprites.position.set(this.coordArray[0][2].x,this.coordArray[0][2].y-60),this.stage.addChild(this.activePair.sprites),this.activePair.sprites.visible=!1,this.ticker.add(function(){t.activePair.sprites.rotation+=2*Math.PI/180,t.activePair.sprites.children[0].rotation-=2*Math.PI/180,t.activePair.sprites.children[1].rotation-=2*Math.PI/180})},initCursorDisplay:function(){for(var t=this,i=[],s=0;s<this.fieldData.length;s++){i[s]=[];for(var e=0;e<this.fieldData[0].length;e++)i[s][e]=new c(u["/img/cursor.png"].texture),i[s][e].anchor.set(.5),i[s][e].x=this.coordArray[s][e].x,i[s][e].y=this.coordArray[s][e].y,this.stage.addChild(i[s][e])}this.cursorDisplay=i;for(var o=this,a=function(i){for(var s=function(s){t.updateCursorSprite(s,i),t.cursorDisplay[i][s].interactive=!1,t.cursorDisplay[i][s].editPuyo=function(){o.isMouseDown=!0,"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(s,1,o.editorCurrentTool.puyo),o.updateCursorSprite(s,i),o.arrowData[i].splice(s,1,"0"),o.updateArrowSprite(s,i))},t.cursorDisplay[i][s].mouseOver=function(){!0===o.isMouseDown&&"cursor"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.cursorData[i].splice(s,1,o.editorCurrentTool.puyo),o.updateCursorSprite(s,i),o.arrowData[i].splice(s,1,"0"),o.updateArrowSprite(s,i))},t.cursorDisplay[i][s].mouseUp=function(){o.isMouseDown=!1},t.cursorDisplay[i][s].on("pointerdown",t.cursorDisplay[i][s].editPuyo),t.cursorDisplay[i][s].on("pointerover",t.cursorDisplay[i][s].mouseOver),t.cursorDisplay[i][s].on("pointerupoutside",t.cursorDisplay[i][s].mouseUp),t.cursorDisplay[i][s].on("pointerup",t.cursorDisplay[i][s].mouseUp)},e=0;e<t.fieldData[0].length;e++)s(e)},r=0;r<this.fieldData.length;r++)a(r)},initArrowDisplay:function(){for(var t=this,i=[],s=0;s<this.fieldData.length;s++){i[s]=[];for(var e=0;e<this.fieldData[0].length;e++)i[s][e]=new c(u["/img/arrow.png"].texture),i[s][e].anchor.set(.5),i[s][e].x=this.coordArray[s][e].x,i[s][e].y=this.coordArray[s][e].y,this.stage.addChild(i[s][e])}this.arrowDisplay=i;for(var o=this,a=function(i){for(var s=function(s){t.updateArrowSprite(s,i),t.arrowDisplay[i][s].interactive=!1,t.arrowDisplay[i][s].editPuyo=function(){o.isMouseDown=!0,"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(s,1,o.editorCurrentTool.puyo),o.updateArrowSprite(s,i),o.cursorData[i].splice(s,1,"0"),o.updateCursorSprite(s,i))},t.arrowDisplay[i][s].mouseOver=function(){!0===o.isMouseDown&&"arrow"===o.editorCurrentTool.layer&&"idle"===o.gameState&&(o.arrowData[i].splice(s,1,o.editorCurrentTool.puyo),o.updateArrowSprite(s,i),o.cursorData[i].splice(s,1,"0"),o.updateCursorSprite(s,i))},t.arrowDisplay[i][s].mouseUp=function(){o.isMouseDown=!1},t.arrowDisplay[i][s].on("pointerdown",t.arrowDisplay[i][s].editPuyo),t.arrowDisplay[i][s].on("pointerover",t.arrowDisplay[i][s].mouseOver),t.arrowDisplay[i][s].on("pointerupoutside",t.arrowDisplay[i][s].mouseUp),t.arrowDisplay[i][s].on("pointerup",t.arrowDisplay[i][s].mouseUp)},e=0;e<t.fieldData[0].length;e++)s(e)},r=0;r<this.fieldData.length;r++)a(r)},initDumpDisplay:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var s=0;s<this.Field.columns;s++)t[i][s]=new c(this.puyoSprites["spacer_n.png"]),t[i][s].anchor.set(.5),t[i][s].x=this.coordArray[i][s].x,t[i][s].y=this.coordArray[i][s].y-780,this.stage.addChild(t[i][s])}this.dumpDisplay=t;for(var e=0;e<this.Field.totalRows;e++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[e][o].visible=!1},updateDumpDisplay:function(){for(var t="",i=0;i<this.Field.totalRows;i++)for(var s=0;s<this.Field.columns;s++){switch(this.chainDiff[i][s]){case"R":t="red";break;case"G":t="green";break;case"B":t="blue";break;case"Y":t="yellow";break;case"P":t="purple";break;case"J":t="garbage";break;default:t="spacer"}console.log(t),this.dumpDisplay[i][s].texture=this.puyoSprites["".concat(t,"_n.png")],this.dumpDisplay[i][s].anchor.set(.5),this.dumpDisplay[i][s].x=this.coordArray[i][s].x,this.dumpDisplay[i][s].y=this.coordArray[i][s].y-780}for(var e=0;e<this.Field.totalRows;e++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[e][o].visible=!0},initToolDisplay:function(){var t=this;this.fieldDisplay.editBubble=new c(u["/img/edit_bubble.png"].texture),this.fieldDisplay.editBubble.x=520,this.fieldDisplay.editBubble.y=704,this.fieldDisplay.editBubble.anchor.set(.87,0),this.fieldDisplay.editBubble.scale.set(0,0),this.fieldDisplay.editBubble.interactive=!0,this.fieldDisplay.editBubble.visible=!1,this.stage.addChild(this.fieldDisplay.editBubble),this.toolCursor=new c(u["/img/current_tool.png"].texture),this.toolCursor.anchor.set(.5,.5),this.toolCursor.visible=!1,this.stage.addChild(this.toolCursor),this.editorTools[0]=new d.Container,this.editorTools[1]=new d.Container;for(var i=[[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],u["/img/editor_x.png"].texture],[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],u["/img/editor_x.png"].texture]],s=[],e=["R","G","B","Y","P","J","0","R","G","B","Y","P","J","0"],o=0;o<i.length;o++){s[o]=[];for(var a=0;a<i[o].length;a++){var r=0,n=0;a>0&&(r=8),o>0&&(n=8),s[o][a]=new c(i[o][a]),s[o][a].interactive=!0,s[o][a].buttonMode=!0,s[o][a].puyoIndex=7*o+a,s[o][a].puyoColor=e[7*o+a],s[o][a].targetLayer=7*o+a<7?"main":"shadow",s[o][a].anchor.set(.5,.5);var l=void 0;l=e[7*o+a]===y?"red":e[7*o+a]===f?"green":e[7*o+a]===m?"blue":e[7*o+a]===D?"yellow":e[7*o+a]===S?"purple":e[7*o+a]===w?"garbage":"spacer",console.log(l),void 0!==l&&"spacer"!==l&&!0===this.colorSettings[l].tint&&(s[o][a].tint=this.rgbToHex(this.colorSettings[l].r,this.colorSettings[l].g,this.colorSettings[l].b)),s[o][a].on("pointerdown",function(){t.editorCurrentTool.page=0,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),s[o][a].x=88+(s[o][a].width+r)*a,s[o][a].y=820+(s[o][a].height+n)*o,this.editorTools[0].addChild(s[o][a])}}for(var h=[[u["/img/arrow.png"].texture,u["/img/arrow.png"].texture,u["/img/arrow.png"].texture,u["/img/arrow.png"].texture,u["/img/arrow_x.png"].texture,u["/img/cursor.png"].texture,u["/img/cursor_x.png"].texture]],p=[],g=["L","U","R","D","0","1","0"],v=0;v<h.length;v++){p[v]=[];for(var b=0;b<h[v].length;b++){var C=0,x=0;b>0&&(C=8),v>0&&(x=8),p[v][b]=new c(h[v][b]),p[v][b].interactive=!0,p[v][b].buttonMode=!0,p[v][b].puyoIndex=7*v+b,p[v][b].puyoColor=g[7*v+b],"L"===g[7*v+b]?p[v][b].rotation=1.5*Math.PI:"R"===g[7*v+b]?p[v][b].rotation=.5*Math.PI:"D"===g[7*v+b]&&(p[v][b].rotation=Math.PI),p[v][b].targetLayer=7*v+b<5?"arrow":"cursor",p[v][b].anchor.set(.5,.5),p[v][b].on("pointerdown",function(){t.editorCurrentTool.page=1,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),p[v][b].x=88+(64+C)*b,p[v][b].y=820+(60+x)*v,this.editorTools[1].addChild(p[v][b])}}this.editorWindow.left=new c(u["/img/picker_arrow_left.png"].texture),this.editorWindow.left.x=0,this.editorWindow.left.y=720,this.editorWindow.left.interactive=!0,this.editorWindow.left.buttonMode=!0,this.editorWindow.left.visible=!1,this.editorWindow.left.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.left),this.editorWindow.right=new c(u["/img/picker_arrow_right.png"].texture),this.editorWindow.right.x=552,this.editorWindow.right.y=720,this.editorWindow.right.interactive=!0,this.editorWindow.right.buttonMode=!0,this.editorWindow.right.visible=!1,this.editorWindow.right.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.right),this.editorTools[0].visible=!1,this.stage.addChild(this.editorTools[0]),this.editorTools[1].visible=!1,this.stage.addChild(this.editorTools[1])},openToolbox:function(t){this.timers.editBubble+=t;var i=this.timers.editBubble;this.fieldDisplay.disableTouchBehind.interactive=!0,this.timers.editBubble<=15?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.openToolbox),this.ticker.add(this.displayTools),this.editorWindow.left.visible=!0,this.editorWindow.right.visible=!0,this.timers.toolIntroFade=0)},displayTools:function(t){this.timers.toolIntroFade+=t;var i=this.timers.toolIntroFade,s=[],e=[];if(this.editorTools[this.toolPage].visible=!0,this.updateToolboxSelection(),i<=2*this.editorTools[this.toolPage].children.length+12){for(var o=0;o<this.editorTools[this.toolPage].children.length;o++)s.push(0-2*o);for(var a=0;a<this.editorTools[this.toolPage].children.length;a++)e.push((s[a]+i)/12),this.editorTools[this.toolPage].children[a].alpha=a<7?e[a]:.17*e[a],a===this.editorCurrentTool.item&&(this.toolCursor.alpha=e[a])}else this.ticker.remove(this.displayTools),this.updateToolboxSelection(),console.log("removed tool ticker")},updateToolboxSelection:function(){this.editorCurrentTool.page===this.toolPage?(this.toolCursor.visible=!0,this.toolCursor.position.set(this.editorCurrentTool.x,this.editorCurrentTool.y)):this.toolCursor.visible=!1},targetLayer:function(t){if("main"===t)for(var i=0;i<this.Field.totalRows;i++)for(var s=0;s<this.Field.columns;s++)this.puyoDisplay[i][s].interactive=!0,this.shadowDisplay[i][s].interactive=!1,this.cursorDisplay[i][s].interactive=!1,this.arrowDisplay[i][s].interactive=!1;else if("shadow"===t)for(var e=0;e<this.Field.totalRows;e++)for(var o=0;o<this.Field.columns;o++)this.puyoDisplay[e][o].interactive=!1,this.shadowDisplay[e][o].interactive=!0,this.cursorDisplay[e][o].interactive=!1,this.arrowDisplay[e][o].interactive=!1;else if("cursor"===t)for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.puyoDisplay[a][r].interactive=!1,this.shadowDisplay[a][r].interactive=!1,this.cursorDisplay[a][r].interactive=!0,this.arrowDisplay[a][r].interactive=!1;else if("arrow"===t)for(var n=0;n<this.Field.totalRows;n++)for(var l=0;l<this.Field.columns;l++)this.puyoDisplay[n][l].interactive=!1,this.shadowDisplay[n][l].interactive=!1,this.cursorDisplay[n][l].interactive=!1,this.arrowDisplay[n][l].interactive=!0},closeToolbox:function(t){this.timers.editBubble-=t;var i=this.timers.editBubble;this.editorTools[this.toolPage].visible=!1,this.editorWindow.left.visible=!1,this.editorWindow.right.visible=!1,this.toolCursor.visible=!1,this.ticker.remove(this.displayTools),this.timers.editBubble>=0?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.closeToolbox),this.gameState="idle",this.timers.editBubble=0,this.fieldDisplay.editBubble.visible=!1,this.fieldDisplay.disableTouchBehind.interactive=!1)},gameLoop:function(t){"idle"===this.gameState?this.stateEditField(t):"dropping"===this.gameState&&!1===this.needToReset?(this.animateDropPuyos(t),!0===this.needToChangeSlides&&this.animateDropDumpPuyos(t)):"popping"===this.gameState&&!1===this.needToReset&&this.animatePopPuyos(t),this.animateCursors(t),this.animateArrows(t),!0===this.inFocus&&(this.animateCursors(t),this.animateArrows(t),this.renderer.render(this.stage))},stateEditField:function(t){},animateDropPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var s=t*this.simulationSpeed,e=0;e<Math.round(s);e++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.dropDistances[o][a]>0&&("idle"===this.puyoStates[o][a]||"checkDrops"===this.puyoStates[o][a]?this.puyoStates[o].splice(a,1,"dropping"):"dropping"===this.puyoStates[o][a]?this.puyoDisplay[o][a].y+this.Field.map[o][a].vy<this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight?(this.puyoDisplay[o][a].y+=this.Field.map[o][a].vy,this.Field.map[o][a].vy+=.703125*i):(this.puyoStates[o].splice(a,1,"bouncing"),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight+this.Field.cellHeight/2,this.puyoDisplay[o][a].anchor.set(.5,1)):"bouncing"===this.puyoStates[o][a]&&(this.cellTimer[o][a]+=1,this.cellTimer[o][a]<=8?(this.puyoDisplay[o][a].scale.y-=.025,this.puyoDisplay[o][a].scale.x+=.025):this.cellTimer[o][a]<=16?(this.puyoDisplay[o][a].scale.y+=.025,this.puyoDisplay[o][a].scale.x-=.025):(this.puyoDisplay[o][a].anchor.set(.5,.5),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight,this.puyoStates[o].splice(a,1,"checkPops"),this.droppingCells[o].splice(a,1,!1),this.dropDistances[o].splice(a,1,0),this.cellTimer[o].splice(a,1,0))));!1===this.stopGame&&(this.frame+=1)},animateDropDumpPuyos:function(t){!0===this.stopGame&&(t=0);var i=t*this.simulationSpeed;console.log(i);for(var s=0;s<Math.round(i);s++)for(var e=0;e<this.Field.totalRows;e++)for(var o=0;o<this.Field.columns;o++)this.dropDumpDistances[e][o]>0&&(console.log("Detected cells with distance needed greater than 0"),"idle"===this.dumpPuyoStates[e][o]||"checkDrops"===this.dumpPuyoStates[e][o]?this.dumpPuyoStates[e].splice(o,1,"dropping"):"dropping"===this.dumpPuyoStates[e][o]?this.dumpDisplay[e][o].y+this.dumpVelocity[e][o]<this.dumpCoordArray[e][o].y+this.dropDumpDistances[e][o]*this.Field.cellHeight?(console.log("dropping dumps"),this.dumpDisplay[e][o].y+=this.dumpVelocity[e][o],this.dumpVelocity[e][o]+=.703125):(console.log("dump bounce state"),this.dumpPuyoStates[e].splice(o,1,"bouncing"),this.dumpDisplay[e][o].y=this.dumpCoordArray[e][o].y+this.dropDumpDistances[e][o]*this.Field.cellHeight+this.Field.cellHeight/2,this.dumpDisplay[e][o].anchor.set(.5,1)):"bouncing"===this.dumpPuyoStates[e][o]&&(this.dumpCellTimer[e][o]+=1,this.dumpCellTimer[e][o]<=8?(this.dumpDisplay[e][o].scale.y-=.025,this.dumpDisplay[e][o].scale.x+=.025):this.dumpCellTimer[e][o]<=16?(this.dumpDisplay[e][o].scale.y+=.025,this.dumpDisplay[e][o].scale.x-=.025):(console.log("it is no more."),this.dumpDisplay[e][o].anchor.set(.5,.5),this.dumpDisplay[e][o].y=this.dumpCoordArray[e][o].y+this.dropDumpDistances[e][o]*this.Field.cellHeight,this.dumpPuyoStates[e].splice(o,1,"checkPops"),this.droppingDumpCells[e].splice(o,1,!1),this.dropDumpDistances[e].splice(o,1,0),this.dumpCellTimer[e].splice(o,1,0),this.dumpVelocity[e].splice(o,1,3.75))));!1===this.stopGame&&(this.frame+=1)},animatePopPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var s=t*this.simulationSpeed,e=0;e<Math.round(s);e++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)!0===this.poppingCells[o][a]?(this.puyoStates[o].splice(a,1,"popping"),Math.cos(i/3*Math.PI)>=0?this.puyoDisplay[o][a].alpha=1:this.puyoDisplay[o][a].alpha=0,this.cellTimer[o][a]+=1,this.cellTimer[o][a]>=24&&(console.log("need to finish popping"),this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0))):(this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0));!1===this.stopGame&&(this.frame+=1)},animateCursors:function(t){for(var i=this.timers.cursor,s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)Math.cos(i/60*Math.PI)>=0?this.cursorDisplay[s][e].scale.set(.9,.9):this.cursorDisplay[s][e].scale.set(1,1);this.timers.cursor+=t},setDropData:function(){for(var t=o.a.Simulate.dropPuyos(this.Field),i=[],s=0;s<this.Field.totalRows;s++){i[s]=[];for(var e=0;e<this.Field.columns;e++)t.dropDistances[s][e]>0?i[s][e]=!0:i[s][e]=!1}this.droppingCells=i,this.dropDistances=t.dropDistances,this.dropPuyosResult=o.a.mapToStringArray(t.dropResult)},setPopData:function(){var t=o.a.Simulate.clearPuyos(this.Field);this.poppingCells=t.animationMatrix,this.clearPuyosResult=o.a.mapToStringArray(t.newField.map),0!==t.popData.poppingGroups.length?this.calculateScore(t.popData):this.gameState="chainStopped"},mergeInShadowLayer:function(t){for(var i=0;i<this.Field.totalRows;i++)for(var s=0;s<this.Field.columns;s++)"0"!==this.shadowData[i][s]&&this.shadowData[i][s]!==this.fieldData[i][s]&&(this.fieldData[i].splice(s,1,this.shadowData[i][s]),!0===t&&(console.log("Replacing old shadow puyo forever..."),this.shadowData[i].splice(s,1,"0"),this.updateShadowSprite(s,i)));this.updatePuyoSprites(),console.log("merged shadow layer")},setMouseDown:function(t){this.isMouseDown=t},controlField:function(t){if("reset"===t){for(var i in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[i]=0;this.resetField()}else if("back"===t)console.log("I didn't make a function for back yet.");else if("pause"===t)this.chainAutoPlay=!1;else if("play"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!1),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||(this.simulationSpeed=24),this.playStep();else if("auto"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!1),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||8!==this.simulationSpeed?"popping"===this.gameState||"dropping"===this.gameState?this.simulationSpeed=8:"chainStopped"===this.gameState&&(this.simulationSpeed=1):this.simulationSpeed=24,this.playChain();else if("edit"===t)"editor"!==this.gameState?(this.ticker.add(this.openToolbox),this.ticker.remove(this.closeToolbox),this.gameState="editor",this.fieldDisplay.editBubble.visible=!0):"editor"===this.gameState&&(this.gameState="idle",this.ticker.remove(this.openToolbox),this.ticker.add(this.closeToolbox));else if("empty"===t){for(var s in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[s]=0;this.emptyField()}},resetField:function(){var t=this;this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=t.fieldOriginal,t.needToReset=!1})},emptyField:function(){var t=this;this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.updatePuyoSprites(),t.shadowData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.cursorData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.arrowData=n("0",t.fieldSettings.totalRows,t.fieldSettings.columns);for(var i=0;i<t.Field.totalRows;i++)for(var s=0;s<t.Field.columns;s++)t.updateShadowSprite(s,i),t.updateCursorSprite(s,i),t.updateArrowSprite(s,i);t.needToReset=!1})},calculateScore:function(t){this.chainLength+=1;var i=Object(e.a)(new Set(t.poppingColors));console.log(i);for(var s=this.fieldSettings.colorBonus[i.length-1],o=this.fieldSettings.chainPower[this.chainLength-1],a=0,r=0,n=0;n<t.poppingGroups.length;n++){var l=t.poppingGroups[n].length;r+=l,a+=l>=11?this.fieldSettings.groupBonus[this.fieldSettings.groupBonus.length-1]:this.fieldSettings.groupBonus[l-4]}var h=o+s+a;h<1?h=1:h>999&&(h=999),this.stepScore=10*r*h,this.score+=this.stepScore,this.calculateGarbage()},calculateGarbage:function(){this.garbagePoints=this.stepScore/this.fieldSettings.targetPoint+this.leftoverGarbagePoints,this.stepGarbage=Math.floor(this.garbagePoints),this.leftoverGarbagePoints=this.garbagePoints-this.stepGarbage,this.garbage+=this.stepGarbage},animateChainCounter:function(t){var i=this.timers.chainLength;this.timers.chainLength+=t,this.timers.chainLength<=30?(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY-16*(-1/225*Math.pow(i-15,2)+1)):(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.remove(this.animateChainCounter),console.log("counter bounce over"))},animateGarbageTray:function(t){var i=this.timers.garbageTray,s=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;if(i<8){for(var e=0;e<6;e++)this.garbageDisplay[e].x=this.garbageDisplay[e].x+(this.garbageDisplay[e].origX-s)/8;for(var o=0;o<3;o++)this.garbageDisplay[o].x<this.garbageDisplay.origX&&(this.garbageDisplay[o].x=this.garbageDisplay.origX);for(var a=3;a<6;a++)this.garbageDisplay[a].x>this.garbageDisplay.origX&&(this.garbageDisplay[a].x=this.garbageDisplay.origX);this.timers.garbageTray+=1}else this.ticker.remove(this.animateGarbageTray),console.log("removed garbage tray animation")},animateArrows:function(t){for(var i=this.timers.arrow,s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)"R"===this.arrowData[s][e]&&(this.arrowDisplay[s][e].x=this.coordArray[s][e].x+8*Math.cos(i/60*Math.PI)),"L"===this.arrowData[s][e]&&(this.arrowDisplay[s][e].x=this.coordArray[s][e].x-8*Math.cos(i/60*Math.PI)),"U"===this.arrowData[s][e]&&(this.arrowDisplay[s][e].y=this.coordArray[s][e].y-8*Math.cos(i/60*Math.PI)),"D"===this.arrowData[s][e]&&(this.arrowDisplay[s][e].y=this.coordArray[s][e].y+8*Math.cos(i/60*Math.PI));this.timers.arrow+=t},animateNextPuyos:function(t){var i=this.timers.next;if(this.nextPuyoPairs[0].y=this.nextCoord[0].y-(this.nextCoord[0].y-106)/8*i,this.nextPuyoPairs[1].x=this.nextCoord[1].x-(this.nextCoord[1].x-this.nextCoord[0].x)/8*i,this.nextPuyoPairs[1].y=this.nextCoord[1].y-(this.nextCoord[1].y-this.nextCoord[0].y)/8*i,this.nextPuyoPairs[1].scale.set(.8+.025*i,.8+.025*i),this.nextPuyoPairs[2].y=this.nextCoord[2].y-(this.nextCoord[2].y-this.nextCoord[1].y)/8*i,i>=8)return this.ticker.remove(this.animateNextPuyos),this.nextQueuePosition+=2,this.timers.next=0,this.updateNextPuyoSprites(),this.updateDumpDisplay(),this.setDumpMatrixDropData(),this.needToChangeSlides=!0,void this.controlField("play");this.timers.next+=1},playStep:function(){"idle"===this.gameState?(this.chainAutoPlay=!1,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!1,this.gameState="dropping")},playChain:function(){"idle"===this.gameState?(this.chainAutoPlay=!0,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!0,this.gameState="dropping")},setDumpMatrixDropData:function(){for(var t=new o.a.Field({columns:6,visibleRows:12,hiddenRows:14,totalRows:26,puyoToClear:4},this.combinedMatrix),i=o.a.Simulate.dropPuyos(t),s=[],e=0;e<this.Field.totalRows;e++){s[e]=[];for(var a=0;a<this.Field.columns;a++)i.dropDistances[e][a]>0?s[e][a]=!0:s[e][a]=!1}for(var r=[],n=0;n<this.Field.totalRows;n++){r[n]=[];for(var l=0;l<this.Field.columns;l++)r[n][l]=i.dropDistances[n][l]}this.droppingDumpCells=s,this.dropDumpDistances=r},updateWithNextSlide:function(){console.log("Updating with next slide"),this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.gameState="idle",this.shadowData=l(this.importedData[this.currentSlide+1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.importedData[this.currentSlide+1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.importedData[this.currentSlide+1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide+=1;for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.updateShadowSprite(i,t),this.updateCursorSprite(i,t),this.updateArrowSprite(i,t)},prevSlide:function(){if(this.currentSlide>0&&"idle"===this.gameState){this.poppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=n(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=n(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=l(this.importedData[this.currentSlide-1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,this.nextQueuePosition-=2;for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.dumpDisplay[t][i].visible=!1;this.shadowData=l(this.importedData[this.currentSlide-1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=l(this.importedData[this.currentSlide-1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=l(this.importedData[this.currentSlide-1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide-=1,this.updatePuyoSprites(),this.updateNextPuyoSprites();for(var s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)this.updateShadowSprite(e,s),this.updateCursorSprite(e,s),this.updateArrowSprite(e,s)}},nextSlide:function(){this.currentSlide<this.importedData.length-1&&"idle"===this.gameState?(this.fieldData=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),this.ticker.add(this.animateNextPuyos)):console.log("No more slides")},countGarbage:function(t,i){this.checkCrown(t,i)},checkCrown:function(t,i){i<6&&(t-720>=0?(this.garbageIcons.splice(i,1,"crown"),this.checkCrown(t-720,i+1)):this.checkMoon(t,i))},checkMoon:function(t,i){i<6&&(t-360>=0?(this.garbageIcons.splice(i,1,"moon"),this.checkStar(t-360,i+1)):this.checkStar(t,i))},checkStar:function(t,i){i<6&&(t-180>=0?(this.garbageIcons.splice(i,1,"star"),this.checkRock(t-180,i+1)):this.checkRock(t,i))},checkRock:function(t,i){i<6&&(t-30>=0?(this.garbageIcons.splice(i,1,"rock"),this.checkRock(t-30,i+1)):this.checkLine(t,i))},checkLine:function(t,i){i<6&&(t-6>=0?(this.garbageIcons.splice(i,1,"line"),this.checkLine(t-6,i+1)):this.checkUnit(t,i))},checkUnit:function(t,i){i<6&&t-1>=0&&(this.garbageIcons.splice(i,1,"unit"),this.checkUnit(t-1,i+1))}},computed:{chainDiff:function(){if(void 0!==this.importedData){for(var t=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),i=l(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),s=[],e=0;e<this.fieldSettings.totalRows;e++){s[e]=[];for(var a=0;a<this.fieldSettings.columns;a++)"0"===t[e][a]&&"0"!==i[e][a]?s[e][a]=i[e][a]:s[e][a]="0"}var r=new o.a.Field(this.fieldSettings,s);return o.a.mapToStringArray(o.a.Simulate.dropPuyos(r).dropResult)}return n("0",this.fieldSettings.totalRows,this.fieldSettings.columns)},combinedMatrix:function(){for(var t=JSON.parse(JSON.stringify(this.chainDiff)),i=l(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),s=0;s<this.Field.totalRows;s++)t.push(i[s]);return t},Field:function(){return new o.a.Field(this.fieldSettings,this.fieldData)},coordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var s=0;s<this.Field.columns;s++)t[i][s]={x:s*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124}}return t},dumpCoordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var s=0;s<this.Field.columns;s++)t[i][s]={x:s*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124-60*this.Field.totalRows}}return t},isPopping:function(){if(this.poppingCells.length===this.Field.totalRows&&this.poppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.poppingCells[t][i])return!0;return!1},isDropping:function(){if(this.droppingCells.length===this.Field.totalRows&&this.droppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.droppingCells[t][i])return!0;if(!0===this.needToChangeSlides&&this.droppingDumpCells.length===this.Field.totalRows&&this.droppingDumpCells[0].length===this.Field.columns)for(var s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)if(!0===this.droppingDumpCells[s][e])return!0;return!1},Easers:function(){return{editBubble:g(.14,.18,0,1.16)}},fieldDataString:function(){return h(this.fieldData).join("")},shadowDataString:function(){return h(this.shadowData).join("")},cursorDataString:function(){return h(this.cursorData).join("")},arrowDataString:function(){return h(this.arrowData).join("")},scoreString:function(){var t=this.score.toString(),i=8-t.length;if(t.length>8)return"99999999";for(var s=0;s<i;s++)t="0"+t;return t},chainLengthString:function(){var t=this.chainLength.toString();return t.length<2&&(t="0"+t),t},inFocus:function(){return void 0!==this.showModal?!0===this.showModal?(console.log("Chainsim entering focus."),!0):(console.log("Chainsim exiting focus"),!1):(console.log("Show modal undefined"),!1)}},watch:{gameState:function(t,i){var s=this;if(this.frame=0,"dropping"===t?(console.log("Checking drops"),this.setDropData(),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),!1===this.isDropping&&(!0===this.needToChangeSlides?this.updateWithNextSlide():this.gameState="popping")):"popping"===t?(console.log("Checking pops"),this.setPopData(),this.puyoStates=n("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites()):"idle"===t&&this.ticker.addOnce(function(){console.log("resetting field"),s.updatePuyoSprites();for(var t=0;t<s.Field.totalRows;t++)for(var i=0;i<s.Field.columns;i++)s.dumpDisplay[t][i].visible=!1}),"idle"===t||"editor"===t)for(var e=0;e<this.Field.totalRows;e++)for(var o=0;o<this.Field.columns;o++)this.shadowDisplay[e][o].visible=!0,this.cursorDisplay[e][o].visible=!0,this.arrowDisplay[e][o].visible=!0;else for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.shadowDisplay[a][r].visible=!1,this.cursorDisplay[a][r].visible=!1,this.arrowDisplay[a][r].visible=!1},isPopping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):(this.fieldData=this.clearPuyosResult,console.log("set cleared puyo field"),this.gameState="dropping"))},isDropping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):void 0!==this.importedData&&this.currentSlide<this.importedData.length-1&&!0===this.needToChangeSlides?!0===this.importedData[this.currentSlide+this.slideChange].autoDrop&&this.updateWithNextSlide():(this.fieldData=this.dropPuyosResult,console.log("Dropped the new puyo field"),this.updatePuyoSprites(),!0===this.chainAutoPlay?this.gameState="popping":(this.simulationSpeed=1,this.gameState="chainStopped")))},needToChangeSlides:function(t,i){if(!0===t)for(var s=0;s<this.Field.totalRows;s++)for(var e=0;e<this.Field.columns;e++)this.shadowDisplay[s][e].visible=!1,this.cursorDisplay[s][e].visible=!1,this.arrowDisplay[s][e].visible=!1},chainLength:function(){this.ticker.remove(this.animateChainCounter),this.timers.chainLength=0,this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.add(this.animateChainCounter)},garbage:function(){this.ticker.remove(this.animateGarbageTray),this.timers.garbageTray=0;for(var t=0;t<6;t++)this.garbageDisplay[t].x=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;this.garbageIcons=["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],this.countGarbage(this.garbage,0),console.log(this.garbageDisplay);for(var i=0;i<6;i++)this.garbageDisplay[i].texture=this.puyoSprites["".concat(this.garbageIcons[i],".png")];this.ticker.add(this.animateGarbageTray)},scoreString:function(){if(!0===this.gameLoaded)for(var t=0;t<8;t++)this.scoreDisplay[t].texture=this.fieldSprites["score_".concat(this.scoreString[t],".png")]},chainLengthString:function(){this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText.alpha=0,"0"!==this.chainLengthString[0]?(this.chainCounterDisplay.firstDigit.alpha=1,this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[0],".png")]):this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["spacer.png"],this.chainLength>0?(this.chainCounterDisplay.secondDigit.alpha=1,this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[1],".png")],this.chainCounterDisplay.chainText.alpha=1):this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["spacer.png"]}}},C=(s(169),s(1)),x=Object(C.a)(b,function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("div",{staticClass:"game-container"},[s("div",{ref:"game",attrs:{id:"game"}})]),t._v(" "),t.gameLoaded?s("div",t._l(t.fieldControls,function(i,e){return s("chainsim-control-button",{key:"Control_"+e,attrs:{gameLoaded:t.gameLoaded,fieldSprites:t.fieldSprites,button:i,buttonName:e},on:{controlField:t.controlField}})})):t._e()])},[],!1,null,null,null);x.options.__file="Chainsim.vue";i.default=x.exports}}]);