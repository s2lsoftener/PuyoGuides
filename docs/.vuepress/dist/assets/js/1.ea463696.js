(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{127:function(t,i){t.exports=!1},128:function(t,i,e){"use strict";e.d(i,"a",function(){return s});var s=new(e(0).a)({data:{assetsLoaded:!1},methods:{setLoaded:function(){this.assetsLoaded=!0}}})},130:function(t,i,e){"use strict";e(131);var s=e(7),o=e(81),a=e(5),r=/./.toString,n=function(t){e(10)(RegExp.prototype,"toString",t,!0)};e(6)(function(){return"/a/b"!=r.call({source:"a",flags:"b"})})?n(function(){var t=s(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?o.call(t):void 0)}):"toString"!=r.name&&n(function(){return r.call(this)})},131:function(t,i,e){e(5)&&"g"!=/./g.flags&&e(8).f(RegExp.prototype,"flags",{configurable:!0,get:e(81)})},132:function(t,i,e){"use strict";e(82)("anchor",function(t){return function(i){return t(this,"a","name",i)}})},133:function(t,i,e){"use strict";var s={Puyo:{None:"0",Red:"R",Green:"G",Blue:"B",Yellow:"Y",Purple:"P",Nuisance:"J",Point:"T",Sun:"S",Hard:"H",Iron:"I",Block:"L"}},o=function(t,i,e){this.puyo=t,this.x=i,this.y=e,this.newY=e,this.yDiff=this.newY-this.y,this.toPop=!1,this.toDrop=!1,this.vy=0,this.accel=.703125};o.prototype={isColoredPuyo:function(){return this.puyo===s.Puyo.Red||this.puyo===s.Puyo.Green||this.puyo===s.Puyo.Blue||this.puyo===s.Puyo.Yellow||this.puyo===s.Puyo.Purple},checkSides:function(t){var i=[];return this.x>0&&t.map[this.y][this.x].puyo===t.map[this.y][this.x-1].puyo&&i.push(t.map[this.y][this.x-1]),this.y>t.hiddenRows&&t.map[this.y][this.x].puyo===t.map[this.y-1][this.x].puyo&&i.push(t.map[this.y-1][this.x]),this.x<t.columns-1&&t.map[this.y][this.x].puyo===t.map[this.y][this.x+1].puyo&&i.push(t.map[this.y][this.x+1]),this.y<t.totalRows-1&&t.map[this.y][this.x].puyo===t.map[this.y+1][this.x].puyo&&i.push(t.map[this.y+1][this.x]),i},adjacentPuyos:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo!==s.Puyo.Red&&i[o].puyo!==s.Puyo.Green&&i[o].puyo!==s.Puyo.Blue&&i[o].puyo!==s.Puyo.Yellow&&i[o].puyo!==s.Puyo.Purple||e.push(i[o]);return e},adjacentNuisance:function(t){for(var i=this.checkSides(t),e=[],o=0;o<i.length;o++)i[o].puyo===s.Puyo.Nuisance&&e.push(i[o]);return e}};var a={Constants:s,Puyo:o,Field:function(t,i){var e,a;this.visibleRows=t.visibleRows,this.columns=t.columns,this.hiddenRows=t.hiddenRows,this.totalRows=t.visibleRows+t.hiddenRows,this.cellWidth=64,this.cellHeight=60,this.puyoToClear=4,this.fieldWidthPx=this.cellWidth*(this.columns+2),this.fieldHeightPx=this.cellHeight*(this.visibleRows+this.hiddenRows+2),e=i.length>=this.totalRows?this.totalRows:i.length,a=i[0].length>=this.columns?this.columns:i[0].length;var r=i.length-this.totalRows;if(void 0!==i){this.map=[];for(var n=0;n<i.length;n++){this.map[n]=[];for(var h=0;h<i[n].length;h++)this.map[n][h]=new o(s.Puyo.None,h,n)}for(var l=e-1;l>=r||l>=0;l--)for(var d=0;d<a;d++)this.map[l][d]=new o(i[l][d],d,l)}else{this.map=[];for(var p=0;p<i.length;p++){this.map[p]=[];for(var c=0;c<i[p].length;c++)this.map[p][c]=new o(s.Puyo.None,c,p)}}},Simulate:{filterColors:function(t,i,e){return e.indexOf(t===i)},checkPops:function(t){for(var i=[],e=0;e<t.totalRows;e++){i[e]=[];for(var s=0;s<t.columns;s++)i[e][s]=!1}for(var o=[],a=[],r=t.hiddenRows;r<t.totalRows;r++)for(var n=0;n<t.columns;n++)if(t.map[r][n].isColoredPuyo()&&!1===i[r][n]){i[r][n]=!0;var h=[];h.push(t.map[r][n]);for(var l=0;l<h.length;l++)for(var d=h[l].checkSides(t),p=0;p<d.length;p++){var c=d[p];c.puyo===h[l].puyo&&!1===i[c.y][c.x]&&(i[c.y][c.x]=!0,h.push(c))}h.length>=t.puyoToClear&&(o.push(h),a.push(h[0].puyo))}return{poppingGroups:o,poppingColors:a.filter(this.filterColors)}},checkGarbagePops:function(t,i){for(var e=[],o=0;o<t.totalRows;o++){e[o]=[];for(var a=0;a<t.columns;a++)e[o][a]=!1}if(i.poppingGroups.length>0){var r=i.poppingGroups,n=[];for(var h in r)for(var l in r[h]){var d=r[h][l].x,p=r[h][l].y;p>0&&t.map[p-1][d].puyo===s.Puyo.Nuisance&&!1===e[p-1][d]&&(e[p-1][d]=!0,n.push(t.map[p-1][d])),d>0&&t.map[p][d-1].puyo===s.Puyo.Nuisance&&!1===e[p][d-1]&&(e[p][d-1]=!0,n.push(t.map[p][d-1])),d<t.columns-1&&t.map[p][d+1].puyo===s.Puyo.Nuisance&&!1===e[p][d+1]&&(e[p][d+1]=!0,n.push(t.map[p][d+1])),p<t.visibleRows+t.hiddenRows-1&&t.map[p+1][d].puyo===s.Puyo.Nuisance&&!1===e[p+1][d]&&(e[p+1][d]=!0,n.push(t.map[p+1][d]))}return n}return[]},clearPuyos:function(t){for(var i=JSON.parse(JSON.stringify(t)),e=this.checkPops(t),a=this.checkGarbagePops(t,e),r=[],n=0;n<t.totalRows;n++){r[n]=[];for(var h=0;h<t.columns;h++)r[n][h]=!1}if(e.poppingGroups.length>0){var l=e.poppingGroups;for(var d in l)for(var p in l[d]){var c=l[d][p].x,u=l[d][p].y;l[d][p].toPop=!0,i.map[u][c]=new o(s.Puyo.None,c,u),r[u][c]=!0}}if(a.length>0)for(var g in a){var f=a[g].x,y=a[g].y;a[g].toPop=!0,i.map[y][f]=new o(s.Puyo.None,f,y),r[y][f]=!0}return{newField:i,popData:e,garbageToClear:a,animationMatrix:r}},dropPuyos:function(t){for(var i=[],e=0;e<t.totalRows;e++)i[e]=[];for(var a=0;a<t.columns;a++){for(var r=[],n=t.totalRows-1;n>=0;n--)r.push(t.map[n][a]);for(var h=[],l=0;l<r.length;l++)r[l].puyo!==s.Puyo.None&&h.push(r[l]);for(var d=[],p=0;p<h.length;p++)if(h[p].puyo===s.Puyo.Block){var c=t.totalRows-1-h[p].y;if(d.length<c){var u=new o(s.Puyo.None,a,t.totalRows-1-d.length);d.push(u),p-=1}else d.push(h[p])}else d.push(h[p]);for(var g=d.length;g<t.totalRows;g++){var f=new o(s.Puyo.None,a,t.totalRows-1-d.length);d.push(f)}d.reverse();for(var y=0;y<d.length;y++)i[y][a]=d[y]}for(var m=0;m<i.length;m++)for(var w=0;w<i[m].length;w++)i[m][w].newY=m,i[m][w].yDiff=i[m][w].newY-i[m][w].y;for(var D=[],S=[],v=0;v<t.totalRows;v++){D[v]=[],S[v]=[];for(var b=0;b<t.columns;b++)D[v][b]=i[v][b],S[v][b]=t.map[v][b].yDiff}return{dropResult:D,dropDistances:S}}},mapToStringArray:function(t){for(var i=[],e=0;e<t.length;e++){i[e]=[];for(var s=0;s<t[0].length;s++)i[e][s]=t[e][s].puyo}return i},stringTo2dArray:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t[6*o+a]}return s},uniformMatrix:function(t,i,e){for(var s=[],o=0;o<i;o++){s[o]=[];for(var a=0;a<e;a++)s[o][a]=t}return s},flatten2dTo1d:function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[0].length;s++)i.push(t[e][s]);return i}};i.a=a},143:function(t,i,e){},162:function(t,i,e){!function(i,s){t.exports=s(e(170))}(0,function(t){return function(t){var i={};function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}return e.m=t,e.c=i,e.p="",e(0)}([function(t,i,e){var s;s=e(1),t.exports={props:{inViewportActive:{type:Boolean,default:!0},inViewportOnce:{type:Boolean,default:!1},inViewportOffset:{type:Number,default:0},inViewportOffsetTop:{type:Number,default:null},inViewportOffsetBottom:{type:Number,default:null}},data:function(){return{inViewport:{now:null,fully:null,above:null,below:null,listening:!1}}},computed:{inViewportOffsetTopComputed:function(){var t;return null!=(t=this.inViewportOffsetTop)?t:this.inViewportOffset},inViewportOffsetBottomComputed:function(){var t;return null!=(t=this.inViewportOffsetBottom)?t:this.inViewportOffset},inViewportOffsetComputed:function(){return{top:this.inViewportOffsetTopComputed,bottom:this.inViewportOffsetBottomComputed}}},mounted:function(){return this.$nextTick(this.inViewportInit)},destroyed:function(){return this.removeInViewportHandlers()},watch:{inViewportActive:function(t){return t?this.addInViewportHandlers():this.removeInViewportHandlers()},inViewportOffsetComputed:{deep:!0,handler:function(){return this.removeInViewportHandlers(),this.inViewportInit()}}},methods:{inViewportInit:function(){if(this.inViewportActive)return this.addInViewportHandlers()},addInViewportHandlers:function(){if(!this.inViewport.listening)return this.inViewport.listening=!0,this.scrollMonitor=s.create(this.$el,this.inViewportOffsetComputed),this.scrollMonitor.on("stateChange",this.updateInViewport),this.updateInViewport()},removeInViewportHandlers:function(){if(this.inViewport.listening)return this.inViewport.listening=!1,this.scrollMonitor&&this.scrollMonitor.destroy(),delete this.scrollMonitor},updateInViewport:function(){if(this.inViewport.now=this.scrollMonitor.isInViewport,this.inViewport.fully=this.scrollMonitor.isFullyInViewport,this.inViewport.above=this.scrollMonitor.isAboveViewport,this.inViewport.below=this.scrollMonitor.isBelowViewport,this.inViewportOnce&&this.inViewport.now)return this.removeInViewportHandlers()}}}},function(i,e){i.exports=t}])})},164:function(t,i,e){"use strict";e.r(i);e(12),e(17),e(83);var s=e(9),o=(e(130),e(132),e(133)),a=e(128),r=e(127),n=null,h=null,l=null,d=null;e.n(r).a||(n=window.PIXI,h=n.loader,l=n.loader.resources,d=n.Sprite,window.BezierEasing);var p=e(162),c=o.a.uniformMatrix,u=o.a.stringTo2dArray,g=o.a.flatten2dTo1d,f=o.a.Constants.Puyo.Red,y=o.a.Constants.Puyo.Green,m=o.a.Constants.Puyo.Blue,w=o.a.Constants.Puyo.Yellow,D=o.a.Constants.Puyo.Purple,S=o.a.Constants.Puyo.Nuisance,v=o.a.Constants.Puyo.None,b={name:"ChainImgField",props:["importedData","nextQueue","slideshowSlide","caption"],mixins:[p],data:function(){return{fieldSettings:{columns:6,visibleRows:12,hiddenRows:1,totalRows:13,puyoToClear:4,colorBonus:[0,3,6,12,24],groupBonus:[0,2,3,4,5,6,7,10],chainPower:[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512,544,576,608,640,672],targetPoint:70},currentSlide:0,gameMode:"editor",gameState:"idle",fieldData:[[]],fieldOriginal:[[]],fieldHistory:[],connectionData:[[]],colorNameData:[[]],shadowData:[[]],cursorData:[[]],arrowData:[[]],clearPuyosResult:[[]],dropPuyosResult:[[]],score:0,stepScore:0,garbage:0,stepGarbage:0,garbagePoints:0,leftoverGarbagePoints:0,chainLength:0,garbageIcons:["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],poppingCells:[[]],droppingCells:[[]],dropDistances:[[]],dropTimings:[[]],displayMode:"simple",modeSettings:{simple:{width:608,height:974,antialias:!0,transparent:!1,backgroundColor:398905,resolution:1},full:{width:872,height:854,antialias:!0,transparent:!1,resolution:1}},app:void 0,stage:void 0,renderer:void 0,ticker:void 0,interaction:void 0,scaleFactor:.45,texturesToLoad:["/img/arle_bg.png","/img/field.json","/img/puyo.json","/img/arrow.png","/img/arrow_x.png","/img/cursor.png","/img/cursor_x.png","/img/chain_font.json","/img/edit_bubble.png","/img/touch_disabler.png","/img/picker_arrow_left.png","/img/picker_arrow_right.png","/img/editor_x.png","/img/current_tool.png","/img/next_background_1p_mask.png"],puyoSprites:{},fieldSprites:{},scoreSprites:{},chainCountSprites:{},puyoDisplay:[[]],dumpDisplay:[[]],shadowDisplay:[],scoreDisplay:[],garbageDisplay:[],cursorDisplay:[],arrowDisplay:[],chainCounterDisplay:{},fieldDisplay:{},cellTimer:[[]],puyoStates:[[]],editorTools:[],editorSelectors:[],editorWindow:{},loadingText:"Loading...",texturesLoaded:!1,gameLoaded:!1,fieldControls:{},simulationSpeed:1,needToReset:!1,isMouseDown:!1,frame:0,delta:0,stopGame:!1,chainAutoPlay:!1,timers:{editBubble:0,toolIntroFade:0,chainLength:0,garbageTray:0,cursor:0,arrow:0,next:0},needToChangeSlides:!1,slideChange:1,needToReload:!1,editorCurrentTool:{page:0,item:6,puyo:"0",layer:"main",x:520,y:820},toolCursor:void 0,toolPage:0,nextPuyoData:"RRBGYYPP",nextPuyoPairs:[],nextQueuePosition:0,nextCoord:[{x:510,y:256},{x:556,y:376},{x:556,y:536}],controlPuyoData:[[]],controlPuyoSprites:[[]],activePair:{data:"RB"},dumpCellContainer:void 0,droppingDumpCells:[[]],dropDumpDistances:[[]],mergedDump:!1,dumpVelocity:[[]],dumpPuyoStates:[[]],dumpCellTimer:[[]],colorSettings:{red:{hue:0,brightness:100,contrast:0,saturate:0},green:{hue:0,brightness:100,contrast:0,saturate:0},blue:{hue:0,brightness:100,contrast:0,saturate:0},yellow:{hue:0,brightness:100,contrast:0,saturate:0},purple:{hue:0,brightness:100,contrast:0,saturate:0},garbage:{hue:0,brightness:100,contrast:0,saturate:0}}}},mounted:function(){this.initData(),this.initGame()},methods:{openChainsim:function(){a.a.$emit("openModal",{importedData:this.importedData,nextQueue:this.nextQueue,currentSlide:this.currentSlide})},initData:function(){this.fieldData=u(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.fieldOriginal=u(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.shadowData=u(this.importedData[this.currentSlide].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=u(this.importedData[this.currentSlide].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=u(this.importedData[this.currentSlide].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.controlPuyoData=c("0",6,this.fieldSettings.columns),this.controlPuyoData=[["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","0","0","0","0"],["0","0","B","0","0","0"],["0","0","R","0","0","0"],["0","0","0","0","0","0"]],this.connectionData=c("n",this.fieldSettings.totalRows,this.fieldSettings.columns),this.colorNameData=c("spacer",this.fieldSettings.totalRows,this.fieldSettings.columns),this.poppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.clearPuyosResult=c("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropPuyosResult=c("0",this.fieldSettings.totalRows,this.fieldSettings.columns),this.cellTimer=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.puyoStates=c("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=c("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpCellTimer=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpVelocity=c(3.75,this.fieldSettings.totalRows,this.fieldSettings.columns),this.nextPuyoData=this.nextQueue},initGame:function(){var t=this;this.renderer=new n.autoDetectRenderer(this.modeSettings.simple.width,this.modeSettings.simple.height,{antialias:!0,resolution:1,transparent:!0}),this.renderer.view.style.width="".concat(this.modeSettings.simple.width*this.scaleFactor,"px"),this.renderer.view.style.height="".concat(this.modeSettings.simple.height*this.scaleFactor,"px"),this.renderer.view.height=this.modeSettings.simple.height,this.$refs.game.appendChild(this.renderer.view),this.stage=new n.Container,new Promise(function(t,i){setInterval(function(){h.progress<100?console.log("Not loaded"):t("Assets loaded...!")},50)}).then(function(i){t.runSetup()})},runSetup:function(){var t=this;if(localStorage.getItem("puyotint"))try{this.colorSettings=JSON.parse(localStorage.getItem("puyotint")),console.log("Found color settings in localStorage")}catch(t){console.log("Removing puyotint from localStorage."),localStorage.removeItem("puyotint"),console.log("Using default color settings instead."),this.colorSettings={red:{r:255,g:255,b:255,tint:!1},green:{r:255,g:255,b:255,tint:!1},blue:{r:255,g:255,b:255,tint:!1},yellow:{r:255,g:255,b:255,tint:!1},purple:{r:255,g:255,b:255,tint:!1},garbage:{r:255,g:255,b:255,tint:!1}}}this.fieldSprites=l["/img/field.json"].textures,this.puyoSprites=l["/img/puyo.json"].textures,this.chainCountSprites=l["/img/chain_font.json"].textures,this.initFieldDisplay(),this.initScoreDisplay(),this.initGameOverX(),this.initPuyoDisplay(),this.initControlledPuyos(),this.initShadowDisplay(),this.initCursorDisplay(),this.initArrowDisplay(),this.initGarbageDisplay(),this.initNextPuyos(),this.initChainCounter(),this.initToolDisplay(),this.gameLoaded=!0,this.ticker=new n.ticker.Ticker,this.ticker.addOnce(function(i){t.gameLoop(i)}),this.ticker.start()},initFieldDisplay:function(){this.fieldDisplay.charBG=new d(l["/img/arle_bg.png"].texture),this.fieldDisplay.charBG.x=17,this.fieldDisplay.charBG.y=183,this.stage.addChild(this.fieldDisplay.charBG),this.fieldDisplay.borderTop=new d(this.fieldSprites["field_border_top.png"]),this.fieldDisplay.borderTop.y=132,this.stage.addChild(this.fieldDisplay.borderTop),this.fieldDisplay.borderLeftTop=new d(this.fieldSprites["field_border_left_tophalf.png"]),this.fieldDisplay.borderLeftTop.y=184,this.stage.addChild(this.fieldDisplay.borderLeftTop),this.fieldDisplay.borderLeftBottom=new d(this.fieldSprites["field_border_left_bottomhalf.png"]),this.fieldDisplay.borderLeftBottom.y=536,this.stage.addChild(this.fieldDisplay.borderLeftBottom),this.fieldDisplay.borderRightTop=new d(this.fieldSprites["field_border_right_tophalf.png"]),this.fieldDisplay.borderRightTop.x=417,this.fieldDisplay.borderRightTop.y=184,this.stage.addChild(this.fieldDisplay.borderRightTop),this.fieldDisplay.borderRightBottom=new d(this.fieldSprites["field_border_right_bottomhalf.png"]),this.fieldDisplay.borderRightBottom.x=417,this.fieldDisplay.borderRightBottom.y=536,this.stage.addChild(this.fieldDisplay.borderRightBottom),this.fieldDisplay.borderBottom=new d(this.fieldSprites["field_border_bottom.png"]),this.fieldDisplay.borderBottom.y=902,this.stage.addChild(this.fieldDisplay.borderBottom),this.fieldDisplay.nextWindowBorder=new d(this.fieldSprites["next_border_1p.png"]),this.fieldDisplay.nextWindowBorder.x=456,this.fieldDisplay.nextWindowBorder.y=160,this.stage.addChild(this.fieldDisplay.nextWindowBorder),this.fieldDisplay.nextWindowInner=new d(this.fieldSprites["next_background_1p.png"]),this.fieldDisplay.nextWindowInner.x=456,this.fieldDisplay.nextWindowInner.y=160,this.stage.addChild(this.fieldDisplay.nextWindowInner),this.fieldDisplay.nextWindowMask=new d(l["/img/next_background_1p_mask.png"].texture),this.fieldDisplay.nextWindowMask.position.set(456,160),this.stage.addChild(this.fieldDisplay.nextWindowMask)},initScoreDisplay:function(){var t=150;"full"===this.displayMode?t=150:"simple"===this.displayMode&&(t=32);for(var i=[],e=0;e<8;e++)i[e]=new d(this.fieldSprites["score_0.png"]),i[e].anchor.set(.5),i[e].x=t+.9*i[e].width*e,i[e].y=935,this.stage.addChild(i[e]);this.scoreDisplay=i},initGameOverX:function(){this.fieldDisplay.redX=new d(this.puyoSprites["death_X.png"]),this.fieldDisplay.redX.anchor.set(.5),this.fieldDisplay.redX.x=this.coordArray[1][2].x,this.fieldDisplay.redX.y=this.coordArray[1][2].y,this.stage.addChild(this.fieldDisplay.redX)},initPuyoDisplay:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]=new d(this.puyoSprites["red_urdl.png"]),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y,this.stage.addChild(t[i][e])}this.puyoDisplay=t,this.updatePuyoSprites()},componentToHex:function(t){var i=t.toString(16);return 1===i.length?"0"+i:i},rgbToHex:function(t,i,e){return parseInt(this.componentToHex(parseInt(t,10))+this.componentToHex(parseInt(i,10))+this.componentToHex(parseInt(e,10)),16)},updatePuyoSprites:function(){this.determineConnections(),this.determineColorNames();for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)this.puyoDisplay[t][i].x=this.coordArray[t][i].x,this.puyoDisplay[t][i].y=this.coordArray[t][i].y,"spacer"!==this.colorNameData[t][i]&&!0===this.colorSettings["".concat(this.colorNameData[t][i])].tint&&(this.puyoDisplay[t][i].tint=this.rgbToHex(this.colorSettings["".concat(this.colorNameData[t][i])].r,this.colorSettings["".concat(this.colorNameData[t][i])].g,this.colorSettings["".concat(this.colorNameData[t][i])].b)),this.puyoDisplay[t][i].spritename="".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png"),this.puyoDisplay[t][i].texture=this.puyoSprites["".concat(this.colorNameData[t][i],"_").concat(this.connectionData[t][i],".png")],this.puyoDisplay[t][i].anchor.set(.5,.5),this.puyoDisplay[t][i].scale.set(1,1),this.puyoDisplay[t][i].alpha=1,this.puyoDisplay[t][i].visible=!0;console.log("updated sprites")},updateShadowSprite:function(t,i){var e="";e=this.shadowData[i][t]===f?"red":this.shadowData[i][t]===y?"green":this.shadowData[i][t]===m?"blue":this.shadowData[i][t]===w?"yellow":this.shadowData[i][t]===D?"purple":this.shadowData[i][t]===S?"garbage":"spacer",this.shadowDisplay[i][t].texture=this.puyoSprites["".concat(e,"_n.png")],"spacer"!==e&&!0===this.colorSettings[e].tint&&(this.shadowDisplay[i][t].tint=this.rgbToHex(this.colorSettings[e].r,this.colorSettings[e].g,this.colorSettings[e].b)),console.log("Updated the shadow sprite.")},updateCursorSprite:function(t,i){"1"===this.cursorData[i][t]?this.cursorDisplay[i][t].alpha=1:this.cursorDisplay[i][t].alpha=0},updateArrowSprite:function(t,i){"0"===this.arrowData[i][t]?this.arrowDisplay[i][t].alpha=0:"L"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=1.5*Math.PI):"R"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=.5*Math.PI):"D"===this.arrowData[i][t]?(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=Math.PI):"U"===this.arrowData[i][t]&&(this.arrowDisplay[i][t].alpha=1,this.arrowDisplay[i][t].rotation=0)},updateNextPuyoSprites:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer"),this.nextPuyoPairs[e].children[0].texture=this.puyoSprites["".concat(s,"_n.png")],this.nextPuyoPairs[e].children[1].texture=this.puyoSprites["".concat(o,"_n.png")],"spacer"!==s&&!0===this.colorSettings[s].tint&&(this.nextPuyoPairs[e].children[0].tint=this.rgbToHex(this.colorSettings[s].r,this.colorSettings[s].g,this.colorSettings[s].b)),"spacer"!==o&&!0===this.colorSettings[o].tint&&(this.nextPuyoPairs[e].children[1].tint=this.rgbToHex(this.colorSettings[o].r,this.colorSettings[o].g,this.colorSettings[o].b))}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y)},determineConnections:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)if(i<this.Field.hiddenRows)t[i][e]="n";else if(this.dropDistances[i][e]>0)t[i][e]="n";else if(this.fieldData[i][e]===v||this.fieldData[i][e]===S)t[i][e]="n";else{var s={};s.up=!(i<=this.Field.hiddenRows)&&(this.fieldData[i][e]===this.fieldData[i-1][e]&&0===this.dropDistances[i-1][e]),s.left=0!==e&&(this.fieldData[i][e]===this.fieldData[i][e-1]&&0===this.dropDistances[i][e-1]),s.right=e!==this.Field.columns-1&&(this.fieldData[i][e]===this.fieldData[i][e+1]&&0===this.dropDistances[i][e+1]),s.down=i!==this.Field.totalRows-1&&(this.fieldData[i][e]===this.fieldData[i+1][e]&&0===this.dropDistances[i+1][e]);var o="";!0===s.up&&(o+="u"),!0===s.right&&(o+="r"),!0===s.down&&(o+="d"),!0===s.left&&(o+="l"),""===o&&(o="n"),t[i][e]=o}}return this.connectionData=t,t},determineColorNames:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)this.fieldData[i][e]===f?t[i][e]="red":this.fieldData[i][e]===y?t[i][e]="green":this.fieldData[i][e]===m?t[i][e]="blue":this.fieldData[i][e]===w?t[i][e]="yellow":this.fieldData[i][e]===D?t[i][e]="purple":this.fieldData[i][e]===S?t[i][e]="garbage":t[i][e]="spacer"}return this.colorNameData=t,t},initNextPuyos:function(){for(var t=[],i=this.nextQueuePosition;i<this.nextQueuePosition+6;i++)switch(this.nextPuyoData[i]){case"R":t.push("red");break;case"G":t.push("green");break;case"B":t.push("blue");break;case"Y":t.push("yellow");break;case"P":t.push("purple");break;default:t.push("spacer")}for(var e=0;e<3;e++){var s=t[2*e+0],o=t[2*e+1];void 0===s&&(s="spacer"),void 0===o&&(o="spacer");var a=new d(this.puyoSprites["".concat(s,"_n.png")]),r=new d(this.puyoSprites["".concat(o,"_n.png")]);a.y+=60,"spacer"!==s&&!0===this.colorSettings[s].tint&&(a.tint=this.rgbToHex(this.colorSettings[s].r,this.colorSettings[s].g,this.colorSettings[s].b)),"spacer"!==o&&!0===this.colorSettings[o].tint&&(r.tint=this.rgbToHex(this.colorSettings[o].r,this.colorSettings[o].g,this.colorSettings[o].b)),this.nextPuyoPairs[e]=new n.Container,this.nextPuyoPairs[e].addChild(a),this.nextPuyoPairs[e].addChild(r),this.nextPuyoPairs[e].pivot.set(this.nextPuyoPairs[e].width/2,this.nextPuyoPairs[e].height/2),this.nextPuyoPairs[e].mask=this.fieldDisplay.nextWindowMask}this.nextPuyoPairs[0].scale.set(1,1),this.nextPuyoPairs[0].position.set(this.nextCoord[0].x,this.nextCoord[0].y),this.nextPuyoPairs[1].scale.set(.8,.8),this.nextPuyoPairs[1].position.set(this.nextCoord[1].x,this.nextCoord[1].y),this.nextPuyoPairs[2].scale.set(.8,.8),this.nextPuyoPairs[2].position.set(this.nextCoord[2].x,this.nextCoord[2].y),this.nextPuyoPairs[2].visible=!1,this.stage.addChild(this.nextPuyoPairs[0]),this.stage.addChild(this.nextPuyoPairs[1]),this.stage.addChild(this.nextPuyoPairs[2])},initGarbageDisplay:function(){if("full"===this.displayMode?(this.fieldDisplay.garbageTray=new d(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=456,this.fieldDisplay.garbageTray.y=480,this.stage.addChild(this.fieldDisplay.garbageTray)):"simple"===this.displayMode&&(this.fieldDisplay.garbageTray=new d(this.fieldSprites["garbage_tray.png"]),this.fieldDisplay.garbageTray.x=316,this.fieldDisplay.garbageTray.y=915,this.fieldDisplay.garbageTray.scale.set(.7,.7),this.fieldDisplay.garbageTray.visible=!0,this.stage.addChild(this.fieldDisplay.garbageTray)),"full"===this.displayMode){for(var t=[],i=0;i<this.Field.columns;i++)t[i]=new d(this.puyoSprites["spacer_n.png"]),t[i].x=468+t[i].width*i,t[i].origX=468+t[i].width*i,t[i].y=470,this.stage.addChild(t[i]);this.garbageDisplay=t}else if("simple"===this.displayMode){for(var e=[],s=0;s<this.Field.columns;s++)e[s]=new d(this.puyoSprites["spacer_n.png"]),e[s].scale.set(.7,.7),e[s].x=324+e[s].width*s,e[s].origX=324+e[s].width*s,e[s].y=910,e[s].visible=!0,this.stage.addChild(e[s]);this.garbageDisplay=e}},initFieldControls:function(){var t,i=this,e=0;this.fieldControls.reset=new d(this.fieldSprites["btn_reset.png"]),this.fieldControls.reset.x=452,this.fieldControls.reset.y=480,this.fieldControls.reset.interactive=!0,this.fieldControls.reset.buttonMode=!0,this.stage.addChild(this.fieldControls.reset),t=this.fieldControls.reset.height,this.fieldControls.pause=new d(this.fieldSprites["btn_pause.png"]),this.fieldControls.pause.x=528,this.fieldControls.pause.y=480+t*e,this.fieldControls.pause.interactive=!0,this.fieldControls.pause.buttonMode=!0,this.stage.addChild(this.fieldControls.pause),e+=1,this.fieldControls.play=new d(this.fieldSprites["btn_play.png"]),this.fieldControls.play.x=452,this.fieldControls.play.y=480+t*e,this.fieldControls.play.interactive=!0,this.fieldControls.play.buttonMode=!0,this.stage.addChild(this.fieldControls.play),this.fieldControls.auto=new d(this.fieldSprites["btn_auto.png"]),this.fieldControls.auto.x=528,this.fieldControls.auto.y=480+t*e,this.fieldControls.auto.interactive=!0,this.fieldControls.auto.buttonMode=!0,this.stage.addChild(this.fieldControls.auto),e+=1,this.fieldDisplay.disableTouchBehind=new d(l["/img/touch_disabler.png"].texture),this.fieldDisplay.disableTouchBehind.x=0,this.fieldDisplay.disableTouchBehind.y=0,this.fieldDisplay.disableTouchBehind.width=this.modeSettings.simple.width,this.fieldDisplay.disableTouchBehind.height=this.modeSettings.simple.height,this.stage.addChild(this.fieldDisplay.disableTouchBehind),this.fieldDisplay.disableTouchBehind.interactive=!1,this.fieldDisplay.disableTouchBehind.on("pointerdown",function(){i.controlField("edit")}),this.fieldControls.edit=new d(this.fieldSprites["btn_edit.png"]),this.fieldControls.edit.x=490,this.fieldControls.edit.y=480+e*this.fieldControls.edit.height,this.fieldControls.edit.interactive=!0,this.fieldControls.edit.buttonMode=!0,this.stage.addChild(this.fieldControls.edit)},initChainCounter:function(){this.chainCounterDisplay.firstDigit=new d(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.firstDigit.x=412,this.chainCounterDisplay.firstDigit.y=732,this.chainCounterDisplay.firstDigit.scale.set(.85,.85),this.chainCounterDisplay.firstDigit.origY=this.chainCounterDisplay.firstDigit.y,this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit=new d(this.chainCountSprites["spacer.png"]),this.chainCounterDisplay.secondDigit.x=452,this.chainCounterDisplay.secondDigit.y=732,this.chainCounterDisplay.secondDigit.scale.set(.85,.85),this.chainCounterDisplay.secondDigit.origY=this.chainCounterDisplay.secondDigit.y,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText=new d(this.chainCountSprites["chain_text.png"]),this.chainCounterDisplay.chainText.x=496,this.chainCounterDisplay.chainText.y=742,this.chainCounterDisplay.chainText.origY=this.chainCounterDisplay.chainText.y,this.chainCounterDisplay.chainText.scale.set(.85,.85),this.chainCounterDisplay.chainText.alpha=0,this.stage.addChild(this.chainCounterDisplay.firstDigit),this.stage.addChild(this.chainCounterDisplay.secondDigit),this.stage.addChild(this.chainCounterDisplay.chainText)},initShadowDisplay:function(){for(var t=[],i="",e=0;e<this.fieldData.length;e++){t[e]=[];for(var s=0;s<this.fieldData[0].length;s++)i=this.shadowData[e][s]===f?"red":this.shadowData[e][s]===y?"green":this.shadowData[e][s]===m?"blue":this.shadowData[e][s]===w?"yellow":this.shadowData[e][s]===D?"purple":this.shadowData[e][s]===S?"garbage":"spacer",t[e][s]=new d(this.puyoSprites["".concat(i,"_n.png")]),t[e][s].anchor.set(.5),t[e][s].alpha=.4,t[e][s].x=this.coordArray[e][s].x,t[e][s].y=this.coordArray[e][s].y,"spacer"!==i&&!0===this.colorSettings[i].tint&&(t[e][s].tint=this.rgbToHex(this.colorSettings[i].r,this.colorSettings[i].g,this.colorSettings[i].b)),this.stage.addChild(t[e][s])}this.shadowDisplay=t;for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.updateShadowSprite(a,o)},initControlledPuyos:function(){for(var t=[],i=[],e=0;e<this.controlPuyoData.length;e++){i[e]=[];for(var s=0;s<this.controlPuyoData[0].length;s++)switch(this.controlPuyoData[e][s]){case"R":i[e][s]="red";break;case"G":i[e][s]="green";break;case"B":i[e][s]="blue";break;case"Y":i[e][s]="yellow";break;case"P":i[e][s]="purple";break;default:i[e][s]="spacer"}}for(var o=0;o<this.controlPuyoData.length;o++){t[o]=[];for(var a=0;a<this.controlPuyoData[0].length;a++)t[o][a]=new d(this.puyoSprites["".concat(i[o][a],"_n.png")]),t[o][a].anchor.set(.5),t[o][a].x=this.coordArray[o][a].x,t[o][a].y=this.coordArray[o][a].y-5*t[o][a].height,t[o][a].visible=!1,this.stage.addChild(t[o][a])}this.controlPuyoSprites=t},initActivePair:function(){for(var t=this,i=[],e=0;e<2;e++)switch(this.activePair.data[e]){case"R":i.push("red");break;case"G":i.push("green");break;case"B":i.push("blue");break;case"Y":i.push("yellow");break;case"P":i.push("purple");break;default:i.push("spacer")}void 0===i[0]&&(i[0]="spacer"),void 0===i[1]&&(i[0]="spacer");var s=new d(this.puyoSprites["".concat(i[0],"_n.png")]),o=new d(this.puyoSprites["".concat(i[1],"_n.png")]);s.anchor.set(.5,.5),o.anchor.set(.5,.5),s.y+=s.height,this.activePair.sprites=new n.Container,this.activePair.sprites.addChild(s),this.activePair.sprites.addChild(o),this.activePair.sprites.pivot.set(0,60),this.activePair.sprites.position.set(this.coordArray[0][2].x,this.coordArray[0][2].y-60),this.stage.addChild(this.activePair.sprites),this.activePair.sprites.visible=!1,this.ticker.add(function(){t.activePair.sprites.rotation+=2*Math.PI/180,t.activePair.sprites.children[0].rotation-=2*Math.PI/180,t.activePair.sprites.children[1].rotation-=2*Math.PI/180})},initCursorDisplay:function(){for(var t=[],i=0;i<this.fieldData.length;i++){t[i]=[];for(var e=0;e<this.fieldData[0].length;e++)t[i][e]=new d(l["/img/cursor.png"].texture),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y,this.stage.addChild(t[i][e])}this.cursorDisplay=t;for(var s=0;s<this.fieldData.length;s++)for(var o=0;o<this.fieldData[0].length;o++)this.updateCursorSprite(o,s)},initArrowDisplay:function(){for(var t=[],i=0;i<this.fieldData.length;i++){t[i]=[];for(var e=0;e<this.fieldData[0].length;e++)t[i][e]=new d(l["/img/arrow.png"].texture),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y,this.stage.addChild(t[i][e])}this.arrowDisplay=t;for(var s=0;s<this.fieldData.length;s++)for(var o=0;o<this.fieldData[0].length;o++)this.updateArrowSprite(o,s)},initDumpDisplay:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]=new d(this.puyoSprites["spacer_n.png"]),t[i][e].anchor.set(.5),t[i][e].x=this.coordArray[i][e].x,t[i][e].y=this.coordArray[i][e].y-780,this.stage.addChild(t[i][e])}this.dumpDisplay=t;for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!1},updateDumpDisplay:function(){for(var t="",i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++){switch(this.chainDiff[i][e]){case"R":t="red";break;case"G":t="green";break;case"B":t="blue";break;case"Y":t="yellow";break;case"P":t="purple";break;case"J":t="garbage";break;default:t="spacer"}console.log(t),this.dumpDisplay[i][e].texture=this.puyoSprites["".concat(t,"_n.png")],this.dumpDisplay[i][e].anchor.set(.5),this.dumpDisplay[i][e].x=this.coordArray[i][e].x,this.dumpDisplay[i][e].y=this.coordArray[i][e].y-780}for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dumpDisplay[s][o].visible=!0},initToolDisplay:function(){var t=this;this.fieldDisplay.editBubble=new d(l["/img/edit_bubble.png"].texture),this.fieldDisplay.editBubble.x=520,this.fieldDisplay.editBubble.y=704,this.fieldDisplay.editBubble.anchor.set(.87,0),this.fieldDisplay.editBubble.scale.set(0,0),this.fieldDisplay.editBubble.interactive=!0,this.fieldDisplay.editBubble.visible=!1,this.stage.addChild(this.fieldDisplay.editBubble),this.toolCursor=new d(l["/img/current_tool.png"].texture),this.toolCursor.anchor.set(.5,.5),this.toolCursor.visible=!1,this.stage.addChild(this.toolCursor),this.editorTools[0]=new n.Container,this.editorTools[1]=new n.Container;for(var i=[[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],l["/img/editor_x.png"].texture],[this.puyoSprites["red_n.png"],this.puyoSprites["green_n.png"],this.puyoSprites["blue_n.png"],this.puyoSprites["yellow_n.png"],this.puyoSprites["purple_n.png"],this.puyoSprites["garbage_n.png"],l["/img/editor_x.png"].texture]],e=[],s=["R","G","B","Y","P","J","0","R","G","B","Y","P","J","0"],o=0;o<i.length;o++){e[o]=[];for(var a=0;a<i[o].length;a++){var r=0,h=0;a>0&&(r=8),o>0&&(h=8),e[o][a]=new d(i[o][a]),e[o][a].interactive=!0,e[o][a].buttonMode=!0,e[o][a].puyoIndex=7*o+a,e[o][a].puyoColor=s[7*o+a],e[o][a].targetLayer=7*o+a<7?"main":"shadow",e[o][a].anchor.set(.5,.5),e[o][a].on("pointerdown",function(){t.editorCurrentTool.page=0,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),e[o][a].x=88+(e[o][a].width+r)*a,e[o][a].y=820+(e[o][a].height+h)*o,this.editorTools[0].addChild(e[o][a])}}for(var p=[[l["/img/arrow.png"].texture,l["/img/arrow.png"].texture,l["/img/arrow.png"].texture,l["/img/arrow.png"].texture,l["/img/arrow_x.png"].texture,l["/img/cursor.png"].texture,l["/img/cursor_x.png"].texture]],c=[],u=["L","U","R","D","0","1","0"],g=0;g<p.length;g++){c[g]=[];for(var f=0;f<p[g].length;f++){var y=0,m=0;f>0&&(y=8),g>0&&(m=8),c[g][f]=new d(p[g][f]),c[g][f].interactive=!0,c[g][f].buttonMode=!0,c[g][f].puyoIndex=7*g+f,c[g][f].puyoColor=u[7*g+f],"L"===u[7*g+f]?c[g][f].rotation=1.5*Math.PI:"R"===u[7*g+f]?c[g][f].rotation=.5*Math.PI:"D"===u[7*g+f]&&(c[g][f].rotation=Math.PI),c[g][f].targetLayer=7*g+f<5?"arrow":"cursor",c[g][f].anchor.set(.5,.5),c[g][f].on("pointerdown",function(){t.editorCurrentTool.page=1,t.editorCurrentTool.item=this.puyoIndex,t.editorCurrentTool.puyo=this.puyoColor,t.editorCurrentTool.layer=this.targetLayer,t.targetLayer(this.targetLayer),t.editorCurrentTool.x=this.x,t.editorCurrentTool.y=this.y,t.updateToolboxSelection(),console.log(t.editorCurrentTool)}),c[g][f].x=88+(64+y)*f,c[g][f].y=820+(60+m)*g,this.editorTools[1].addChild(c[g][f])}}this.editorWindow.left=new d(l["/img/picker_arrow_left.png"].texture),this.editorWindow.left.x=0,this.editorWindow.left.y=720,this.editorWindow.left.interactive=!0,this.editorWindow.left.buttonMode=!0,this.editorWindow.left.visible=!1,this.editorWindow.left.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.left),this.editorWindow.right=new d(l["/img/picker_arrow_right.png"].texture),this.editorWindow.right.x=552,this.editorWindow.right.y=720,this.editorWindow.right.interactive=!0,this.editorWindow.right.buttonMode=!0,this.editorWindow.right.visible=!1,this.editorWindow.right.on("pointerdown",function(){0===t.toolPage?(t.toolPage=1,t.editorTools[0].visible=!1,t.editorTools[1].visible=!0,t.updateToolboxSelection()):1===t.toolPage&&(t.toolPage=0,t.editorTools[0].visible=!0,t.editorTools[1].visible=!1,t.updateToolboxSelection())}),this.stage.addChild(this.editorWindow.right),this.editorTools[0].visible=!1,this.stage.addChild(this.editorTools[0]),this.editorTools[1].visible=!1,this.stage.addChild(this.editorTools[1])},openToolbox:function(t){this.timers.editBubble+=t;var i=this.timers.editBubble;this.fieldDisplay.disableTouchBehind.interactive=!0,this.timers.editBubble<=15?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.openToolbox),this.ticker.add(this.displayTools),this.editorWindow.left.visible=!0,this.editorWindow.right.visible=!0,this.timers.toolIntroFade=0)},displayTools:function(t){this.timers.toolIntroFade+=t;var i=this.timers.toolIntroFade,e=[],s=[];if(this.editorTools[this.toolPage].visible=!0,this.updateToolboxSelection(),i<=2*this.editorTools[this.toolPage].children.length+12){for(var o=0;o<this.editorTools[this.toolPage].children.length;o++)e.push(0-2*o);for(var a=0;a<this.editorTools[this.toolPage].children.length;a++)s.push((e[a]+i)/12),this.editorTools[this.toolPage].children[a].alpha=a<7?s[a]:.17*s[a],a===this.editorCurrentTool.item&&(this.toolCursor.alpha=s[a])}else this.ticker.remove(this.displayTools),this.updateToolboxSelection(),console.log("removed tool ticker")},updateToolboxSelection:function(){this.editorCurrentTool.page===this.toolPage?(this.toolCursor.visible=!0,this.toolCursor.position.set(this.editorCurrentTool.x,this.editorCurrentTool.y)):this.toolCursor.visible=!1},targetLayer:function(t){if("main"===t)for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)this.puyoDisplay[i][e].interactive=!0,this.shadowDisplay[i][e].interactive=!1,this.cursorDisplay[i][e].interactive=!1,this.arrowDisplay[i][e].interactive=!1;else if("shadow"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.puyoDisplay[s][o].interactive=!1,this.shadowDisplay[s][o].interactive=!0,this.cursorDisplay[s][o].interactive=!1,this.arrowDisplay[s][o].interactive=!1;else if("cursor"===t)for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.puyoDisplay[a][r].interactive=!1,this.shadowDisplay[a][r].interactive=!1,this.cursorDisplay[a][r].interactive=!0,this.arrowDisplay[a][r].interactive=!1;else if("arrow"===t)for(var n=0;n<this.Field.totalRows;n++)for(var h=0;h<this.Field.columns;h++)this.puyoDisplay[n][h].interactive=!1,this.shadowDisplay[n][h].interactive=!1,this.cursorDisplay[n][h].interactive=!1,this.arrowDisplay[n][h].interactive=!0},closeToolbox:function(t){this.timers.editBubble-=t;var i=this.timers.editBubble;this.editorTools[this.toolPage].visible=!1,this.editorWindow.left.visible=!1,this.editorWindow.right.visible=!1,this.toolCursor.visible=!1,this.ticker.remove(this.displayTools),this.timers.editBubble>=0?this.fieldDisplay.editBubble.scale.set(this.Easers.editBubble(i/15),this.Easers.editBubble(i/15)):(this.ticker.remove(this.closeToolbox),this.gameState="idle",this.timers.editBubble=0,this.fieldDisplay.editBubble.visible=!1,this.fieldDisplay.disableTouchBehind.interactive=!1)},gameLoop:function(t){this.renderer.render(this.stage),console.log("ticking")},hoverLoop:function(t){"idle"===this.gameState?this.stateEditField(t):"dropping"===this.gameState&&!1===this.needToReset?(this.animateDropPuyos(t),!0===this.needToChangeSlides&&this.animateDropDumpPuyos(t)):"popping"===this.gameState&&!1===this.needToReset&&this.animatePopPuyos(t),this.animateCursors(t),this.animateArrows(t),this.renderer.render(this.stage)},stateEditField:function(t){},animateDropPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)this.dropDistances[o][a]>0&&("idle"===this.puyoStates[o][a]||"checkDrops"===this.puyoStates[o][a]?this.puyoStates[o].splice(a,1,"dropping"):"dropping"===this.puyoStates[o][a]?this.puyoDisplay[o][a].y+this.Field.map[o][a].vy<this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight?(this.puyoDisplay[o][a].y+=this.Field.map[o][a].vy,this.Field.map[o][a].vy+=.703125*i):(this.puyoStates[o].splice(a,1,"bouncing"),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight+this.Field.cellHeight/2,this.puyoDisplay[o][a].anchor.set(.5,1)):"bouncing"===this.puyoStates[o][a]&&(this.cellTimer[o][a]+=1,this.cellTimer[o][a]<=8?(this.puyoDisplay[o][a].scale.y-=.025,this.puyoDisplay[o][a].scale.x+=.025):this.cellTimer[o][a]<=16?(this.puyoDisplay[o][a].scale.y+=.025,this.puyoDisplay[o][a].scale.x-=.025):(this.puyoDisplay[o][a].anchor.set(.5,.5),this.puyoDisplay[o][a].y=this.coordArray[o][a].y+this.dropDistances[o][a]*this.Field.cellHeight,this.puyoStates[o].splice(a,1,"checkPops"),this.droppingCells[o].splice(a,1,!1),this.dropDistances[o].splice(a,1,0),this.cellTimer[o].splice(a,1,0))));!1===this.stopGame&&(this.frame+=1)},animateDropDumpPuyos:function(t){!0===this.stopGame&&(t=0);var i=t*this.simulationSpeed;console.log(i);for(var e=0;e<Math.round(i);e++)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.dropDumpDistances[s][o]>0&&(console.log("Detected cells with distance needed greater than 0"),"idle"===this.dumpPuyoStates[s][o]||"checkDrops"===this.dumpPuyoStates[s][o]?this.dumpPuyoStates[s].splice(o,1,"dropping"):"dropping"===this.dumpPuyoStates[s][o]?this.dumpDisplay[s][o].y+this.dumpVelocity[s][o]<this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight?(console.log("dropping dumps"),this.dumpDisplay[s][o].y+=this.dumpVelocity[s][o],this.dumpVelocity[s][o]+=.703125):(console.log("dump bounce state"),this.dumpPuyoStates[s].splice(o,1,"bouncing"),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight+this.Field.cellHeight/2,this.dumpDisplay[s][o].anchor.set(.5,1)):"bouncing"===this.dumpPuyoStates[s][o]&&(this.dumpCellTimer[s][o]+=1,this.dumpCellTimer[s][o]<=8?(this.dumpDisplay[s][o].scale.y-=.025,this.dumpDisplay[s][o].scale.x+=.025):this.dumpCellTimer[s][o]<=16?(this.dumpDisplay[s][o].scale.y+=.025,this.dumpDisplay[s][o].scale.x-=.025):(console.log("it is no more."),this.dumpDisplay[s][o].anchor.set(.5,.5),this.dumpDisplay[s][o].y=this.dumpCoordArray[s][o].y+this.dropDumpDistances[s][o]*this.Field.cellHeight,this.dumpPuyoStates[s].splice(o,1,"checkPops"),this.droppingDumpCells[s].splice(o,1,!1),this.dropDumpDistances[s].splice(o,1,0),this.dumpCellTimer[s].splice(o,1,0),this.dumpVelocity[s].splice(o,1,3.75))));!1===this.stopGame&&(this.frame+=1)},animatePopPuyos:function(t){var i=this.frame;!0===this.stopGame&&(t=0);for(var e=t*this.simulationSpeed,s=0;s<Math.round(e);s++)for(var o=0;o<this.Field.totalRows;o++)for(var a=0;a<this.Field.columns;a++)!0===this.poppingCells[o][a]?(this.puyoStates[o].splice(a,1,"popping"),Math.cos(i/3*Math.PI)>=0?this.puyoDisplay[o][a].alpha=1:this.puyoDisplay[o][a].alpha=0,this.cellTimer[o][a]+=1,this.cellTimer[o][a]>=24&&(console.log("need to finish popping"),this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0))):(this.puyoStates[o].splice(a,1,"checkDrops"),this.poppingCells[o].splice(a,1,!1),this.puyoDisplay[o][a].alpha=1,this.cellTimer[o].splice(a,1,0));!1===this.stopGame&&(this.frame+=1)},animateCursors:function(t){for(var i=this.timers.cursor,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)Math.cos(i/30*Math.PI)>=0?this.cursorDisplay[e][s].scale.set(.9,.9):this.cursorDisplay[e][s].scale.set(1,1);this.timers.cursor+=t},setDropData:function(){for(var t=o.a.Simulate.dropPuyos(this.Field),i=[],e=0;e<this.Field.totalRows;e++){i[e]=[];for(var s=0;s<this.Field.columns;s++)t.dropDistances[e][s]>0?i[e][s]=!0:i[e][s]=!1}this.droppingCells=i,this.dropDistances=t.dropDistances,this.dropPuyosResult=o.a.mapToStringArray(t.dropResult)},setPopData:function(){var t=o.a.Simulate.clearPuyos(this.Field);this.poppingCells=t.animationMatrix,this.clearPuyosResult=o.a.mapToStringArray(t.newField.map),0!==t.popData.poppingGroups.length?this.calculateScore(t.popData):this.gameState="chainStopped"},mergeInShadowLayer:function(t){for(var i=0;i<this.Field.totalRows;i++)for(var e=0;e<this.Field.columns;e++)"0"!==this.shadowData[i][e]&&this.shadowData[i][e]!==this.fieldData[i][e]&&(this.fieldData[i].splice(e,1,this.shadowData[i][e]),!0===t&&(console.log("Replacing old shadow puyo forever..."),this.shadowData[i].splice(e,1,"0"),this.updateShadowSprite(e,i)));this.updatePuyoSprites(),console.log("merged shadow layer")},controlField:function(t){if("reset"===t){for(var i in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[i]=0;this.resetField()}else if("back"===t)console.log("I didn't make a function for back yet.");else if("pause"===t)this.chainAutoPlay=!1;else if("play"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!0),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||(this.simulationSpeed=24),this.playStep();else if("auto"===t)"idle"===this.gameState?(this.fieldOriginal=JSON.parse(JSON.stringify(this.fieldData)),this.mergeInShadowLayer(!0),this.simulationSpeed=1):"popping"!==this.gameState&&"dropping"!==this.gameState||8!==this.simulationSpeed?"popping"===this.gameState||"dropping"===this.gameState?this.simulationSpeed=8:"chainStopped"===this.gameState&&(this.simulationSpeed=1):this.simulationSpeed=24,this.playChain();else if("edit"===t)"editor"!==this.gameState?(this.ticker.add(this.openToolbox),this.ticker.remove(this.closeToolbox),this.gameState="editor",this.fieldDisplay.editBubble.visible=!0):"editor"===this.gameState&&(this.gameState="idle",this.ticker.remove(this.openToolbox),this.ticker.add(this.closeToolbox));else if("empty"===t){for(var e in this.needToReset=!0,this.ticker.remove(this.animateChainCounter),this.ticker.remove(this.animateDropPuyos),this.ticker.remove(this.animatePopPuyos),this.ticker.remove(this.animateGarbageTray),this.cellTimer=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.timers)this.timers[e]=0;this.emptyField()}},resetField:function(){var t=this;this.poppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=t.fieldOriginal,t.needToReset=!1})},reloadSlide:function(){var t=this;this.ticker.addOnce(function(){t.fieldData=u(t.importedData[t.currentSlide].fieldData,t.fieldSettings.totalRows,t.fieldSettings.columns),t.shadowData=u(t.importedData[t.currentSlide].shadowData,t.fieldSettings.totalRows,t.fieldSettings.columns),t.cursorData=u(t.importedData[t.currentSlide].cursorData,t.fieldSettings.totalRows,t.fieldSettings.columns),t.arrowData=u(t.importedData[t.currentSlide].arrowData,t.fieldSettings.totalRows,t.fieldSettings.columns);for(var i=u(t.importedData[t.currentSlide].fieldData,t.fieldSettings.totalRows,t.fieldSettings.columns),e=0;e<t.Field.totalRows;e++)for(var s=0;s<t.Field.columns;s++)"0"!==t.shadowData[e][s]&&t.shadowData[e][s]!==t.fieldData[e][s]&&i[e].splice(s,1,t.shadowData[e][s]);t.poppingCells=c(!1,t.fieldSettings.totalRows,t.fieldSettings.columns),t.droppingCells=c(!1,t.fieldSettings.totalRows,t.fieldSettings.columns),t.dropDistances=c(0,t.fieldSettings.totalRows,t.fieldSettings.columns),t.clearPuyosResult=i,t.dropPuyosResult=i,t.cellTimer=c(0,t.fieldSettings.totalRows,t.fieldSettings.columns),t.puyoStates=c("idle",t.fieldSettings.totalRows,t.fieldSettings.columns);for(var o=0;o<t.Field.totalRows;o++)for(var a=0;a<t.Field.columns;a++)t.shadowDisplay[o][a].visible=!0,t.cursorDisplay[o][a].visible=!0,t.arrowDisplay[o][a].visible=!0;t.score=0,t.stepScore=0,t.garbage=0,t.stepGarbage=0,t.garbagePoints=0,t.leftoverGarbagePoints=0,t.chainLength=0,t.needToReset=!1,t.needToChangeSlides=!1,t.gameState="idle",t.updatePuyoSprites(),t.updateNextPuyoSprites(),t.updateChain;for(var r=0;r<t.Field.totalRows;r++)for(var n=0;n<t.Field.columns;n++)t.updateShadowSprite(n,r),t.updateCursorSprite(n,r),t.updateArrowSprite(n,r);t.chainCounterDisplay.firstDigit.alpha=0,t.chainCounterDisplay.secondDigit.alpha=0,t.chainCounterDisplay.chainText.alpha=0,"0"!==t.chainLengthString[0]?(t.chainCounterDisplay.firstDigit.alpha=1,t.chainCounterDisplay.firstDigit.texture=t.chainCountSprites["chain_".concat(t.chainLengthString[0],".png")]):t.chainCounterDisplay.firstDigit.texture=t.chainCountSprites["spacer.png"],t.chainLength>0?(t.chainCounterDisplay.secondDigit.alpha=1,t.chainCounterDisplay.secondDigit.texture=t.chainCountSprites["chain_".concat(t.chainLengthString[1],".png")],t.chainCounterDisplay.chainText.alpha=1):t.chainCounterDisplay.secondDigit.texture=t.chainCountSprites["spacer.png"],t.ticker.remove(t.animateGarbageTray),t.timers.garbageTray=0;for(var h=0;h<6;h++)t.garbageDisplay[h].x=(t.garbageDisplay[2].origX+t.garbageDisplay[3].origX)/2;t.garbageIcons=["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],t.countGarbage(t.garbage,0),console.log(t.garbageDisplay);for(var l=0;l<6;l++)t.garbageDisplay[l].texture=t.puyoSprites["".concat(t.garbageIcons[l],".png")];t.ticker.addOnce(t.animateGarbageTray),t.ticker.remove(t.hoverLoop),t.ticker.remove(t.hoverLoop),t.renderer.render(t.stage)})},emptyField:function(){var t=this;this.poppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.$nextTick(function(){t.fieldData=c("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.updatePuyoSprites(),t.shadowData=c("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.cursorData=c("0",t.fieldSettings.totalRows,t.fieldSettings.columns),t.arrowData=c("0",t.fieldSettings.totalRows,t.fieldSettings.columns);for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);t.needToReset=!1})},calculateScore:function(t){this.chainLength+=1;var i=Object(s.a)(new Set(t.poppingColors));console.log(i);for(var e=this.fieldSettings.colorBonus[i.length-1],o=this.fieldSettings.chainPower[this.chainLength-1],a=0,r=0,n=0;n<t.poppingGroups.length;n++){var h=t.poppingGroups[n].length;r+=h,a+=h>=11?this.fieldSettings.groupBonus[this.fieldSettings.groupBonus.length-1]:this.fieldSettings.groupBonus[h-4]}var l=o+e+a;l<1?l=1:l>999&&(l=999),this.stepScore=10*r*l,this.score+=this.stepScore,this.calculateGarbage()},calculateGarbage:function(){this.garbagePoints=this.stepScore/this.fieldSettings.targetPoint+this.leftoverGarbagePoints,this.stepGarbage=Math.floor(this.garbagePoints),this.leftoverGarbagePoints=this.garbagePoints-this.stepGarbage,this.garbage+=this.stepGarbage},animateChainCounter:function(t){var i=this.timers.chainLength;this.timers.chainLength+=t,this.timers.chainLength<=30?(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY-16*(-1/225*Math.pow(i-15,2)+1),this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY-16*(-1/225*Math.pow(i-15,2)+1)):(this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.remove(this.animateChainCounter),console.log("counter bounce over"))},animateGarbageTray:function(t){var i=this.timers.garbageTray,e=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;if(i<8){for(var s=0;s<6;s++)this.garbageDisplay[s].x=this.garbageDisplay[s].x+(this.garbageDisplay[s].origX-e)/8;for(var o=0;o<3;o++)this.garbageDisplay[o].x<this.garbageDisplay.origX&&(this.garbageDisplay[o].x=this.garbageDisplay.origX);for(var a=3;a<6;a++)this.garbageDisplay[a].x>this.garbageDisplay.origX&&(this.garbageDisplay[a].x=this.garbageDisplay.origX);this.timers.garbageTray+=1}else this.ticker.remove(this.animateGarbageTray),console.log("removed garbage tray animation")},animateArrows:function(t){for(var i=this.timers.arrow,e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)"R"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x+8*Math.cos(i/30*Math.PI)),"L"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].x=this.coordArray[e][s].x-8*Math.cos(i/30*Math.PI)),"U"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y-8*Math.cos(i/30*Math.PI)),"D"===this.arrowData[e][s]&&(this.arrowDisplay[e][s].y=this.coordArray[e][s].y+8*Math.cos(i/30*Math.PI));this.timers.arrow+=t},animateNextPuyos:function(t){var i=this.timers.next;if(this.nextPuyoPairs[0].y=this.nextCoord[0].y-(this.nextCoord[0].y-106)/8*i,this.nextPuyoPairs[1].x=this.nextCoord[1].x-(this.nextCoord[1].x-this.nextCoord[0].x)/8*i,this.nextPuyoPairs[1].y=this.nextCoord[1].y-(this.nextCoord[1].y-this.nextCoord[0].y)/8*i,this.nextPuyoPairs[1].scale.set(.8+.025*i,.8+.025*i),this.nextPuyoPairs[2].y=this.nextCoord[2].y-(this.nextCoord[2].y-this.nextCoord[1].y)/8*i,i>=8)return this.ticker.remove(this.animateNextPuyos),this.nextQueuePosition+=2,this.timers.next=0,this.updateNextPuyoSprites(),this.updateDumpDisplay(),this.setDumpMatrixDropData(),this.needToChangeSlides=!0,void this.controlField("play");this.timers.next+=1},playStep:function(){"idle"===this.gameState?(this.chainAutoPlay=!1,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!1,this.gameState="dropping")},playChain:function(){"idle"===this.gameState?(this.chainAutoPlay=!0,this.gameState="dropping"):"chainStopped"===this.gameState&&(this.chainAutoPlay=!0,this.gameState="dropping")},playChainHover:function(){this.mergeInShadowLayer(!0),this.chainAutoPlay=!0,this.gameState="dropping",this.ticker.add(this.hoverLoop)},setDumpMatrixDropData:function(){for(var t=new o.a.Field({columns:6,visibleRows:12,hiddenRows:14,totalRows:26,puyoToClear:4},this.combinedMatrix),i=o.a.Simulate.dropPuyos(t),e=[],s=0;s<this.Field.totalRows;s++){e[s]=[];for(var a=0;a<this.Field.columns;a++)i.dropDistances[s][a]>0?e[s][a]=!0:e[s][a]=!1}for(var r=[],n=0;n<this.Field.totalRows;n++){r[n]=[];for(var h=0;h<this.Field.columns;h++)r[n][h]=i.dropDistances[n][h]}this.droppingDumpCells=e,this.dropDumpDistances=r},updateWithNextSlide:function(){var t=this;console.log("Updating with next slide"),this.fieldData=u(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.gameState="idle",this.shadowData=u(this.importedData[this.currentSlide+1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=u(this.importedData[this.currentSlide+1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=u(this.importedData[this.currentSlide+1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),!0===this.importedData[this.currentSlide].advanceNext?this.nextQueuePosition+=2:this.nextQueuePosition+=0,this.currentSlide+=1,this.ticker.addOnce(function(){t.updatePuyoSprites(),t.updateNextPuyoSprites();for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);t.renderer.render(t.stage)})},prevSlide:function(){var t=this;this.currentSlide>0&&"idle"===this.gameState&&(this.poppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.droppingCells=c(!1,this.fieldSettings.totalRows,this.fieldSettings.columns),this.dropDistances=c(0,this.fieldSettings.totalRows,this.fieldSettings.columns),this.score=0,this.stepScore=0,this.garbage=0,this.stepGarbage=0,this.garbagePoints=0,this.leftoverGarbagePoints=0,this.chainLength=0,this.fieldData=u(this.importedData[this.currentSlide-1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.needToReset=!1,this.needToChangeSlides=!1,!0===this.importedData[this.currentSlide-1].advanceNext?this.nextQueuePosition-=2:this.nextQueuePosition-=0,this.shadowData=u(this.importedData[this.currentSlide-1].shadowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.cursorData=u(this.importedData[this.currentSlide-1].cursorData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.arrowData=u(this.importedData[this.currentSlide-1].arrowData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.currentSlide-=1,this.ticker.addOnce(function(){t.updatePuyoSprites(),t.updateNextPuyoSprites();for(var i=0;i<t.Field.totalRows;i++)for(var e=0;e<t.Field.columns;e++)t.updateShadowSprite(e,i),t.updateCursorSprite(e,i),t.updateArrowSprite(e,i);t.renderer.render(t.stage)}))},nextSlide:function(){this.currentSlide<this.importedData.length-1&&"idle"===this.gameState?(this.fieldData=u(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),this.ticker.add(this.animateNextPuyos)):console.log("No more slides")},countGarbage:function(t,i){this.checkCrown(t,i)},checkCrown:function(t,i){i<6&&(t-720>=0?(this.garbageIcons.splice(i,1,"crown"),this.checkCrown(t-720,i+1)):this.checkMoon(t,i))},checkMoon:function(t,i){i<6&&(t-360>=0?(this.garbageIcons.splice(i,1,"moon"),this.checkStar(t-360,i+1)):this.checkStar(t,i))},checkStar:function(t,i){i<6&&(t-180>=0?(this.garbageIcons.splice(i,1,"star"),this.checkRock(t-180,i+1)):this.checkRock(t,i))},checkRock:function(t,i){i<6&&(t-30>=0?(this.garbageIcons.splice(i,1,"rock"),this.checkRock(t-30,i+1)):this.checkLine(t,i))},checkLine:function(t,i){i<6&&(t-6>=0?(this.garbageIcons.splice(i,1,"line"),this.checkLine(t-6,i+1)):this.checkUnit(t,i))},checkUnit:function(t,i){i<6&&t-1>=0&&(this.garbageIcons.splice(i,1,"unit"),this.checkUnit(t-1,i+1))}},computed:{chainDiff:function(){for(var t=u(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),i=u(this.importedData[this.currentSlide+1].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),e=[],s=0;s<this.fieldSettings.totalRows;s++){e[s]=[];for(var a=0;a<this.fieldSettings.columns;a++)"0"===t[s][a]&&"0"!==i[s][a]?e[s][a]=i[s][a]:e[s][a]="0"}var r=new o.a.Field(this.fieldSettings,e);return o.a.mapToStringArray(o.a.Simulate.dropPuyos(r).dropResult)},combinedMatrix:function(){for(var t=JSON.parse(JSON.stringify(this.chainDiff)),i=u(this.importedData[this.currentSlide].fieldData,this.fieldSettings.totalRows,this.fieldSettings.columns),e=0;e<this.Field.totalRows;e++)t.push(i[e]);return t},Field:function(){return new o.a.Field(this.fieldSettings,this.fieldData)},coordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124}}return t},dumpCoordArray:function(){for(var t=[],i=0;i<this.Field.totalRows;i++){t[i]=[];for(var e=0;e<this.Field.columns;e++)t[i][e]={x:e*this.Field.cellWidth+this.Field.cellWidth/2+25,y:i*this.Field.cellHeight+this.Field.cellHeight/2+124-60*this.Field.totalRows}}return t},isPopping:function(){if(this.poppingCells.length===this.Field.totalRows&&this.poppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.poppingCells[t][i])return!0;return!1},isDropping:function(){if(this.droppingCells.length===this.Field.totalRows&&this.droppingCells[0].length===this.Field.columns)for(var t=0;t<this.Field.totalRows;t++)for(var i=0;i<this.Field.columns;i++)if(!0===this.droppingCells[t][i])return!0;if(!0===this.needToChangeSlides&&this.droppingDumpCells.length===this.Field.totalRows&&this.droppingDumpCells[0].length===this.Field.columns)for(var e=0;e<this.Field.totalRows;e++)for(var s=0;s<this.Field.columns;s++)if(!0===this.droppingDumpCells[e][s])return!0;return!1},fieldDataString:function(){return g(this.fieldData).join("")},shadowDataString:function(){return g(this.shadowData).join("")},cursorDataString:function(){return g(this.cursorData).join("")},arrowDataString:function(){return g(this.arrowData).join("")},scoreString:function(){var t=this.score.toString(),i=8-t.length;if(t.length>8)return"99999999";for(var e=0;e<i;e++)t="0"+t;return t},chainLengthString:function(){var t=this.chainLength.toString();return t.length<2&&(t="0"+t),t}},watch:{gameState:function(t,i){var e=this;if(this.frame=0,"dropping"===t?(console.log("Checking drops"),this.setDropData(),this.puyoStates=c("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.dumpPuyoStates=c("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites(),!1===this.isDropping&&(!0===this.needToChangeSlides?this.updateWithNextSlide():this.gameState="popping")):"popping"===t?(console.log("Checking pops"),this.setPopData(),this.puyoStates=c("idle",this.fieldSettings.totalRows,this.fieldSettings.columns),this.updatePuyoSprites()):"idle"===t&&this.ticker.addOnce(function(){console.log("resetting field"),e.updatePuyoSprites()}),"idle"===t||"editor"===t)for(var s=0;s<this.Field.totalRows;s++)for(var o=0;o<this.Field.columns;o++)this.shadowDisplay[s][o].visible=!0,this.cursorDisplay[s][o].visible=!0,this.arrowDisplay[s][o].visible=!0;else for(var a=0;a<this.Field.totalRows;a++)for(var r=0;r<this.Field.columns;r++)this.shadowDisplay[a][r].visible=!1,this.cursorDisplay[a][r].visible=!1,this.arrowDisplay[a][r].visible=!1},isPopping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):(this.fieldData=this.clearPuyosResult,console.log("set cleared puyo field"),!0===this.needToReload?(this.gameState="idle",this.needToReload=!1):this.gameState="dropping"))},isDropping:function(t,i){!1===t&&!0===i&&(!0===this.needToReset?(console.log("Resetting field to prior state."),this.resetField(),this.needToReset=!1):this.currentSlide<this.importedData.length-1&&!0===this.needToChangeSlides?!0===this.importedData[this.currentSlide+this.slideChange].autoDrop&&this.updateWithNextSlide():(this.fieldData=this.dropPuyosResult,console.log("Dropped the new puyo field"),this.updatePuyoSprites(),!0===this.chainAutoPlay?!0===this.needToReload?(this.gameState="idle",this.needToReload=!1):this.gameState="popping":(this.simulationSpeed=1,this.gameState="chainStopped")))},chainLength:function(){this.ticker.remove(this.animateChainCounter),this.timers.chainLength=0,this.chainCounterDisplay.firstDigit.y=this.chainCounterDisplay.firstDigit.origY,this.chainCounterDisplay.secondDigit.y=this.chainCounterDisplay.secondDigit.origY,this.chainCounterDisplay.chainText.y=this.chainCounterDisplay.chainText.origY,this.ticker.add(this.animateChainCounter)},garbage:function(){this.ticker.remove(this.animateGarbageTray),this.timers.garbageTray=0;for(var t=0;t<6;t++)this.garbageDisplay[t].x=(this.garbageDisplay[2].origX+this.garbageDisplay[3].origX)/2;this.garbageIcons=["spacer_n","spacer_n","spacer_n","spacer_n","spacer_n","spacer_n"],this.countGarbage(this.garbage,0),console.log(this.garbageDisplay);for(var i=0;i<6;i++)this.garbageDisplay[i].texture=this.puyoSprites["".concat(this.garbageIcons[i],".png")];this.ticker.add(this.animateGarbageTray)},scoreString:function(){if(!0===this.gameLoaded)for(var t=0;t<8;t++)this.scoreDisplay[t].texture=this.fieldSprites["score_".concat(this.scoreString[t],".png")]},chainLengthString:function(){this.chainCounterDisplay.firstDigit.alpha=0,this.chainCounterDisplay.secondDigit.alpha=0,this.chainCounterDisplay.chainText.alpha=0,"0"!==this.chainLengthString[0]?(this.chainCounterDisplay.firstDigit.alpha=1,this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[0],".png")]):this.chainCounterDisplay.firstDigit.texture=this.chainCountSprites["spacer.png"],this.chainLength>0?(this.chainCounterDisplay.secondDigit.alpha=1,this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["chain_".concat(this.chainLengthString[1],".png")],this.chainCounterDisplay.chainText.alpha=1):this.chainCounterDisplay.secondDigit.texture=this.chainCountSprites["spacer.png"]},"inViewport.now":function(t){console.log("This component is "+(t?"in-viewport":"hidden"))},slideshowSlide:function(t,i){t>i?this.updateWithNextSlide():this.prevSlide()}}},C=(e(171),e(1)),x=Object(C.a)(b,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"game-container"},[e("div",{staticClass:"game-wrapper"},[e("div",{ref:"game",attrs:{id:"game"}})]),t._v(" "),e("div",{staticClass:"overlay",on:{mouseover:function(i){t.needToReload=!1,t.playChainHover(),t.simulationSpeed=1},mouseout:function(i){t.needToReload=!0,t.needToReset=!0,t.reloadSlide(),t.gameState="idle",t.chainLength=0}}}),t._v(" "),!1===t.gameLoaded?e("div",{staticClass:"chainsim-loaded"},[t._m(0)]):t._e(),t._v(" "),e("button",{staticClass:"edit",on:{click:t.openChainsim}},[t._v("Edit")])])},[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"chainsim-loaded-inner"},[i("img",{staticStyle:{"vertical-align":"middle"},attrs:{src:"/img/save_wheel.png"}}),this._v("Loading\n    ")])}],!1,null,"67faea8a",null);x.options.__file="ChainImgField.vue";i.default=x.exports},170:function(t,i,e){t.exports=function(t){function i(s){if(e[s])return e[s].exports;var o=e[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){"use strict";var s=e(1),o=s.isInBrowser,a=e(2),r=new a(o?document.body:null);r.setStateFromDOM(null),r.listenToDOM(),o&&(window.scrollMonitor=r),t.exports=r},function(t,i){"use strict";i.VISIBILITYCHANGE="visibilityChange",i.ENTERVIEWPORT="enterViewport",i.FULLYENTERVIEWPORT="fullyEnterViewport",i.EXITVIEWPORT="exitViewport",i.PARTIALLYEXITVIEWPORT="partiallyExitViewport",i.LOCATIONCHANGE="locationChange",i.STATECHANGE="stateChange",i.eventTypes=[i.VISIBILITYCHANGE,i.ENTERVIEWPORT,i.FULLYENTERVIEWPORT,i.EXITVIEWPORT,i.PARTIALLYEXITVIEWPORT,i.LOCATIONCHANGE,i.STATECHANGE],i.isOnServer="undefined"==typeof window,i.isInBrowser=!i.isOnServer,i.defaultOffsets={top:0,bottom:0}},function(t,i,e){"use strict";function s(t){return n?0:t===document.body?window.innerHeight||document.documentElement.clientHeight:t.clientHeight}function o(t){return n?0:t===document.body?Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight):t.scrollHeight}function a(t){return n?0:t===document.body?window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop}var r=e(1),n=r.isOnServer,h=r.isInBrowser,l=r.eventTypes,d=e(3),p=!1;if(h)try{var c=Object.defineProperty({},"passive",{get:function(){p=!0}});window.addEventListener("test",null,c)}catch(t){}var u=!!p&&{capture:!1,passive:!0},g=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);var r,n,h,d=this;this.item=i,this.watchers=[],this.viewportTop=null,this.viewportBottom=null,this.documentHeight=o(i),this.viewportHeight=s(i),this.DOMListener=function(){t.prototype.DOMListener.apply(d,arguments)},this.eventTypes=l,e&&(this.containerWatcher=e.create(i)),this.update=function(){(function(){if(d.viewportTop=a(i),d.viewportBottom=d.viewportTop+d.viewportHeight,d.documentHeight=o(i),d.documentHeight!==r){for(n=d.watchers.length;n--;)d.watchers[n].recalculateLocation();r=d.documentHeight}})(),function(){for(h=d.watchers.length;h--;)d.watchers[h].update();for(h=d.watchers.length;h--;)d.watchers[h].triggerCallbacks()}()},this.recalculateLocations=function(){this.documentHeight=0,this.update()}}return t.prototype.listenToDOM=function(){h&&(window.addEventListener?(this.item===document.body?window.addEventListener("scroll",this.DOMListener,u):this.item.addEventListener("scroll",this.DOMListener,u),window.addEventListener("resize",this.DOMListener)):(this.item===document.body?window.attachEvent("onscroll",this.DOMListener):this.item.attachEvent("onscroll",this.DOMListener),window.attachEvent("onresize",this.DOMListener)),this.destroy=function(){window.addEventListener?(this.item===document.body?(window.removeEventListener("scroll",this.DOMListener,u),this.containerWatcher.destroy()):this.item.removeEventListener("scroll",this.DOMListener,u),window.removeEventListener("resize",this.DOMListener)):(this.item===document.body?(window.detachEvent("onscroll",this.DOMListener),this.containerWatcher.destroy()):this.item.detachEvent("onscroll",this.DOMListener),window.detachEvent("onresize",this.DOMListener))})},t.prototype.destroy=function(){},t.prototype.DOMListener=function(t){this.setStateFromDOM(t)},t.prototype.setStateFromDOM=function(t){var i=a(this.item),e=s(this.item),r=o(this.item);this.setState(i,e,r,t)},t.prototype.setState=function(t,i,e,s){var o=i!==this.viewportHeight||e!==this.contentHeight;if(this.latestEvent=s,this.viewportTop=t,this.viewportHeight=i,this.viewportBottom=t+i,this.contentHeight=e,o)for(var a=this.watchers.length;a--;)this.watchers[a].recalculateLocation();this.updateAndTriggerWatchers(s)},t.prototype.updateAndTriggerWatchers=function(t){for(var i=this.watchers.length;i--;)this.watchers[i].update();for(i=this.watchers.length;i--;)this.watchers[i].triggerCallbacks(t)},t.prototype.createCustomContainer=function(){return new t},t.prototype.createContainer=function(i){"string"==typeof i?i=document.querySelector(i):i&&i.length>0&&(i=i[0]);var e=new t(i,this);return e.setStateFromDOM(),e.listenToDOM(),e},t.prototype.create=function(t,i){"string"==typeof t?t=document.querySelector(t):t&&t.length>0&&(t=t[0]);var e=new d(this,t,i);return this.watchers.push(e),e},t.prototype.beget=function(t,i){return this.create(t,i)},t}();t.exports=g},function(t,i,e){"use strict";function s(t,i,e){function s(t,i){if(0!==t.length)for(m=t.length;m--;)(w=t[m]).callback.call(D,i,D),w.isOne&&t.splice(m,1)}var o,g,f,y,m,w,D=this;this.watchItem=i,this.container=t,this.offsets=e?e===+e?{top:e,bottom:e}:{top:e.top||u.top,bottom:e.bottom||u.bottom}:u,this.callbacks={};for(var S=0,v=c.length;S<v;S++)D.callbacks[c[S]]=[];this.locked=!1,this.triggerCallbacks=function(t){switch(this.isInViewport&&!o&&s(this.callbacks[r],t),this.isFullyInViewport&&!g&&s(this.callbacks[n],t),this.isAboveViewport!==f&&this.isBelowViewport!==y&&(s(this.callbacks[a],t),g||this.isFullyInViewport||(s(this.callbacks[n],t),s(this.callbacks[l],t)),o||this.isInViewport||(s(this.callbacks[r],t),s(this.callbacks[h],t))),!this.isFullyInViewport&&g&&s(this.callbacks[l],t),!this.isInViewport&&o&&s(this.callbacks[h],t),this.isInViewport!==o&&s(this.callbacks[a],t),!0){case o!==this.isInViewport:case g!==this.isFullyInViewport:case f!==this.isAboveViewport:case y!==this.isBelowViewport:s(this.callbacks[p],t)}o=this.isInViewport,g=this.isFullyInViewport,f=this.isAboveViewport,y=this.isBelowViewport},this.recalculateLocation=function(){if(!this.locked){var t=this.top,i=this.bottom;if(this.watchItem.nodeName){var e=this.watchItem.style.display;"none"===e&&(this.watchItem.style.display="");for(var o=0,a=this.container;a.containerWatcher;)o+=a.containerWatcher.top-a.containerWatcher.container.viewportTop,a=a.containerWatcher.container;var r=this.watchItem.getBoundingClientRect();this.top=r.top+this.container.viewportTop-o,this.bottom=r.bottom+this.container.viewportTop-o,"none"===e&&(this.watchItem.style.display=e)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=this.container.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom);this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,void 0===t&&void 0===i||this.top===t&&this.bottom===i||s(this.callbacks[d],null)}},this.recalculateLocation(),this.update(),o=this.isInViewport,g=this.isFullyInViewport,f=this.isAboveViewport,y=this.isBelowViewport}var o=e(1),a=o.VISIBILITYCHANGE,r=o.ENTERVIEWPORT,n=o.FULLYENTERVIEWPORT,h=o.EXITVIEWPORT,l=o.PARTIALLYEXITVIEWPORT,d=o.LOCATIONCHANGE,p=o.STATECHANGE,c=o.eventTypes,u=o.defaultOffsets;s.prototype={on:function(t,i,e){switch(!0){case t===a&&!this.isInViewport&&this.isAboveViewport:case t===r&&this.isInViewport:case t===n&&this.isFullyInViewport:case t===h&&this.isAboveViewport&&!this.isInViewport:case t===l&&this.isInViewport&&this.isAboveViewport:if(i.call(this,this.container.latestEvent,this),e)return}if(!this.callbacks[t])throw new Error("Tried to add a scroll monitor listener of type "+t+". Your options are: "+c.join(", "));this.callbacks[t].push({callback:i,isOne:e||!1})},off:function(t,i){if(!this.callbacks[t])throw new Error("Tried to remove a scroll monitor listener of type "+t+". Your options are: "+c.join(", "));for(var e,s=0;e=this.callbacks[t][s];s++)if(e.callback===i){this.callbacks[t].splice(s,1);break}},one:function(t,i){this.on(t,i,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<this.container.viewportTop,this.isBelowViewport=this.bottom>this.container.viewportBottom,this.isInViewport=this.top<this.container.viewportBottom&&this.bottom>this.container.viewportTop,this.isFullyInViewport=this.top>=this.container.viewportTop&&this.bottom<=this.container.viewportBottom||this.isAboveViewport&&this.isBelowViewport},destroy:function(){var t=this.container.watchers.indexOf(this);this.container.watchers.splice(t,1);for(var i=0,e=c.length;i<e;i++)this.callbacks[c[i]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var g=function(t){return function(i,e){this.on.call(this,t,i,e)}},f=0,y=c.length;f<y;f++){var m=c[f];s.prototype[m]=g(m)}t.exports=s}])},171:function(t,i,e){"use strict";var s=e(143);e.n(s).a}}]);